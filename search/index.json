[{"content":" 2021å¹´11æœˆ é‡æ–°å‡ºå‘ï¼\n1129 å†™ä¸å¥½æˆ‘è¿˜å†™ä¸åä¹ˆï¼ï¼Ÿ\nä»ä»Šå¤©å¼€å§‹å¸Œæœ›è‡ªå·±æ¯å¤©èƒ½åšæŒè®°å½•ã€‚ã€‚ã€‚\nâœ… åç¼–è¯‘data-gen ä»£ç ï¼Œç„¶åæ‰‹åŠ¨æ‹·å‡ºæ¥ï¼Œæ–°å»ºé¡¹ç›®ç„¶åå®Œæˆæ•°æ®ç”Ÿæˆï½\n","href":"/diary/202111/","title":"202111"},{"content":"","href":"/diary/","title":"Diaries"},{"content":"","href":"/escape/","title":"Escapes"},{"content":" 1. ç•™å­¦å’Œç§»æ°‘å’¨è¯¢  1. ç•™å­¦å’Œç§»æ°‘å’¨è¯¢  1.1. æ€»ä½“çŸ¥è¯† 1.2. åŠ æ‹¿å¤§ 1.2.1. åœ°åŸŸ 1.2.2. é€‰æ ¡ 1.2.3. é€‰ä¸“ä¸š 1.3. æ¬§æ´² 1.4. ç¾å›½   ä»20201230å¼€å§‹ï¼Œä¸ºæœŸ3ä¸ªæœˆçš„è°ƒç ”ï¼Ÿ\n é€‚åˆè‡ªå·±å’Œå¥¹çš„é¡¹ç›®ï¼Ÿ è‰åŸä¸‰çœçš„å¥½å­¦æ ¡å¥½é¡¹ç›®ï¼Ÿèƒ½å¦è¯»masterï¼Ÿ ä»å‰10ä¸ªå­¦æ ¡ä¸€è·¯çœ‹ä¸‹æ¥ï¼ŒæŠŠå®˜ç½‘åˆ·ä¸€é æ—¶é—´çº¿ï¼Œè€ƒæ‰˜ç¦/é›…æ€  1.1. æ€»ä½“çŸ¥è¯†  é€‰å­¦æ ¡ï¼Ÿ å­¦æ ¡list çœ‹å½“åœ°ç»æµå¥½ä¸å¥½æ‰¾å·¥ä½œ çœ‹å­¦æ ¡ä¸“ä¸šå’Œè‡ªå·±matchç¨‹åº¦  2021ï¼Ÿå¼€å§‹ç”³è¯·ï¼Ÿ ç½‘ç»œmasterå’‹æ ·ï¼Ÿ\n1.2. åŠ æ‹¿å¤§ å¦‚ä½•diy https://zhuanlan.zhihu.com/p/26165586\n1.2.1. åœ°åŸŸ ç§»æ°‘äººå£åˆ†å¸ƒ https://hailibk.com/knowledge-base/2019-ircc-admiss/\n19å¹´æ€»34w\nç§‘æŠ€å…¬å¸ä»ä¸œåˆ°è¥¿ï¼š\nToronto å’Œnewyorkè´¼è¿‘ï¼šcourseraã€Netflixã€uberã€oracleã€pinterestã€nvidiaã€adobeã€airbnbã€intelã€lgã€didi Ontario 15w Canada\nOttawa ï¼šShopifyï¼ˆè´­ç‰©ç½‘ç«™ï¼‰ã€nokiaã€blackberry Ontario Canada\nMontreal æ³•è¯­åŒºï¼šMicrosoftã€Googleã€Facebookã€samsung çš„ai å…¬å¸ Quebec 4w Canada\nEdmonton (è‰åŸä¸‰çœï¼‰amii AIã€amazonã€deepmind ï¼ˆaiï¼‰ Alberta 4w Canada\nVancouver ï¼šAppleã€tileç‰©è”ã€slackã€amazonã€grammarlyã€postmateé¥¿äº†ä¹ˆ British Columbia 5w Canada\nè‰åŸä¸‰çœä»½ï¼Ÿ\n1.2.2. é€‰æ ¡ æ˜¯å¦è¯»master è¿˜æ˜¯ second degreeï¼Ÿ\n1.2.3. é€‰ä¸“ä¸š 1.3. æ¬§æ´² 1.4. ç¾å›½ ","href":"/escape/intro/","title":"Intro"},{"content":"","href":"/posts/","title":"Posts"},{"content":" é‡æ–°å¼„blog æœç´¢ è¯„è®ºç³»ç»Ÿæ”¯æŒ äºŒçº§æ ‡é¢˜ï¼Ÿ 404  æœç´¢ config.toml æ·»åŠ \n[params.search] client = \u0026#34;fuse\u0026#34; æ·»åŠ search.mdåœ¨ /content ç›®å½•å³å¯ã€‚\n--- type: page layout: search outputs: - html - json --- æ·»åŠ è¯„è®ºåŠŸèƒ½\u0026ndash;Utterances Utterances åªæ”¯æŒgithubï¼Œä½†æ˜¯å¾ˆæ–¹ä¾¿\nconfig.toml ä¸­\n[params.comments] enable = true\n[params.comments.utterances] enable = true issueTerm = \u0026ldquo;pathname\u0026rdquo; # pathname / url / title / og:title /  label = \u0026ldquo;\u0026rdquo; theme = \u0026ldquo;github-light\u0026rdquo;\n[params.comments.utterances.github] username = \u0026ldquo;Tangzhongham\u0026rdquo; repository = \u0026ldquo;blog-comments\u0026rdquo;\nusername å¡«å†™è‡ªå·±çš„githubç”¨æˆ·åï¼Œrepository ä¸ºè‡ªå·±æ–°å»º1ä¸ªä»“åº“å³å¯ã€‚\nğŸ˜„ğŸ˜\n404 404 é¡µé¢æœ¬åœ°è·‘ä½äº http://localhost:1313/404.html\n","href":"/posts/redo_blog/","title":"Redo_blog"},{"content":" Rust å…¥é—¨æŒ‡å—  How to install rust and offer learning materials\n start rust é¡¹ç›®å­¦ä¹  rust æ·»åŠ è‡ªå®šä¹‰è‚¡ç¥¨åˆ—è¡¨  å®‰è£…rustç¯å¢ƒ wget https://mirrors.ustc.edu.cn/rust-static/rustup/dist/x86_64-apple-darwin/rustup-init chmod +x ./rustup-init RUSTUP_DIST_SERVER=https://mirrors.tuna.tsinghua.edu.cn/rustup ./rustup-init # Cargo æ·»åŠ å›½å†…æº echo \u0026#34;RUSTUP_DIST_SERVER=https://mirrors.tuna.tsinghua.edu.cn/rustup\u0026#34; \u0026gt;\u0026gt; ~./env # æ·»åŠ å›½å†…æºç¯å¢ƒå˜é‡ vi ~/.zshrc ï¼ˆbash çš„è¯ bashrcï¼‰ echo \u0026#34; # Rust export RUSTUP_DIST_SERVER=https://mirrors.tuna.tsinghua.edu.cn/rustup # For downloading fail CARGO_HTTP_MULTIPLEXING=false \u0026#34; \u0026gt;\u0026gt; ~/.zshrc # å®‰è£…æˆåŠŸ (æˆ‘æ”¹æˆäº†nightlyç‰ˆæœ¬) rustc --version rustc 1.46.0-nightly (346aec9b0 2020-07-11) rust çš„nightlyæœ‰ä¸€äº›å®éªŒåŠŸèƒ½æ˜¯stableæ²¡æœ‰çš„ï¼Œå¯èƒ½ä¼šé‡åˆ°stableç¼–è¯‘nightlyé¡¹ç›®å¤±è´¥çš„é—®é¢˜\nnightly å®‰è£…å¦‚ä¸‹ï¼š\nrustup install nightly rustup default nightly rustc -version rustc 1.46.0-nightly (346aec9b0 2020-07-11) # å¦‚æœè¦buildé¡¹ç›® cargo build æŠ¥é”™ cargo build\nspurious network error (2 tries remaining): [6] Couldn\u0026rsquo;t resolve host name (Could not resolve host: crates)\næ®è¯´æ˜¯å› ä¸ºä¸‹è½½è¿æ¥è¿‡å¤šï¼Œè®¾ç½® export CARGO_HTTP_MULTIPLEXING=false åŠ åˆ°ç¯å¢ƒå˜é‡å³å¯ã€‚\nç¼–è¯‘å¤±è´¥ï¼Œå‘ç°æ˜¯éœ€è¦ç”¨nightlyç‰ˆæœ¬çš„rustï¼Œè‡ªå·±é»˜è®¤ä¸‹è½½çš„æ˜¯stableç‰ˆæœ¬\nrustup install nightly\nrustup default nightly\nrustc -version\né‡æ–°æ‰§è¡Œ cargo build\nhttps://github.com/wyhaya/see\nIDEA Rust æ’ä»¶\nhttps://blog.jetbrains.com/clion/2020/05/whats-new-in-intellij-rust/ nativeDebug\né˜…è¯» https://github.com/KaiserY/trpl-zh-cn\nhttps://rust.cc/\nå†…å­˜æ¨¡å‹ https://doc.rust-lang.org/1.4.0/book/the-stack-and-the-heap.html\nRef https://www.cnblogs.com/hustcpp/p/12341098.html\n","href":"/rust/rust_intro/","title":"Rust_intro"},{"content":"","href":"/rust/","title":"Rusts"},{"content":" QUANTAXIS å®‰è£…ç¯‡ å°ç™½å»ºè®®ç›´æ¥ Docker å®‰è£…ï¼Œè¿™é‡Œä»‹ç»å¦‚ä½•å®‰è£…æœ¬åœ°ç‰ˆæœ¬ï¼Œä¸¤ä¸ªç‰ˆæœ¬éƒ½å¯ä»¥è¯»å†™ä¸€ä»½æ•°æ®ï¼Œæœ¬åœ°ç‰ˆæœ¬ä¸ºäº†æ›´å¥½çš„çœ‹ä»£ç ã€‚\n1.é¦–å…ˆæ‰“å¼€pycharmï¼Œè™šæ‹Ÿä¸€ä¸ªpython 3.6 çš„è™šæ‹Ÿç¯å¢ƒã€‚\næœ€å¥½æå‰ä¸‹è½½å¥½ anacondaï¼Œç„¶åä½ å°±å¯ä»¥åœ¨ Pycharm Project-Intepreter æ·»åŠ  Conda Environmentï¼Œç„¶åå¯ä»¥é€‰æ‹©pythonç‰ˆæœ¬ï¼Œé€‰æ‹©3.6ã€‚\n2.å·¦ä¸‹è§’æ‰“å¼€ Terminalï¼Œè¾“å…¥ä»¥ä¸‹ä»£ç ï¼š\næ³¨æ„ï¼Œæ­¤æ—¶terminalæ‰“å¼€çš„å°±æ˜¯åŒ…å«ä½ åˆšåˆšåˆ›å»ºçš„python3.6è™šæ‹Ÿç¯å¢ƒçš„shellã€‚\ngit clone https://github.com/yutiansut/quantaxis --depth 1 # è¿›å…¥åˆšåˆšæ‹‰ä¸‹æ¥çš„quantaxisé¡¹ç›® cd quantaxis pip install --default-timeout=1000 -e . -i https://pypi.doubanio.com/simple pip install tushare --default-timeout=1000 -i https://pypi.doubanio.com/simple pip install pytdx --default-timeout=1000 -i https://pypi.doubanio.com/simple pip install jupyter 3.è¿™æ ·èƒ½ç¡®ä¿ç¯å¢ƒä¸ä¼šå‡ºç°ä¾èµ–é”™è¯¯çš„æƒ…å†µï¼Œå¯ä»¥æ„‰å¿«çš„è¿›è¡Œdebugäº†ã€‚\næ¥ä¸‹æ¥ä½ æˆ–è®¸æƒ³çœ‹çœ‹è¿™ä¸ªnext step\n","href":"/quant/quantaxis_install/","title":"Quantaxis_install"},{"content":"","href":"/quant/","title":"Quants"},{"content":" hugo ç¢°è§çš„bugä»¬ ä¸Šå‘¨è‡ªå·±æ‰‹è´±ï¼ŒæŠŠmacç³»ç»Ÿæåäº†ï¼Œç»“æœåæ¥åªæœ‰æŠ¹æ‰ç£ç›˜é‡è£…è§£å†³ã€‚ã€‚ã€‚ç»“æœè¿™ä¹ˆä¸€æŠ˜è…¾ï¼Œhugoè£…ä¸ŠæŠ¥é”™ã€‚\nError: Error building site: render of \u0026#34;404\u0026#34; failed: execute of template failed: template: 404.html:1:3: executing \u0026#34;404.html\u0026#34; at \u0026lt;partial \u0026#34;header\u0026#34; .\u0026gt;: error calling partial: \u0026#34;/Users/tangmoumou/ComeIn/æ€»ç›®å½•/åšæœäº‘åŒæ­¥/ä¸ªäººæ–‡æ¡£/Markdown/mytopia/themes/minimo/layouts/partials/header.html:10:19\u0026#34;: execute of template failed: template: partials/header.html:10:8: executing \u0026#34;partials/header.html\u0026#34; at \u0026lt;partial \u0026#34;sidebar/sidebar\u0026#34; .\u0026gt;: error calling partial: execute of template failed: template: partials/sidebar/sidebar.html:10:6: executing \u0026#34;partials/sidebar/sidebar.html\u0026#34; at \u0026lt;partial \u0026#34;extras/widget_area\u0026#34; (dict \u0026#34;Widgets\u0026#34; $sidebarWidgets \u0026#34;Scope\u0026#34; .)\u0026gt;: error calling partial: execute of template failed: template: partials/extras/widget_area.html:7:8: executing \u0026#34;partials/extras/widget_area.html\u0026#34; at \u0026lt;partial (print \u0026#34;widgets/\u0026#34; .) $.Scope\u0026gt;: error calling partial: \u0026#34;/Users/tangmoumou/ComeIn/æ€»ç›®å½•/åšæœäº‘åŒæ­¥/ä¸ªäººæ–‡æ¡£/Markdown/mytopia/themes/minimo/layouts/partials/widgets/about.html:10:19\u0026#34;: execute of template failed: template: partials/widgets/about.html:10:19: executing \u0026#34;partials/widgets/about.html\u0026#34; at \u0026lt;$.Site.Home.RelPermalink\u0026gt;: error calling RelPermalink: runtime error: invalid memory address or nil pointer dereference (base)  çœ‹èµ·æ¥è´¼å“äººï¼Œbuild ä¸èµ·æ¥ã€‚\nç„¶åçµæœºä¸€åŠ¨ï¼Œä¼°è®¡æ˜¯hugoç‰ˆæœ¬ä¸å¯¹å¤´ï¼Œç›´æ¥å…¨åŸŸæœç´¢ hugo_ , èµ«ç„¶å‘ç°è¿˜å¥½ä¸»é¢˜è‡ªå¸¦çš„æœ‰ä¸ª netlify.toml æŒ‡å®šäº†å½“åˆç”¨çš„hugo version 0.55.4, èµ¶ç´§æŠŠ mac/linux/windows éƒ½ç»™ä¸‹è½½ä¸‹æ¥äº†ã€‚\næœ€åæˆåŠŸæ— ç—›åˆ‡æ¢ï¼Œèˆ’æœã€‚\n","href":"/intro/hugo_bug/","title":"Hugo_bug"},{"content":"","href":"/intro/","title":"Intros"},{"content":"","href":"/awesome/","title":"Awesomes"},{"content":" My Awesome Mac CheatSheet 1440 hidden bar Pocket cmd + s ç›´æ¥ä¿å­˜\nChrome option + cmd + arrow tab å·¦å³ç§»åŠ¨\nshift + t æ‰€æœ‰tab æœç´¢ ï¼ˆvim æ’ä»¶\nçª—å£ Magnet ctrl + option + arrow å·¦å³åŠè¾¹\nctrl + option + u/i/jk å››åˆ†ä¹‹ä¸€è¾¹\nctrl + option + d/f/g ä¸‰åˆ†ä¹‹ä¸€\nctrl + option + e/c/t ä¸‰åˆ†ä¹‹äºŒ\nctrl + option + back è¿”å›\næ‹–æ‹‰ åˆ°è¾¹è¾¹ å¯ä»¥å…¨å±æˆ–å°çª—\nAlfred ç©ºæ ¼ å¯ä»¥æœç´¢æ–‡ä»¶å in å¯ä»¥æœæ–‡ä»¶å†…å®¹ g google b baidu z zhihu hh github yt youtube bing bing \u0026gt; terminal\nï½ + ç©ºæ ¼ è½¬åˆ°ç”¨æˆ·ç›®å½•\nWorkFLow\nbj æœç´¢å°è±¡ç¬”è®°\nairpods æ–¹ä¾¿è¿æ¥/æ–­è¿è€³æœº http://www.packal.org/workflow/airpods-connector\nrm æ·»åŠ  reminder\nhttp://www.packal.org/workflow/apple-reminders\n","href":"/awesome/mac/","title":"Mac"},{"content":"","href":"/java/","title":"Javas"},{"content":" the Way to become a Computer Scientist è®°å½•è‡ªå·±æˆä¸ºä¸€åè®¡ç®—æœºç§‘å­¦å®¶çš„æˆé•¿ä¹‹è·¯.\n20200702: ç¬¬ä¸€æ¬¡ç¼–è¯‘IDEAè¿è¡Œä¸€ä¸ªå•†ä¸šé¡¹ç›®.\nyeah~~\næ‰å‘ç°è‡ªå·±æŠŠmac æåäº†\u0026hellip;å¯èƒ½è¿˜å¾—é‡è£…ç³»ç»Ÿäº†\u0026hellip;\n","href":"/java/me/","title":"Me"},{"content":"","href":"/java/java%E5%AD%A6%E4%B9%A0-jvm/","title":"Javaå­¦ä¹  JVM"},{"content":" Java å¹¶å‘  è®°å½•åœ¨å„ä¸ªåœ°æ–¹å­¦åˆ°çš„å°çŸ¥è¯†, èµ·å¸¸çœ‹å¸¸æ–°å’Œå¼¥è¡¥ä½œç”¨\n å¹¶å‘çŸ¥è¯†ç´¢å¼•:\nä»€ä¹ˆæ˜¯çº¿ç¨‹, çº¿ç¨‹çš„çŠ¶æ€, çº¿ç¨‹å¯ä»¥å¹²å˜›, ä¸ºäº†è§£å†³çº¿ç¨‹å¹²å˜›å¸¦æ¥çš„æ–°é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ.\nã€ŠJava æ ¸å¿ƒæŠ€æœ¯ã€‹ Runnable çŠ¶æ€æ˜¯å› ä¸º: æ­¤æ—¶çº¿ç¨‹å¯èƒ½æ­£åœ¨è¿è¡Œä¹Ÿå¯èƒ½æ²¡åœ¨è¿è¡Œ, è¦ç”±æ“ä½œç³»ç»Ÿä¸ºçº¿ç¨‹æä¾›å…·ä½“çš„è¿è¡Œæ—¶é—´, çº¿ç¨‹è°ƒåº¦çš„ç»†èŠ‚ä¾èµ–äºæ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡.\nçº¿ç¨‹çš„çŠ¶æ€: Newã€Runnableã€Terminatedã€+ å¹¶å‘æ‰€äº§ç”Ÿçš„ä¸‰ä¸ªcondition: Blockedã€Waitingã€Timed Waiting.\nåœ¨ Race Condition ç«æ€æ¡ä»¶ä¸‹, åŒæ­¥çš„å‡ ç§é”ä½¿ç”¨æ–¹å¼:\n synchronized, ä¸å¤Ÿçµæ´» ReentrantLock, çµæ´», éœ€è¦åœ¨ finally unlock ä½¿ç”¨object è‡ªå¸¦çš„å†…éƒ¨é” é”è‡ªå·±(flink å¸¸ç”¨) synchronized (lock) {}  æ¡ä»¶å¯¹è±¡çš„ä½¿ç”¨éœ€è¦æ³¨æ„: if a \u0026gt; 0 , xxx , è¿™ä¸¤æ­¥ä¸­é—´å¯èƒ½å°±å¯¼è‡´ä¸ä¸€è‡´, å¯ä»¥ç”¨ Condition æ¥æ“ä½œ\nå¦‚æœæ˜¯å®ä¾‹å­—æ®µçš„è¯ä½¿ç”¨ volatile å…³é”®å­—.\nstop æ–¹æ³•ä¸ä¼šæ‰§è¡Œ finally è¯­å¥å—, å¯¼è‡´ä¸€äº›é”å¾—ä¸åˆ°é‡Šæ”¾, å› æ­¤ä¸å†ä½¿ç”¨.\nBlockingQueue å¸¸ç”¨çš„å‡ ä¸ªåŸºæœ¬å®ç°åŸç†. èµ·çº¿ç¨‹å¼€é”€å¤§, æ¶‰åŠåˆ°å’Œæ“ä½œç³»ç»Ÿçš„äº¤äº’, å› æ­¤æœ‰çº¿ç¨‹æ± . Executors å¸¸ç”¨æ–¹æ³•. Fork Join åŸºæœ¬åŸç† (akka ä½¿ç”¨)  å¼€æºä¸–ç•Œ ","href":"/java/java%E5%AD%A6%E4%B9%A0-%E5%B9%B6%E5%8F%91/","title":"Javaå­¦ä¹  å¹¶å‘"},{"content":"","href":"/java/java%E5%AD%A6%E4%B9%A0-%E5%AE%B9%E5%99%A8/","title":"Javaå­¦ä¹  å®¹å™¨"},{"content":"","href":"/java/java%E5%AD%A6%E4%B9%A0-%E5%9F%BA%E7%A1%80/","title":"Javaå­¦ä¹  åŸºç¡€"},{"content":" JVMåŸç†å…¥é—¨  tzh 2020/05/19./\n  JVMåŸç†å…¥é—¨  Why JVM Why Java Javaã€JDKã€JRE JVM æ¦‚è®º ä»€ä¹ˆæ˜¯ JVM JVM æ¦‚è§ˆ å‰ç«¯ç¼–è¯‘/Class æ–‡ä»¶  Class æ–‡ä»¶ç»“æ„  åç«¯ç¼–è¯‘ è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶  åŠ è½½ éªŒè¯ å‡†å¤‡ è§£æ åˆå§‹åŒ– ä½¿ç”¨ å¸è½½  å†…å­˜/å †/GC ç§æœ‰  ç¨‹åºè®¡æ•°å™¨ Java è™šæ‹Ÿæœºæ ˆ + æœ¬åœ°æ–¹æ³•æ ˆ  å…¬æœ‰  æ–¹æ³•åŒº + å¸¸é‡æ±  å † å †çš„åˆ†å¸ƒ GC è¯æ±‡ ä¸€èˆ¬æ€§çš„GCæµç¨‹ ä¸€èˆ¬æ€§çš„ YGC/FGC å †å†…å­˜çš„å…·ä½“åˆ†å¸ƒ  ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ª Survivor åŒº   ç›´æ¥å†…å­˜ å¸¸ç”¨å‘½ä»¤ k8s ä¸Šæå…¶æ–¹ä¾¿çš„ç©æ³• jps jinfo jstat  YGC å’Œ Survivor Thoughts  jmap jstack Slipstream å¸¸ç”¨åˆ†æ (å¾…ç»­) ä½œä¸š Ref   Why JVM ä»¥ä¸‹é—®é¢˜å¾ˆæ˜¯è®©äººå¤´ç–¼?\n å†…å­˜æº¢å‡º? GC FGC YGC? server æ²¡å“åº” 4040é¡µé¢ä¸Šä¸å»? executor ä¸€è·‘å°±æŒ‚executor lost? beeline ä½œä¸šæäº¤ä¸ä¸Šå»? \u0026hellip;\u0026hellip;  ä½ å¿…é¡»å­¦ä¼šçœ‹æ‡‚æ—¥å¿—å§ã€‚é‚£ä¹ˆä½ å°±å¿…é¡»è¦çœ‹å¾—æ‡‚ GC æ—¥å¿—ï¼Œè¿™æ˜¯ Java è™šæ‹Ÿæœºå†…å®¹çš„ä¸€éƒ¨åˆ†ã€‚ä½ çœ‹æ‡‚äº† GC æ—¥å¿—ï¼Œé‚£ä¹ˆä½ å°±å¾—æ˜ç™½ä»€ä¹ˆæ˜¯å¹´è½»ä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ã€å…ƒæ•°æ®åŒºç­‰ï¼Œè¿™äº›å°±æ˜¯ Java è™šæ‹Ÿæœºçš„å†…å­˜æ¨¡å‹ã€‚ä½ æ‡‚äº† Java è™šæ‹Ÿæœºçš„å†…å­˜æ¨¡å‹ï¼Œé‚£ä½ å°±å¾—çŸ¥é“ Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶çš„ï¼Œå®ƒä»¬ä½¿ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•æ˜¯æ€æ ·çš„ï¼Œå®ƒä»¬æœ‰ä½•ä¼˜ç¼ºç‚¹ã€‚æ¥ä¸‹æ¥å°±æ˜¯å„ç§åƒåœ¾å›æ”¶å™¨çš„ç‰¹æ€§\u0026hellip;\u0026hellip;\nWhy Java Java å‡ºç”Ÿæ—¶ä¸»è¦è§£å†³çš„ä¸¤ä¸ªé—®é¢˜:\n ä¸€æ¬¡ç¼–å†™, åˆ°å¤„è¿è¡Œ (Write once, run anywhere) ç›¸å¯¹å®‰å…¨çš„å†…å­˜ç®¡ç†å’Œè®¿é—®æœºåˆ¶, é¿å…äº†å¤§éƒ¨åˆ†å†…å­˜æ³„éœ²å’ŒæŒ‡é’ˆè¶Šç•Œ(è¯­è¨€å¾€äººè¿™è¾¹æ›´åŠ åå‘åŒ–)  ä»¥å‰ç¨‹åºå‘˜å†™ä»£ç éœ€è¦åˆ†å¹³å°, åœ¨linuxèƒ½è·‘çš„ä»£ç æ”¾åˆ°winä¸Šé¢å°±è·‘ä¸äº†äº†. ç„¶åC/C++è‡ªå·±ç”³è¯·å†…å­˜è¿˜å¾—è‡ªå·±è‡ªå·±free. è®²ç™½äº†å°±æ˜¯ä½ æ‰‹é‡Œçš„ä»£ç æ˜¯è·Ÿæœºå™¨åˆè¿œäº†ä¸€æ­¥, è·Ÿæ¦‚å¿µæŠ½è±¡åˆè¿‘äº†ä¸€æ­¥.\næ¯”æ–¹è¯´, ä½ å†™äº†ä¸€ä¸ª hello world çš„ Cç¨‹åº, åœ¨linuxç¼–è¯‘å®Œåçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ä¸å¯ä»¥åœ¨windowsè¿è¡Œçš„. (generally) ä½†æ˜¯ä½ æ²¡å¬è¯´å†™ä¸€æ®µ Java ä»£ç è¿˜åˆ† windows/linux å§. è¿™å°±æ˜¯ JVM çš„ä¼˜åŠ¿äº†.\nJavaã€JDKã€JRE Java ç¤¾åŒºæŠŠ JavaæŠ€æœ¯ä½“ç³» åˆ†ä¸ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†:\n Java ç¨‹åºè®¾è®¡è¯­è¨€ å„ç§å¹³å°æ¬¾å¼çš„ JVM (java -verion) Class æ–‡ä»¶æ ¼å¼ Java API ç±»åº“ + ç¬¬ä¸‰æ–¹ç±»åº“  JRE = Java Runtime Environment = JVM + Java æ ¸å¿ƒç±»åº“. æ”¯æŒ Java ç¨‹åºè¿è¡Œçš„æ ‡å‡†ç¯å¢ƒ\nJDK = JRE + å¼€å‘ã€è¯Šæ–­å·¥å…·. ç”¨äºæ”¯æŒ Java ç¨‹åºå¼€å‘çš„æœ€å°ç¯å¢ƒ\nJVM æ¦‚è®º ä»€ä¹ˆæ˜¯ JVM JVMï¼Œå…¨ç§°Java Virtual Machineï¼Œè‹±æ–‡ä¸ºJavaè™šæ‹Ÿæœºï¼Œç®€å•çš„æ¢è®¨ä¸€ä¸‹è™šæ‹Ÿæœºè¿™ä¸‰ä¸ªå­—ï¼Œå¯¹åé¢çš„å­¦ä¹ ä¹Ÿæ˜¯æŒºèˆ’æœçš„ã€‚ç™¾åº¦ç™¾ç§‘æè¿°è¯´ï¼Œâ€œè™šæ‹Ÿæœºï¼ˆVirtual Machineï¼‰æŒ‡é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿçš„å…·æœ‰å®Œæ•´ç¡¬ä»¶ç³»ç»ŸåŠŸèƒ½çš„ã€è¿è¡Œåœ¨ä¸€ä¸ªå®Œå…¨éš”ç¦»ç¯å¢ƒä¸­çš„å®Œæ•´è®¡ç®—æœºç³»ç»Ÿâ€ï¼Œä½†æ˜¯è™šæ‹Ÿæœºæœ¬è´¨è¿˜æ˜¯è¯¥è®¡ç®—æœºç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯ä»¥ç±»æ¯”é¦™æ¸¯æ¾³é—¨å…·æœ‰é«˜åº¦è‡ªæ²»ï¼Œä½†æœ¬è´¨ä¸Šä»–ä»¬è¿˜æ˜¯å±äºä¸­å›½çš„ã€‚ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬æŠŠæ•´ä¸ªè®¡ç®—æœºå½“æˆä¸€å¹¢å¤§æ¥¼ï¼Œè€Œè™šæ‹Ÿæœºåˆ™æ˜¯æŸä¸€ä¸ªæ¥¼å±‚ã€‚å¤§æ¥¼åˆ’åˆ†äº†ä¸€ä¸ªåŒºåŸŸç»™ä¸€ä¸ªæ¥¼å±‚ï¼Œè®©è¿™ä¸ªæ¥¼å±‚è‡ªå·±ç®¡ç†è‡ªå·±ï¼Œä¹Ÿå°±å¯¹åº”ç€ï¼Œè®¡ç®—æœºåˆ’åˆ†äº†ä¸€ä¸ªå†…å­˜ç»™JVMï¼Œè®©JVMè‡ªå·±ç®¡ç†è‡ªå·±ã€‚\nä¸å…¶ä»–è¯­è¨€ä¸åŒï¼ŒJava è¯­è¨€å¹¶ä¸ç›´æ¥å°†ä»£ç ç¼–è¯‘æˆä¸ç³»ç»Ÿæœ‰å…³çš„æœºå™¨ç ï¼Œè€Œæ˜¯ç¼–è¯‘æˆä¸€ç§ç‰¹å®šçš„è¯­è¨€è§„èŒƒï¼Œè¿™ç§è¯­è¨€è§„èŒƒæˆ‘ä»¬ç§°ä¹‹ä¸ºå­—èŠ‚ç ã€‚æ— è®º Java ç¨‹åºè¦åœ¨ Windows ç³»ç»Ÿï¼Œè¿˜æ˜¯ Mac OSX ç³»ç»Ÿï¼ŒæŠ‘æˆ–æ˜¯ Linux ç³»ç»Ÿï¼Œå®ƒé¦–å…ˆéƒ½å¾—ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œä¹‹åæ‰èƒ½è¿è¡Œã€‚\nä½†å³ä½¿ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶äº†ï¼Œå„ä¸ªç³»ç»Ÿè¿˜æ˜¯æ— æ³•æ˜ç™½å­—èŠ‚ç æ–‡ä»¶çš„å†…å®¹ï¼Œè¿™æ—¶å€™å°±éœ€è¦ Java è™šæ‹Ÿæœºçš„å¸®åŠ©äº†ã€‚Java è™šæ‹Ÿæœºä¼šè§£æå­—èŠ‚ç æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†å…¶ç¿»è¯‘ä¸ºå„æ“ä½œç³»ç»Ÿèƒ½ç†è§£çš„æœºå™¨ç ã€‚\nJavaçš„ç¨‹åºç¼–è¯‘çš„æœ€ç»ˆæ ·å­æ˜¯.classæ–‡ä»¶ï¼Œä¸åŒè™šæ‹Ÿæœºçš„å¯¹æ¯ä¸€ä¸ª.classæ–‡ä»¶çš„ç¿»è¯‘ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚è€Œå¯¹äºCï¼C++è€Œè¨€ï¼Œç¼–è¯‘ç”Ÿæˆçš„æ˜¯çº¯äºŒè¿›åˆ¶çš„æœºå™¨æŒ‡ä»¤ï¼Œæ˜¯ç›´æ¥é¢å¯¹è®¡ç®—æœºç³»ç»Ÿçš„å†…å­˜ï¼Œä½†æ˜¯ï¼Œjavaç¨‹åºçš„ç¼–è¯‘ç»“æœæ˜¯é¢å‘JVMï¼Œæ˜¯è¦äº¤ä»˜ç»™JVMï¼Œè®©ä»–å†åšè¿›ä¸€æ­¥å¤„ç†ä»è€Œè®©è®¡ç®—æœºè¯†åˆ«è¿è¡Œï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œå±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚â€ã€‚\nJVM æ¦‚è§ˆ  ä»£ç ç¼–è¯‘çš„ç»“æœä»æœ¬åœ°æœºå™¨ç è½¬å˜ä¸ºå­—èŠ‚ç , æ˜¯å‚¨å­˜æ ¼å¼å‘å±•çš„ä¸€å°æ­¥, ç¡®å®ç¼–ç¨‹è¯­è¨€å‘å±•çš„ä¸€å¤§æ­¥\n å‰ç«¯ç¼–è¯‘/Class æ–‡ä»¶ public class Helloworld{ public static void main(String[] args) { System.out.println(\u0026#34;hello world\u0026#34;); } }javac Helloworld.java ll Helloworld.java // äºŒè¿›åˆ¶çš„å­—èŠ‚ç  Helloworld.class [root@linux-pm-0-37 tzh]# java Helloworld hello world æˆ‘ä»¬è¿è¡Œ javac å‘½ä»¤çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ javac ç¼–è¯‘å™¨è§£æ Java æºä»£ç ï¼Œå¹¶ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶çš„è¿‡ç¨‹ã€‚è¯´ç™½äº†ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨ javac ç¼–è¯‘å™¨æŠŠ Java è¯­è¨€è§„èŒƒè½¬åŒ–ä¸ºå­—èŠ‚ç è¯­è¨€è§„èŒƒã€‚javac ç¼–è¯‘å™¨çš„å¤„ç†è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‹é¢å››ä¸ªé˜¶æ®µï¼š\nç¬¬ä¸€ä¸ªé˜¶æ®µï¼šè¯æ³•ã€è¯­æ³•åˆ†æã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒJVM ä¼šå¯¹æºä»£ç çš„å­—ç¬¦è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªæŠ½è±¡çš„è¯­æ³•æ ‘ã€‚ç®€å•åœ°è¯´ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µ JVM ä¼šææ‡‚æˆ‘ä»¬çš„ä»£ç åˆ°åº•æƒ³è¦å¹²å˜›ã€‚å°±åƒæˆ‘ä»¬åˆ†æä¸€ä¸ªå¥å­ä¸€æ ·ï¼Œæˆ‘ä»¬ä¼šå¯¹å¥å­åˆ’åˆ†ä¸»è°“å®¾ï¼Œå¼„æ¸…æ¥šè¿™ä¸ªå¥å­è¦è¡¨è¾¾çš„æ„æ€ä¸€æ ·ã€‚\nç¬¬äºŒä¸ªé˜¶æ®µï¼šå¡«å……ç¬¦å·è¡¨ã€‚æˆ‘ä»¬çŸ¥é“ç±»ä¹‹é—´æ˜¯ä¼šäº’ç›¸å¼•ç”¨çš„ï¼Œä½†åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šå…¶å…·ä½“çš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªç¬¦å·æ¥æ›¿ä»£ã€‚åœ¨è¿™ä¸ªé˜¶æ®µåšçš„å°±æ˜¯ç±»ä¼¼çš„äº‹æƒ…ï¼Œå³å¯¹æŠ½è±¡çš„ç±»æˆ–æ¥å£è¿›è¡Œç¬¦å·å¡«å……ã€‚ç­‰åˆ°ç±»åŠ è½½é˜¶æ®µï¼ŒJVM ä¼šå°†ç¬¦å·æ›¿æ¢æˆå…·ä½“çš„å†…å­˜åœ°å€ã€‚\nç¬¬ä¸‰ä¸ªé˜¶æ®µï¼šæ³¨è§£å¤„ç†ã€‚æˆ‘ä»¬çŸ¥é“ Java æ˜¯æ”¯æŒæ³¨è§£çš„ï¼Œå› æ­¤åœ¨è¿™ä¸ªé˜¶æ®µä¼šå¯¹æ³¨è§£è¿›è¡Œåˆ†æï¼Œæ ¹æ®æ³¨è§£çš„ä½œç”¨å°†å…¶è¿˜åŸæˆå…·ä½“çš„æŒ‡ä»¤é›†ã€‚\nç¬¬å››ä¸ªé˜¶æ®µï¼šåˆ†æä¸å­—èŠ‚ç ç”Ÿæˆã€‚åˆ°äº†è¿™ä¸ªé˜¶æ®µï¼ŒJVM ä¾¿ä¼šæ ¹æ®ä¸Šé¢å‡ ä¸ªé˜¶æ®µåˆ†æå‡ºæ¥çš„ç»“æœï¼Œè¿›è¡Œå­—èŠ‚ç çš„ç”Ÿæˆï¼Œæœ€ç»ˆè¾“å‡ºä¸º class æ–‡ä»¶ã€‚\nClass æ–‡ä»¶ç»“æ„  é­”æ•°ä¸Classæ–‡ä»¶ç‰ˆæœ¬ å¸¸é‡æ±  è®¿é—®æ ‡å¿— ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼• å­—æ®µè¡¨é›†åˆ æ–¹æ³•è¡¨é›†åˆ å±æ€§è¡¨é›†åˆ  åç«¯ç¼–è¯‘ AOT: Ahead of Time, è¿è¡Œå‰ç¼–è¯‘\nJIT: Just in Time, åŠ¨æ€(å³æ—¶)ç¼–è¯‘ï¼Œè¾¹è¿è¡Œè¾¹ç¼–è¯‘\nè¿™ä¸¤ç§æ–¹å¼çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…å¯åŠ¨é€Ÿåº¦å¿«ä½†è¿è¡Œé€Ÿåº¦æ…¢ï¼Œè€Œåè€…å¯åŠ¨é€Ÿåº¦æ…¢ä½†è¿è¡Œé€Ÿåº¦å¿«ã€‚è‡³äºä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œå…¶åŸå› å¾ˆç®€å•ã€‚å› ä¸ºè§£é‡Šå™¨ä¸éœ€è¦åƒ JIT ç¼–è¯‘å™¨ä¸€æ ·ï¼Œå°†æ‰€æœ‰å­—èŠ‚ç éƒ½è½¬åŒ–ä¸ºæœºå™¨ç ï¼Œè‡ªç„¶å°±å°‘å»äº†ä¼˜åŒ–çš„æ—¶é—´ã€‚è€Œå½“ JIT ç¼–è¯‘å™¨å®Œæˆç¬¬ä¸€æ¬¡ç¼–è¯‘åï¼Œå…¶ä¼šå°†å­—èŠ‚ç å¯¹åº”çš„æœºå™¨ç ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œæœºå™¨ç çš„è¿è¡Œæ•ˆç‡è‚¯å®šæ˜¯é«˜äº Java è§£é‡Šå™¨çš„ã€‚æ‰€ä»¥åœ¨å®é™…æƒ…å†µä¸­ï¼Œä¸ºäº†è¿è¡Œé€Ÿåº¦ä»¥åŠæ•ˆç‡ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨ä¸¤è€…ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œ Java ä»£ç çš„ç¼–è¯‘æ‰§è¡Œã€‚\næ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤ä¸¤ç§ä¸€èµ·ä¸Š.\n[root@linux-pm-0-37 tzh]# java -version java version \u0026#34;1.8.0_191\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_191-b12) Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode) [root@linux-pm-0-37 tzh]# java -Xcomp -version java version \u0026#34;1.8.0_191\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_191-b12) Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, compiled mode) [root@linux-pm-0-37 tzh]# java -Xint -version java version \u0026#34;1.8.0_191\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_191-b12) Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, interpreted mode) è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶ JVM æŠŠæè¿°ç±»çš„æ•°æ®ä» Class æ–‡ä»¶åŠ è½½åˆ°å†…å­˜, å¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æã€åˆå§‹åŒ–ç­‰æœ€ç»ˆå½¢æˆèƒ½è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„ Javaç±»å‹, è¿™ä¸ªè¿‡ç¨‹å«åšè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶.\nå½“æˆ‘ä»¬çš„Javaä»£ç ç¼–è¯‘å®Œæˆåï¼Œä¼šç”Ÿæˆå¯¹åº”çš„ class æ–‡ä»¶ã€‚æ¥ç€æˆ‘ä»¬è¿è¡Œjava Demoå‘½ä»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®æ˜¯å¯åŠ¨äº†JVM è™šæ‹Ÿæœºæ‰§è¡Œ class å­—èŠ‚ç æ–‡ä»¶çš„å†…å®¹ã€‚è€Œ JVM è™šæ‹Ÿæœºæ‰§è¡Œ class å­—èŠ‚ç çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸ƒä¸ªé˜¶æ®µï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å¸è½½ã€‚\nåŠ è½½  é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šå(æºæ–‡ä»¶ä¸­çš„å…¨æ–°å®šåæ˜¯åŒ…ååŠ ç±»åï¼Œ åŒ…åçš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´ï¼ŒåŒ…åå’Œç±»åä¹‹é—´ï¼Œ ä½¿ç”¨ç‚¹å·åˆ†å‰²ã€‚ å¦‚Objectç±»ï¼Œ åœ¨æºæ–‡ä»¶ä¸­çš„å…¨é™å®šåæ˜¯java.lang.Object )è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†è¯¥äºŒè¿›åˆ¶å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å‚¨å­˜ç»“æ„è½¬åŒ–ä¸º æ–¹æ³•åŒº(Method Area) è¿è¡Œæ—¶çš„æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Class å¯¹è±¡, ä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£  åŠ è½½ç”¨çš„ç±»åŠ è½½å™¨classloader åˆ†ä¸º å¯åŠ¨ç±»åŠ è½½å™¨ sun.boot.class.path æ§åˆ¶(jinfo å¯çœ‹) å’Œ å…¶ä»–åŠ è½½å™¨.\næ³¨æ„: å¯¹äºä»»ä½•ä¸€ä¸ªç±», éƒ½å¿…é¡»ç”±å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€èµ·ç¡®å®šåœ¨ JVM çš„å”¯ä¸€æ€§. inceptor æœ‰ä¸ªé—®é¢˜: ä¸æ”¯æŒåŠ¨æ€æ›´æ–°UDF. å°±æ˜¯ç”±äºç”¨äº†åŒä¸€ä¸ªclassloader + UDF å…¨é™å®šåæœªæ”¹(å¯èƒ½æ›¾åŠ è½½åˆ°method areaå¹¶ä¸”æœªæ¸…æ‰) è€Œå¯¼è‡´JVMæ— æ³•ç¡®å®šudfè¡Œä¸ºä¸å¯æµ‹.\nWARP-27681 TDH 6.0.1, TDH 6.1, TDH 5.2.3æ”¯æŒä¸é‡å¯æœåŠ¡æ›´æ–°udf jaråŒ… drop permanent function kafka_demo with resource; create permanent function kafka_demo as \u0026lsquo;io.transwarp.udf.KafkaUDF\u0026rsquo; using jar \u0026lsquo;file:///home/wangcheng/marason/udf/udf/target/kafka.jar\u0026rsquo;;\néªŒè¯ å½“ JVM åŠ è½½å®Œ Class å­—èŠ‚ç æ–‡ä»¶å¹¶åœ¨æ–¹æ³•åŒºåˆ›å»ºå¯¹åº”çš„ Class å¯¹è±¡ä¹‹åï¼ŒJVM ä¾¿ä¼šå¯åŠ¨å¯¹è¯¥å­—èŠ‚ç æµçš„æ ¡éªŒï¼Œåªæœ‰ç¬¦åˆ JVM å­—èŠ‚ç è§„èŒƒçš„æ–‡ä»¶æ‰èƒ½è¢« JVM æ­£ç¡®æ‰§è¡Œã€‚è¿™ä¸ªæ ¡éªŒè¿‡ç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‹é¢å‡ ä¸ªç±»å‹ï¼š\nJVMè§„èŒƒæ ¡éªŒã€‚JVM ä¼šå¯¹å­—èŠ‚æµè¿›è¡Œæ–‡ä»¶æ ¼å¼æ ¡éªŒï¼Œåˆ¤æ–­å…¶æ˜¯å¦ç¬¦åˆ JVM è§„èŒƒï¼Œæ˜¯å¦èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚ä¾‹å¦‚ï¼šæ–‡ä»¶æ˜¯å¦æ˜¯ä»¥ 0x cafe beneå¼€å¤´ï¼Œä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†…ç­‰ã€‚ ä»£ç é€»è¾‘æ ¡éªŒã€‚JVM ä¼šå¯¹ä»£ç ç»„æˆçš„æ•°æ®æµå’Œæ§åˆ¶æµè¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿ JVM è¿è¡Œè¯¥å­—èŠ‚ç æ–‡ä»¶åä¸ä¼šå‡ºç°è‡´å‘½é”™è¯¯ã€‚ä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•è¦æ±‚ä¼ å…¥ int ç±»å‹çš„å‚æ•°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒçš„æ—¶å€™å´ä¼ å…¥äº†ä¸€ä¸ª String ç±»å‹çš„å‚æ•°ã€‚ä¸€ä¸ªæ–¹æ³•è¦æ±‚è¿”å› String ç±»å‹çš„ç»“æœï¼Œä½†æ˜¯æœ€åå´æ²¡æœ‰è¿”å›ç»“æœã€‚ä»£ç ä¸­å¼•ç”¨äº†ä¸€ä¸ªåä¸º Apple çš„ç±»ï¼Œä½†æ˜¯ä½ å®é™…ä¸Šå´æ²¡æœ‰å®šä¹‰ Apple ç±»ã€‚ å½“ä»£ç æ•°æ®è¢«åŠ è½½åˆ°å†…å­˜ä¸­åï¼Œè™šæ‹Ÿæœºå°±ä¼šå¯¹ä»£ç æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œçœ‹çœ‹è¿™ä»½ä»£ç æ˜¯ä¸æ˜¯çœŸçš„æŒ‰ç…§JVMè§„èŒƒå»å†™çš„ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹äºæˆ‘ä»¬è§£ç­”é—®é¢˜ä¹Ÿæ²¡æœ‰ç›´æ¥çš„å…³ç³»ï¼Œä½†æ˜¯äº†è§£ç±»åŠ è½½æœºåˆ¶å¿…é¡»è¦çŸ¥é“æœ‰è¿™ä¸ªè¿‡ç¨‹ã€‚\nå‡†å¤‡ å½“å®Œæˆå­—èŠ‚ç æ–‡ä»¶çš„æ ¡éªŒä¹‹åï¼ŒJVM ä¾¿ä¼šå¼€å§‹ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œå³å†…å­˜åˆ†é…çš„å¯¹è±¡ä»¥åŠåˆå§‹åŒ–çš„ç±»å‹ã€‚\nå†…å­˜åˆ†é…çš„å¯¹è±¡ã€‚Java ä¸­çš„å˜é‡æœ‰ã€Œç±»å˜é‡ã€å’Œã€Œç±»æˆå‘˜å˜é‡ã€ä¸¤ç§ç±»å‹ï¼Œã€Œç±»å˜é‡ã€æŒ‡çš„æ˜¯è¢« static ä¿®é¥°çš„å˜é‡ï¼Œè€Œå…¶ä»–æ‰€æœ‰ç±»å‹çš„å˜é‡éƒ½å±äºã€Œç±»æˆå‘˜å˜é‡ã€ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼ŒJVM åªä¼šä¸ºã€Œç±»å˜é‡ã€åˆ†é…å†…å­˜ï¼Œè€Œä¸ä¼šä¸ºã€Œç±»æˆå‘˜å˜é‡ã€åˆ†é…å†…å­˜ã€‚ã€Œç±»æˆå‘˜å˜é‡ã€çš„å†…å­˜åˆ†é…éœ€è¦ç­‰åˆ°åˆå§‹åŒ–é˜¶æ®µæ‰å¼€å§‹ã€‚ ä¾‹å¦‚ä¸‹é¢çš„ä»£ç åœ¨å‡†å¤‡é˜¶æ®µï¼Œåªä¼šä¸º factor å±æ€§åˆ†é…å†…å­˜ï¼Œè€Œä¸ä¼šä¸º website å±æ€§åˆ†é…å†…å­˜ã€‚\npublic static int factor = 3; public String website = \u0026ldquo;www.cnblogs.com/chanshuyi\u0026rdquo;; åˆå§‹åŒ–çš„ç±»å‹ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼ŒJVM ä¼šä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶ä¸ºå…¶åˆå§‹åŒ–ã€‚ä½†æ˜¯è¿™é‡Œçš„åˆå§‹åŒ–æŒ‡çš„æ˜¯ä¸ºå˜é‡èµ‹äºˆ Java è¯­è¨€ä¸­è¯¥æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œè€Œä¸æ˜¯ç”¨æˆ·ä»£ç é‡Œåˆå§‹åŒ–çš„å€¼ã€‚ ä¾‹å¦‚ä¸‹é¢çš„ä»£ç åœ¨å‡†å¤‡é˜¶æ®µä¹‹åï¼Œsector çš„å€¼å°†æ˜¯ 0ï¼Œè€Œä¸æ˜¯ 3ã€‚\npublic static int sector = 3; ä½†å¦‚æœä¸€ä¸ªå˜é‡æ˜¯å¸¸é‡ï¼ˆè¢« static final ä¿®é¥°ï¼‰çš„è¯ï¼Œé‚£ä¹ˆåœ¨å‡†å¤‡é˜¶æ®µï¼Œå±æ€§ä¾¿ä¼šè¢«èµ‹äºˆç”¨æˆ·å¸Œæœ›çš„å€¼ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç åœ¨å‡†å¤‡é˜¶æ®µä¹‹åï¼Œnumber çš„å€¼å°†æ˜¯ 3ï¼Œè€Œä¸æ˜¯ 0ã€‚\npublic static final int number = 3; ä¹‹æ‰€ä»¥ static final ä¼šç›´æ¥è¢«å¤åˆ¶ï¼Œè€Œ static å˜é‡ä¼šè¢«èµ‹äºˆé›¶å€¼ã€‚å…¶å®æˆ‘ä»¬ç¨å¾®æ€è€ƒä¸€ä¸‹å°±èƒ½æƒ³æ˜ç™½äº†ã€‚\nä¸¤ä¸ªè¯­å¥çš„åŒºåˆ«æ˜¯ä¸€ä¸ªæœ‰ final å…³é”®å­—ä¿®é¥°ï¼Œå¦å¤–ä¸€ä¸ªæ²¡æœ‰ã€‚è€Œ final å…³é”®å­—åœ¨ Java ä¸­ä»£è¡¨ä¸å¯æ”¹å˜çš„æ„æ€ï¼Œæ„æ€å°±æ˜¯è¯´ number çš„å€¼ä¸€æ—¦èµ‹å€¼å°±ä¸ä¼šåœ¨æ”¹å˜äº†ã€‚æ—¢ç„¶ä¸€æ—¦èµ‹å€¼å°±ä¸ä¼šå†æ”¹å˜ï¼Œé‚£ä¹ˆå°±å¿…é¡»ä¸€å¼€å§‹å°±ç»™å…¶èµ‹äºˆç”¨æˆ·æƒ³è¦çš„å€¼ï¼Œå› æ­¤è¢« final ä¿®é¥°çš„ç±»å˜é‡åœ¨å‡†å¤‡é˜¶æ®µå°±ä¼šè¢«èµ‹äºˆæƒ³è¦çš„å€¼ã€‚è€Œæ²¡æœ‰è¢« final ä¿®é¥°çš„ç±»å˜é‡ï¼Œå…¶å¯èƒ½åœ¨åˆå§‹åŒ–é˜¶æ®µæˆ–è€…è¿è¡Œé˜¶æ®µå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦åœ¨å‡†å¤‡é˜¶æ®µå¯¹å®ƒèµ‹äºˆç”¨æˆ·æƒ³è¦çš„å€¼ã€‚\nè§£æ å½“é€šè¿‡å‡†å¤‡é˜¶æ®µä¹‹åï¼ŒJVM é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦ 7 ç±»å¼•ç”¨è¿›è¡Œè§£æã€‚è¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡æ˜¯å°†å…¶åœ¨å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆç›´æ¥å…¶åœ¨å†…å­˜ä¸­çš„ç›´æ¥å¼•ç”¨ã€‚\nå…¶å®è¿™ä¸ªé˜¶æ®µå¯¹äºæˆ‘ä»¬æ¥è¯´ä¹Ÿæ˜¯å‡ ä¹é€æ˜çš„ï¼Œäº†è§£ä¸€ä¸‹å°±å¥½ã€‚\nåˆå§‹åŒ– åˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œç”¨æˆ·å®šä¹‰çš„ Java ç¨‹åºä»£ç æ‰çœŸæ­£å¼€å§‹æ‰§è¡Œã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒJVM ä¼šæ ¹æ®è¯­å¥æ‰§è¡Œé¡ºåºå¯¹ç±»å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸€èˆ¬æ¥è¯´å½“ JVM é‡åˆ°ä¸‹é¢ 5 ç§æƒ…å†µçš„æ—¶å€™ä¼šè§¦å‘åˆå§‹åŒ–ï¼š\né‡åˆ° newã€getstaticã€putstaticã€invokestatic è¿™å››æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ç”Ÿæˆè¿™4æ¡æŒ‡ä»¤çš„æœ€å¸¸è§çš„Javaä»£ç åœºæ™¯æ˜¯ï¼šä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ã€è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢«finalä¿®é¥°ã€å·²åœ¨ç¼–è¯‘å™¨æŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰çš„æ—¶å€™ï¼Œä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚ ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚ å½“ä½¿ç”¨ JDK1.7 åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandleå®ä¾‹æœ€åçš„è§£æç»“æœ REF_getstatic,REF_putstatic,REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆå‡ºè§¦å‘å…¶åˆå§‹åŒ–ã€‚ çœ‹åˆ°ä¸Šé¢å‡ ä¸ªæ¡ä»¶ä½ å¯èƒ½ä¼šæ™•äº†ï¼Œä½†æ˜¯ä¸è¦ç´§ï¼Œä¸éœ€è¦èƒŒï¼ŒçŸ¥é“ä¸€ä¸‹å°±å¥½ï¼Œåé¢ç”¨åˆ°çš„æ—¶å€™å›åˆ°æ‰¾ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚\nä½¿ç”¨ å½“ JVM å®Œæˆåˆå§‹åŒ–é˜¶æ®µä¹‹åï¼ŒJVM ä¾¿å¼€å§‹ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç ã€‚è¿™ä¸ªé˜¶æ®µä¹Ÿåªæ˜¯äº†è§£ä¸€ä¸‹å°±å¯ä»¥ã€‚\nå¸è½½ å½“ç”¨æˆ·ç¨‹åºä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒJVM ä¾¿å¼€å§‹é”€æ¯åˆ›å»ºçš„ Class å¯¹è±¡ï¼Œæœ€åè´Ÿè´£è¿è¡Œçš„ JVM ä¹Ÿé€€å‡ºå†…å­˜ã€‚è¿™ä¸ªé˜¶æ®µä¹Ÿåªæ˜¯äº†è§£ä¸€ä¸‹å°±å¯ä»¥ã€‚\nå†…å­˜/å †/GC  Java å’Œ C++ æœ‰ä¸€å µç”±å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯æ‰€å›´æˆçš„é«˜å¢™, å¢™å¤–çš„äººæƒ³è¿›æ¥, å¢™å†…çš„äººå´æƒ³å‡ºæ¥\n ç°åœ¨å¯¹äºä¸€ä¸ª Java æºæ–‡ä»¶æ˜¯å¦‚ä½•å˜æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œä»¥åŠå­—èŠ‚ç æ–‡ä»¶çš„å«ä¹‰å·²ç»éå¸¸æ¸…æ¥šäº†ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è®© Java è™šæ‹Ÿæœºè¿è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼Œä»è€Œå¾—å‡ºæˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„ç»“æœäº†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒJava è™šæ‹Ÿæœºä¼šåŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œå°†å…¶å­˜å…¥ Java è™šæ‹Ÿæœºçš„å†…å­˜ç©ºé—´ä¸­ï¼Œä¹‹åè¿›è¡Œä¸€ç³»åˆ—çš„åˆå§‹åŒ–åŠ¨ä½œï¼Œæœ€åè¿è¡Œç¨‹åºå¾—å‡ºç»“æœã€‚\næ ¹æ®ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­çš„è¯´æ³•ï¼ŒJava è™šæ‹Ÿæœºçš„å†…å­˜ç»“æ„å¯ä»¥åˆ†ä¸ºå…¬æœ‰å’Œç§æœ‰ä¸¤éƒ¨åˆ†ã€‚å…¬æœ‰æŒ‡çš„æ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«çš„éƒ¨åˆ†ï¼ŒæŒ‡çš„æ˜¯ Java å †ã€æ–¹æ³•åŒºã€å¸¸é‡æ± ã€‚ç§æœ‰æŒ‡çš„æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šPCå¯„å­˜å™¨ã€Java è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€‚\nç§æœ‰ ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨: Program Counter Register, æ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´(æ²¡æœ‰è§„å®šOOM), å¯ä»¥çœ‹åšæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨. å­—èŠ‚ç è§£é‡Šå™¨åœ¨å·¥ä½œæ—¶å°±æ˜¯æ”¹å˜è®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤, åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤éƒ½ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨.\nä¸ºä»€ä¹ˆæ˜¯ç§æœ‰?\nè¿™æ˜¯ç”±äº JVM çš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢ã€åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼å®ç°çš„, åœ¨ä»»æ„ä¸€ä¸ªç¡®å®šçš„æ—¶é—´, ä¸€ä¸ªå¤„ç†å™¨(å¤šæ ¸å¤„ç†å™¨å°±æ˜¯ä¸€ä¸ªæ ¸)åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤. æ‰€ä»¥åˆ‡æ¢åè¦èƒ½å›åˆ°åŸä½, æ¯æ¡çº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨.\nJava è™šæ‹Ÿæœºæ ˆ + æœ¬åœ°æ–¹æ³•æ ˆ javaè™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä»–ä¸çº¿ç¨‹çš„å£°æ˜å‘¨æœŸåŒæ­¥ã€‚ è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯javaæ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§åŒ…å«å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•å‡ºå£ç­‰ã€‚(è§„å®šäº† OOM + StackOverflow)\næ³¨æ„: ä¸€æ¡né•¿çš„SQLå¯èƒ½ä¼šå¯¼è‡´ StackOverflow , å¯ä»¥é€šè¿‡è°ƒæ•´ xss (é»˜è®¤64ä½ä¸º 1024k) HotSpot è™šæ‹Ÿæœºå°† Java è™šæ‹Ÿæœºæ ˆ + æœ¬åœ°æ–¹æ³•æ ˆ æ”¾åœ¨ä¸€èµ·, åªèƒ½é€šè¿‡ xss ä¸€èµ·è°ƒèŠ‚\n[root@linux-pm-0-37 tzh]# java -XX:+PrintFlagsFinal -version | grep ThreadStackSize intx CompilerThreadStackSize = 0 {pd product} intx ThreadStackSize = 1024 {pd product} intx VMThreadStackSize = 1024 {pd product} java version \u0026#34;1.8.0_191\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_191-b12) Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode) å½“ Java è™šæ‹Ÿæœºä½¿ç”¨å…¶ä»–è¯­è¨€ï¼ˆä¾‹å¦‚ C è¯­è¨€ï¼‰æ¥å®ç°æŒ‡ä»¤é›†è§£é‡Šå™¨æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨åˆ°æœ¬åœ°æ–¹æ³•æ ˆã€‚å¦‚æœ Java è™šæ‹Ÿæœºä¸æ”¯æŒ natvie æ–¹æ³•ï¼Œå¹¶ä¸”è‡ªå·±ä¹Ÿä¸ä¾èµ–ä¼ ç»Ÿæ ˆçš„è¯ï¼Œå¯ä»¥æ— éœ€æ”¯æŒæœ¬åœ°æ–¹æ³•æ ˆã€‚\nå…¬æœ‰ çº¿ç¨‹å…¬æœ‰çš„éƒ¨åˆ†åˆ†ä¸º: å †ã€æ–¹æ³•åŒºã€å¸¸é‡æ± .\næ–¹æ³•åŒº + å¸¸é‡æ±  æ–¹æ³•åŒº: Method Area, æŒ‡çš„æ˜¯å­˜å‚¨ Java ç±»å­—èŠ‚ç æ•°æ®çš„ä¸€å—åŒºåŸŸï¼Œå®ƒå­˜å‚¨äº†æ¯ä¸€ä¸ªç±»çš„ç»“æ„ä¿¡æ¯ï¼Œä¾‹å¦‚è¿è¡Œæ—¶å¸¸é‡æ± ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ã€æ„é€ æ–¹æ³•ç­‰ã€‚å¯ä»¥çœ‹åˆ°å¸¸é‡æ± å…¶å®æ˜¯å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­çš„ï¼Œä½†ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹å°†å¸¸é‡æ± å’Œæ–¹æ³•åŒºæ”¾åœ¨åŒä¸€ä¸ªç­‰çº§ä¸Šï¼Œè¿™ç‚¹æˆ‘ä»¬çŸ¥æ™“å³å¯ã€‚\næ–¹æ³•åŒºåœ¨ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºæœ‰ä¸åŒçš„è¡¨ç°å½¢å¼ï¼Œä¾‹å¦‚åœ¨ 1.7 ç‰ˆæœ¬çš„ HotSpot è™šæ‹Ÿæœºä¸­ï¼Œæ–¹æ³•åŒºè¢«ç§°ä¸ºæ°¸ä¹…ä»£ï¼ˆPermanent Spaceï¼‰ï¼Œè€Œåœ¨ JDK 1.8 ä¸­åˆ™è¢«ç§°ä¹‹ä¸º MetaSpaceã€‚\nè¿™æ˜¯å› ä¸º JDK 1.8 ä¹‹å‰, HotSpot çš„è®¾è®¡å›¢é˜Ÿé€‰æ‹©æŠŠåƒåœ¾æ”¶é›†å™¨çš„åˆ†ä»£è®¾è®¡æ‰©å±•åˆ°æ–¹æ³•åŒº, æˆ–è€…è¯´ä½¿ç”¨ æ°¸ä¹…ä»£ æ¥å®ç°æ–¹æ³•åŒº, ä»è€Œå…å»ä¸“é—¨ç¼–å†™å†…å­˜ç®¡ç†ä»£ç . ç”±äºå¯èƒ½è¿™ä¸ªè®¾è®¡ä¸å¤§èˆ’æœ (å¾ˆå®¹æ˜“å‡ºç°OOM ç­‰ç­‰åŸå› )\nJDK 1.8 å°† æ–¹æ³•åŒº çš„å®ç°ä» æ°¸ä¹…ä»£ æ”¹æˆäº† å…ƒç©ºé—´MetaSpace. (ä» -XX:MaxPermSize å˜æˆ -XX:MetaspaceSize)\nè¿™é‡Œæœ€å¤§çš„åŒºåˆ«åœ¨äº, Metaspace ä½¿ç”¨çš„æ˜¯ ç›´æ¥å†…å­˜(æœ¬åœ°å†…å­˜ Native Memory)\næ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ª JVM æœ¬èº«è®¾ç½®å›ºå®šå¤§å°ä¸Šçº¿ï¼Œæ— æ³•è¿›è¡Œè°ƒæ•´ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ï¼Œå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå¾—åˆ°java.lang.OutOfMemoryErrorã€‚ä½ å¯ä»¥ä½¿ç”¨ -XXï¼šMaxMetaspaceSize æ ‡å¿—è®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼Œé»˜è®¤å€¼ä¸º unlimitedï¼Œè¿™æ„å‘³ç€å®ƒåªå—ç³»ç»Ÿå†…å­˜çš„é™åˆ¶ã€‚-XXï¼šMetaspaceSize è°ƒæ•´æ ‡å¿—å®šä¹‰å…ƒç©ºé—´çš„åˆå§‹å¤§å°å¦‚æœæœªæŒ‡å®šæ­¤æ ‡å¿—ï¼Œåˆ™ Metaspace å°†æ ¹æ®è¿è¡Œæ—¶çš„åº”ç”¨ç¨‹åºéœ€æ±‚åŠ¨æ€åœ°é‡æ–°è°ƒæ•´å¤§å°ã€‚\nè¿è¡Œæ—¶å¸¸é‡æ± : Runtime Constant Pool, æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†. è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰å¸¸é‡æ± ä¿¡æ¯ï¼ˆç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰\næ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ—¶æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚\nJDK1.7åŠä¹‹åç‰ˆæœ¬çš„ JVM å·²ç»å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºä¸­ç§»äº†å‡ºæ¥ï¼Œåœ¨ Java å †ï¼ˆHeapï¼‰ä¸­å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ã€‚\nå †  è‡ªåŠ¨å†…å­˜ç®¡ç†æ ¹æœ¬ä¸Šè§£å†³äº†: è‡ªåŠ¨ç»™å¯¹è±¡åˆ†é…å†…å­˜ + è‡ªåŠ¨å›æ”¶åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜\n Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚\nJava å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œGCå †ï¼ˆGarbage Collected Heapï¼‰.\n å¼±åˆ†ä»£å‡è¯´(Weak Generational Hypothisis): ç»å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•ç­ å¼ºåˆ†ä»£å‡è¯´(Strong Gernerational Hypothisis): ç†¬è¿‡è¶Šå¤šæ¬¡åƒåœ¾å›æ”¶è¿‡ç¨‹çš„å¯¹è±¡å°±è¶Šéš¾ä»¥æ¶ˆäº¡  å †çš„åˆ†å¸ƒ ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥Javaå †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼šå†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEdenç©ºé—´ã€From Survivorã€To Survivorç©ºé—´ç­‰ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜.\næ³¨æ„: åƒåœ¾å›æ”¶ä¼šåº”ä¸ºGCæ”¶é›†å™¨ã€ç®—æ³•ã€é…ç½®ä¸åŒè€Œä¸åŒ\u0026hellip;åªèƒ½è°ˆä¸ªå¤§æ¦‚\nGC è¯æ±‡ GC åˆ†ç±»:\né’ˆå¯¹HotSpot VMçš„å®ç°ï¼Œå®ƒé‡Œé¢çš„GCå…¶å®å‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š\nPartial GCï¼šå¹¶ä¸æ”¶é›†æ•´ä¸ªGCå †çš„æ¨¡å¼ Young GCï¼šåªæ”¶é›†young gençš„GCã€Minor GC Old GCï¼šåªæ”¶é›†old gençš„GCã€‚åªæœ‰CMSçš„concurrent collectionæ˜¯è¿™ä¸ªæ¨¡å¼ Mixed GCï¼šæ”¶é›†æ•´ä¸ªyoung genä»¥åŠéƒ¨åˆ†old gençš„GCã€‚åªæœ‰G1æœ‰è¿™ä¸ªæ¨¡å¼ Full GCï¼šæ”¶é›†æ•´ä¸ªå †ï¼ŒåŒ…æ‹¬young genã€old genã€perm gen/metaspaceï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ç­‰æ‰€æœ‰éƒ¨åˆ†çš„æ¨¡å¼ã€‚\nMajor GCé€šå¸¸æ˜¯è·Ÿfull GCæ˜¯ç­‰ä»·çš„ï¼Œæ”¶é›†æ•´ä¸ªGCå †ã€‚ä½†å› ä¸ºHotSpot VMå‘å±•äº†è¿™ä¹ˆå¤šå¹´ï¼Œå¤–ç•Œå¯¹å„ç§åè¯çš„è§£è¯»å·²ç»å®Œå…¨æ··ä¹±äº†ï¼Œå½“æœ‰äººè¯´â€œmajor GCâ€çš„æ—¶å€™ä¸€å®šè¦é—®æ¸…æ¥šä»–æƒ³è¦æŒ‡çš„æ˜¯ä¸Šé¢çš„full GCè¿˜æ˜¯old GCã€‚\næˆ‘ä»¬åªè¦å…³æ³¨: YGC/FGC åŸºæœ¬å¯ä»¥è§£å†³é—®é¢˜.\nTODO/ä½œä¸š:\nserver å’Œ executor åˆ†åˆ«ç”¨äº†ä»€ä¹ˆåƒåœ¾æ”¶é›†å™¨? åŸºäºä»€ä¹ˆåƒåœ¾æ”¶é›†ç†è®º? ä»€ä¹ˆ GC ç®—æ³•? ä¼˜ç¼ºç‚¹æ˜¯å•¥å­  ä¸€èˆ¬æ€§çš„GCæµç¨‹ (GCæ”¶é›†å™¨ã€é…ç½®ã€GCç®—æ³•ä¸åŒè€Œä¸åŒ)\næ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰ï¼šå¤§å¤šæ•°å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­è¢«åˆ›å»ºï¼Œå…¶ä¸­å¾ˆå¤šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ã€‚æ¯æ¬¡æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼ˆåˆç§°Minor GCã€Young GCï¼‰ååªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»(ç»å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•ç­)ï¼Œæ‰€ä»¥é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦å°‘é‡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆå›æ”¶ã€‚\næ–°ç”Ÿä»£å†…åˆåˆ†ä¸‰ä¸ªåŒºï¼šä¸€ä¸ªEdenåŒºï¼Œä¸¤ä¸ªSurvivoråŒºï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨EdenåŒºä¸­ç”Ÿæˆã€‚å½“EdenåŒºæ»¡æ—¶ï¼Œè¿˜å­˜æ´»çš„å¯¹è±¡å°†è¢«å¤åˆ¶åˆ°ä¸¤ä¸ªSurvivoråŒºï¼ˆä¸­çš„ä¸€ä¸ªï¼‰ã€‚å½“è¿™ä¸ªSurvivoråŒºæ»¡æ—¶ï¼Œæ­¤åŒºçš„å­˜æ´»ä¸”ä¸æ»¡è¶³â€œæ™‹å‡â€æ¡ä»¶çš„å¯¹è±¡å°†è¢«å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªSurvivoråŒºã€‚å¯¹è±¡æ¯ç»å†ä¸€æ¬¡Minor GCï¼Œå¹´é¾„åŠ 1ï¼Œè¾¾åˆ°â€œæ™‹å‡å¹´é¾„é˜ˆå€¼â€åï¼Œè¢«æ”¾åˆ°è€å¹´ä»£ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸ºâ€œæ™‹å‡â€ã€‚æ˜¾ç„¶ï¼Œâ€œæ™‹å‡å¹´é¾„é˜ˆå€¼â€çš„å¤§å°ç›´æ¥å½±å“ç€å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­çš„åœç•™æ—¶é—´ï¼Œåœ¨Serialå’ŒParNew GCä¸¤ç§å›æ”¶å™¨ä¸­ï¼Œâ€œæ™‹å‡å¹´é¾„é˜ˆå€¼â€é€šè¿‡å‚æ•°MaxTenuringThresholdè®¾å®šï¼Œé»˜è®¤å€¼ä¸º15ã€‚ Survivorçš„å­˜åœ¨æ„ä¹‰ï¼Œå°±æ˜¯å‡å°‘è¢«é€åˆ°è€å¹´ä»£çš„å¯¹è±¡ï¼Œè¿›è€Œå‡å°‘Full GCçš„å‘ç”Ÿï¼ŒSurvivorçš„é¢„ç­›é€‰ä¿è¯ï¼Œåªæœ‰ç»å†16æ¬¡Minor GCè¿˜èƒ½åœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»çš„å¯¹è±¡ï¼Œæ‰ä¼šè¢«é€åˆ°è€å¹´ä»£ã€‚ ä½†è¿™ä¹Ÿä¸æ˜¯ä¸€å®šçš„ï¼Œå¯¹äºä¸€äº›è¾ƒå¤§çš„å¯¹è±¡ ( å³éœ€è¦åˆ†é…ä¸€å—è¾ƒå¤§çš„è¿ç»­å†…å­˜ç©ºé—´ ) åˆ™æ˜¯ç›´æ¥è¿›å…¥åˆ°è€å¹´ä»£ã€‚\nè€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼šåœ¨æ–°ç”Ÿä»£ä¸­ç»å†äº†Næ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°å¹´è€ä»£ï¼Œè¯¥åŒºåŸŸä¸­å¯¹è±¡å­˜æ´»ç‡é«˜ã€‚è€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼ˆåˆç§°Major GCï¼‰é€šå¸¸ä½¿ç”¨â€œæ ‡è®°-æ¸…ç†â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚æ•´å †åŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶ç§°ä¸ºFull GCï¼ˆHotSpot VMé‡Œï¼Œé™¤äº†CMSä¹‹å¤–ï¼Œå…¶å®ƒèƒ½æ”¶é›†è€å¹´ä»£çš„GCéƒ½ä¼šåŒæ—¶æ”¶é›†æ•´ä¸ªGCå †ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£ï¼‰ã€‚\nä¸€èˆ¬æ€§çš„ YGC/FGC YGCçš„æ—¶æœº:\nednç©ºé—´ä¸è¶³\nFGCçš„æ—¶æœºï¼š\n1.oldç©ºé—´ä¸è¶³ï¼›\n2.permç©ºé—´ä¸è¶³ï¼›(1.8 ä¸º metaspace)\n3.æ˜¾ç¤ºè°ƒç”¨System.gc()Â ï¼ŒåŒ…æ‹¬RMIç­‰çš„å®šæ—¶è§¦å‘;\n4.YGCæ—¶çš„æ‚²è§‚ç­–ç•¥ï¼›\n5.dump liveçš„å†…å­˜ä¿¡æ¯æ—¶(jmap â€“dump:live)ã€‚\nå¯¹YGCçš„Â è§¦å‘æ—¶æœºï¼Œç›¸å½“çš„æ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯edenç©ºé—´ä¸è¶³ï¼ŒÂ è¿™æ—¶å€™å°±è‚¯å®šä¼šè§¦å‘ygc\nå¯¹äºFGCçš„è§¦å‘æ—¶æœºï¼ŒÂ oldç©ºé—´ä¸è¶³ï¼ŒÂ å’Œpermçš„ç©ºé—´ä¸è¶³ï¼ŒÂ è°ƒç”¨system.gc()è¿™å‡ ä¸ªéƒ½æ¯”è¾ƒæ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒÂ ä¸€èˆ¬éƒ½ä¼šè§¦å‘GCã€‚\næœ€å¤æ‚çš„æ˜¯æ‰€è°“çš„æ‚²è§‚ç­–ç•¥ï¼Œå®ƒè§¦å‘çš„æœºåˆ¶æ˜¯åœ¨é¦–å…ˆä¼šè®¡ç®—ä¹‹å‰æ™‹å‡çš„å¹³å‡å¤§å°ï¼Œä¹Ÿå°±æ˜¯ä»æ–°ç”Ÿä»£ï¼Œé€šè¿‡ygcå˜æˆæ–°ç”Ÿä»£çš„å¹³å‡å¤§å°ï¼Œç„¶åå¦‚æœæ—§ç”Ÿä»£å‰©ä½™çš„ç©ºé—´å°äºæ™‹å‡å¤§å°ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ä¸€æ¬¡FullGCã€‚è€ƒè™‘çš„ç­–ç•¥æ˜¯ï¼ŒÂ ä»å¹³å‡å’Œé•¿è¿œçš„æƒ…å†µæ¥çœ‹ï¼Œä¸‹æ¬¡æ™‹å‡ç©ºé—´ä¸å¤Ÿçš„å¯èƒ½æ€§éå¸¸å¤§ï¼ŒÂ ä¸å…¶ç­‰åˆ°é‚£æ—¶å€™åœ¨fullGCÂ ä¸å¦‚æ‚²è§‚çš„è®¤ä¸ºä¸‹æ¬¡è‚¯å®šä¼šè§¦å‘FullGCï¼ŒÂ ç›´æ¥å…ˆæ‰§è¡Œä¸€æ¬¡FullGCã€‚è€Œä¸”ä»å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­æ¥çœ‹ï¼ŒÂ ä¹Ÿè¾¾åˆ°äº†æ¯”è¾ƒç¨³å®šçš„æ•ˆæœã€‚\nå †å†…å­˜çš„å…·ä½“åˆ†å¸ƒ é»˜è®¤çš„ï¼Œæ–°ç”Ÿä»£ ( Young ) ä¸è€å¹´ä»£ ( Old ) çš„æ¯”ä¾‹çš„å€¼ä¸º 1:2 ( è¯¥å€¼å¯ä»¥é€šè¿‡å‚æ•° â€“XX:NewRatio æ¥æŒ‡å®š )ï¼Œå³ï¼šæ–°ç”Ÿä»£ ( Young ) = 1\u0026frasl;3 çš„å †ç©ºé—´å¤§å°ã€‚è€å¹´ä»£ ( Old ) = 2\u0026frasl;3 çš„å †ç©ºé—´å¤§å°ã€‚å…¶ä¸­ï¼Œæ–°ç”Ÿä»£ ( Young ) è¢«ç»†åˆ†ä¸º Eden å’Œ ä¸¤ä¸ª Survivor åŒºåŸŸï¼Œè¿™ä¸¤ä¸ª Survivor åŒºåŸŸåˆ†åˆ«è¢«å‘½åä¸º from å’Œ toï¼Œä»¥ç¤ºåŒºåˆ†ã€‚ é»˜è®¤çš„ï¼ŒEdem : from : to = 8 : 1 : 1 ( å¯ä»¥é€šè¿‡å‚æ•° â€“XX:SurvivorRatio æ¥è®¾å®š )ï¼Œå³ï¼š Eden = 8\u0026frasl;10 çš„æ–°ç”Ÿä»£ç©ºé—´å¤§å°ï¼Œfrom = to = 1\u0026frasl;10 çš„æ–°ç”Ÿä»£ç©ºé—´å¤§å°ã€‚ JVM æ¯æ¬¡åªä¼šä½¿ç”¨ Eden å’Œå…¶ä¸­çš„ä¸€å— Survivor åŒºåŸŸæ¥ä¸ºå¯¹è±¡æœåŠ¡ï¼Œæ‰€ä»¥æ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œæ€»æ˜¯æœ‰ä¸€å— Survivor åŒºåŸŸæ˜¯ç©ºé—²ç€çš„ã€‚ å› æ­¤ï¼Œæ–°ç”Ÿä»£å®é™…å¯ç”¨çš„å†…å­˜ç©ºé—´ä¸º 9\u0026frasl;10 ( å³90% )çš„æ–°ç”Ÿä»£ç©ºé—´ã€‚ From SurvivoråŒºåŸŸä¸To SurvivoråŒºåŸŸæ˜¯äº¤æ›¿åˆ‡æ¢ç©ºé—´ï¼Œåœ¨åŒä¸€æ—¶é—´å†…ä¸¤è€…ä¸­åªæœ‰ä¸€ä¸ªä¸ä¸ºç©º\nâ€“XX:SurvivorRatio ä¸¤ä¸ª SurvivoråŒº å’Œ edenåŒº çš„æ¯”å€¼, é»˜è®¤ 8 æˆ‘ä»¬æœªæŒ‡å®š survivor : eden = 2 : 8 â€“XX:NewRatio æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”å€¼, é»˜è®¤ 4 æ–°/è€ = 1/4 -XX:MaxTenuringThreshold æ™‹å‡å¹´é¾„æœ€å¤§é˜ˆå€¼ï¼Œé»˜è®¤15ã€‚åœ¨æ–°ç”Ÿä»£ä¸­å¯¹è±¡å­˜æ´»æ¬¡æ•°(ç»è¿‡YGCçš„æ¬¡æ•°)åä»ç„¶å­˜æ´»ï¼Œå°±ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚æ¯ç»è¿‡ä¸€æ¬¡YGCï¼Œå¹´é¾„åŠ 1ï¼Œå½“survivoråŒºçš„å¯¹è±¡å¹´é¾„è¾¾åˆ°TenuringThresholdæ—¶ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯é•¿å­˜æ´»å¯¹è±¡ï¼Œå°±ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚ -XX:TargetSurvivorRatio è®¾å®šsurvivoråŒºçš„ç›®æ ‡ä½¿ç”¨ç‡ã€‚é»˜è®¤50ï¼Œå³survivoråŒºå¯¹è±¡ç›®æ ‡ä½¿ç”¨ç‡ä¸º50%ã€‚ JVMä¼šå°†æ¯ä¸ªå¯¹è±¡çš„å¹´é¾„ä¿¡æ¯ã€å„ä¸ªå¹´é¾„æ®µå¯¹è±¡çš„æ€»å¤§å°è®°å½•åœ¨â€œage tableâ€è¡¨ä¸­ã€‚åŸºäºâ€œage tableâ€ã€survivoråŒºå¤§å°ã€survivoråŒºç›®æ ‡ä½¿ç”¨ç‡ï¼ˆ-XX:TargetSurvivorRatioï¼‰ã€æ™‹å‡å¹´é¾„é˜ˆå€¼ï¼ˆ-XX:MaxTenuringThresholdï¼‰ï¼ŒJVMä¼šåŠ¨æ€çš„è®¡ç®—tenuring thresholdçš„å€¼ã€‚ä¸€æ—¦å¯¹è±¡å¹´é¾„è¾¾åˆ°äº†tenuring thresholdå°±ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚ ä¸ºä»€ä¹ˆè¦åŠ¨æ€çš„è®¡ç®—tenuring thresholdçš„å€¼å‘¢ï¼Ÿå‡è®¾æœ‰å¾ˆå¤šå¹´é¾„è¿˜æœªè¾¾åˆ°TenuringThresholdçš„å¯¹è±¡ä¾æ—§åœç•™åœ¨survivoråŒºï¼Œè¿™æ ·ä¸åˆ©äºæ–°å¯¹è±¡ä»edenæ™‹å‡åˆ°survivorã€‚å› æ­¤è®¾ç½®survivoråŒºçš„ç›®æ ‡ä½¿ç”¨ç‡ï¼Œå½“ä½¿ç”¨ç‡è¾¾åˆ°æ—¶é‡æ–°è°ƒæ•´TenuringThresholdå€¼ï¼Œè®©å¯¹è±¡å°½æ—©çš„å»oldåŒºã€‚ å¦‚æœå¸Œæœ›è·Ÿè¸ªæ¯æ¬¡æ–°ç”Ÿä»£GCåï¼ŒsurvivoråŒºä¸­å¯¹è±¡çš„å¹´é¾„åˆ†å¸ƒï¼Œå¯åœ¨å¯åŠ¨å‚æ•°ä¸Šå¢åŠ -XX:+PrintTenuringDistribution. æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥ï¼ŒæŒ‰HotSpot VMçš„serial GCçš„å®ç°æ¥çœ‹ï¼Œè§¦å‘æ¡ä»¶æ˜¯ï¼š\nyoung GCï¼šå½“young genä¸­çš„edenåŒºåˆ†é…æ»¡çš„æ—¶å€™è§¦å‘ã€‚æ³¨æ„young GCä¸­æœ‰éƒ¨åˆ†å­˜æ´»å¯¹è±¡ä¼šæ™‹å‡åˆ°old genï¼Œæ‰€ä»¥young GCåold gençš„å ç”¨é‡é€šå¸¸ä¼šæœ‰æ‰€å‡é«˜ã€‚\nfull GCï¼šå½“å‡†å¤‡è¦è§¦å‘ä¸€æ¬¡young GCæ—¶ï¼Œå¦‚æœå‘ç°ç»Ÿè®¡æ•°æ®è¯´ä¹‹å‰young GCçš„å¹³å‡æ™‹å‡å¤§å°æ¯”ç›®å‰old genå‰©ä½™çš„ç©ºé—´å¤§ï¼Œåˆ™ä¸ä¼šè§¦å‘young GCè€Œæ˜¯è½¬ä¸ºè§¦å‘full GCï¼ˆå› ä¸ºHotSpot VMçš„GCé‡Œï¼Œé™¤äº†CMSçš„concurrent collectionä¹‹å¤–ï¼Œå…¶å®ƒèƒ½æ”¶é›†old gençš„GCéƒ½ä¼šåŒæ—¶æ”¶é›†æ•´ä¸ªGCå †ï¼ŒåŒ…æ‹¬young genï¼Œæ‰€ä»¥ä¸éœ€è¦äº‹å…ˆè§¦å‘ä¸€æ¬¡å•ç‹¬çš„young GCï¼‰ï¼›\næˆ–è€…ï¼Œå¦‚æœæœ‰perm gençš„è¯ï¼Œè¦åœ¨perm genåˆ†é…ç©ºé—´ä½†å·²ç»æ²¡æœ‰è¶³å¤Ÿç©ºé—´æ—¶ï¼Œä¹Ÿè¦è§¦å‘ä¸€æ¬¡full GCï¼›æˆ–è€…System.gc()ã€heap dumpå¸¦GCï¼Œé»˜è®¤ä¹Ÿæ˜¯è§¦å‘full GCã€‚HotSpot VMé‡Œå…¶å®ƒéå¹¶å‘GCçš„è§¦å‘æ¡ä»¶å¤æ‚ä¸€äº›ï¼Œä¸è¿‡å¤§è‡´çš„åŸç†ä¸ä¸Šé¢è¯´çš„å…¶å®ä¸€æ ·ã€‚å½“ç„¶ä¹Ÿæ€»æœ‰ä¾‹å¤–ã€‚Parallel Scavengeï¼ˆ-XX:+UseParallelGCï¼‰æ¡†æ¶ä¸‹ï¼Œé»˜è®¤æ˜¯åœ¨è¦è§¦å‘full GCå‰å…ˆæ‰§è¡Œä¸€æ¬¡young GCï¼Œå¹¶ä¸”ä¸¤æ¬¡GCä¹‹é—´èƒ½è®©åº”ç”¨ç¨‹åºç¨å¾®è¿è¡Œä¸€å°ä¸‹ï¼Œä»¥æœŸé™ä½full GCçš„æš‚åœæ—¶é—´ï¼ˆå› ä¸ºyoung GCä¼šå°½é‡æ¸…ç†äº†young gençš„æ­»å¯¹è±¡ï¼Œå‡å°‘äº†full GCçš„å·¥ä½œé‡ï¼‰ã€‚æ§åˆ¶è¿™ä¸ªè¡Œä¸ºçš„VMå‚æ•°æ˜¯-XX:+ScavengeBeforeFullGCã€‚è¿™æ˜¯HotSpot VMé‡Œçš„å¥‡è‘©å—¯ã€‚å¯è·³ä¼ é€é—¨å›´è§‚ï¼šJVM full GCçš„å¥‡æ€ªç°è±¡ï¼Œæ±‚è§£æƒ‘ï¼Ÿ - RednaxelaFX çš„å›ç­”å¹¶å‘GCçš„è§¦å‘æ¡ä»¶å°±ä¸å¤ªä¸€æ ·ã€‚ä»¥CMS GCä¸ºä¾‹ï¼Œå®ƒä¸»è¦æ˜¯å®šæ—¶å»æ£€æŸ¥old gençš„ä½¿ç”¨é‡ï¼Œå½“ä½¿ç”¨é‡è¶…è¿‡äº†è§¦å‘æ¯”ä¾‹å°±ä¼šå¯åŠ¨ä¸€æ¬¡CMS GCï¼Œå¯¹old genåšå¹¶å‘æ”¶é›†ã€‚\nä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ª Survivor åŒº å¤åˆ¶ç®—æ³•\nå°†åŸæœ‰çš„å†…å­˜ç©ºé—´åˆ’åˆ†æˆä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå°†æ­£åœ¨ä½¿ç”¨çš„å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜åŒºåŸŸä¸­ï¼Œç„¶åæ¸…é™¤æ­£ä½¿ç”¨è¿‡çš„å†…å­˜åŒºåŸŸï¼Œäº¤æ¢ä¸¤ä¸ªåŒºåŸŸçš„è§’è‰²ï¼Œå®Œæˆåƒåœ¾å›æ”¶ã€‚ç„¶åä¸ºä»€ä¹ˆè¦åœ¨æ–°ç”Ÿä»£ä¸­ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼šå› ä¸ºæ–°ç”Ÿä»£gcæ¯”è¾ƒé¢‘ç¹ã€å¯¹è±¡å­˜æ´»ç‡ä½ï¼Œç”¨å¤åˆ¶ç®—æ³•åœ¨å›æ”¶æ—¶çš„æ•ˆç‡ä¼šæ›´é«˜ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ä½†å¤åˆ¶ç®—æ³•çš„ä»£ä»·å°±æ˜¯è¦å°†å†…å­˜æŠ˜åŠï¼Œä¸ºäº†ä¸æµªè´¹è¿‡å¤šçš„å†…å­˜ï¼Œå°±åˆ’åˆ†äº†ä¸¤å—ç›¸åŒå¤§å°çš„å†…å­˜åŒºåŸŸsurvivor fromå’Œsurvivor toã€‚åœ¨æ¯æ¬¡gcåå°±ä¼šæŠŠå­˜æ´»å¯¹è±¡ç»™å¤åˆ¶åˆ°å¦ä¸€ä¸ªsurvivorä¸Šï¼Œç„¶åæ¸…ç©ºEdenå’Œåˆšä½¿ç”¨è¿‡çš„survivorã€‚\nç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œä½ å¯ä»¥æ¨¡æ‹Ÿæ–°ç”Ÿä»£å›æ”¶ä¸¤æ¬¡çš„åœºæ™¯ã€‚å‡è®¾ç°åœ¨åªæœ‰ä¸€ä¸ªsåŒºï¼Œç¬¬ä¸€æ¬¡ï¼Œeæ»¡äº†ä¹‹åï¼Œä½ æŠŠæ´»å¾—å¯¹è±¡æ”¾åˆ°sï¼Œå¦‚æœæ­¤æ—¶åªæœ‰ä¸€ä¸ªsåŒºï¼Œé‚£ä¹ˆå½“ç¬¬äºŒæ¬¡eå»æ»¡äº†ä¹‹åï¼Œå°±æ²¡æœ‰såŒºå¯ç”¨äº†ï¼Œä¸ºäº†ä½¿ç¬¬äºŒæ¬¡GCèƒ½å¤Ÿè¿›è¡Œæ‰€ä»¥åœ¨åªæœ‰ä¸€ä¸ªså–å¾—æƒ…å†µä¸‹ä½ åªèƒ½ï¼ŒæŠŠsåŒºä¸­çš„æˆ–å¯¹è±¡å¤åˆ¶ä¸€éæ”¾åˆ°eåŒºï¼Œæ‰€ä»¥å¦‚æœæœ‰ä¸€ä¸ªsåŒºçš„è¯ï¼Œä¸€æ¬¡æ–°ç”Ÿä»£GCè¦å¤åˆ¶ä¸¤æ¬¡æ´»å¯¹è±¡ã€‚è€Œåœ¨æœ‰ä¸¤ä¸ªçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé—®é¢˜å°±å¯ä»¥é¿å…äº†ï¼ŒeåŒºæ»¡äº†ä¹‹åè¿›è¡Œç¬¬ä¸€æ¬¡GCï¼ŒæŠŠæ´»çš„å¯¹è±¡æ”¾å…¥s0,æ­¤æ—¶s1åŒºæ˜¯æ²¡è¢«ä½¿ç”¨çš„ï¼Œå½“ç¬¬äºŒæ¬¡GCçš„æ—¶å€™å†æŠŠeåŒºä¸­æ´»çš„å¯¹è±¡å’Œs0ä¸­æ´»çš„å¯¹è±¡ä¸€åŒæ”¾è¿›s1ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°åœ¨ä¸€æ¬¡GCä¸­ï¼Œä¸¤ä¸ªsåŒºä¼šæ¯”ä¸€ä¸ªsåŒºå°‘å¤åˆ¶ä¸€æ¬¡\né“¾æ¥ï¼šhttps://www.zhihu.com/question/44929481/answer/98052014\né“¾æ¥ï¼šhttps://www.zhihu.com/question/44929481/answer/98016105\nç¢ç‰‡åŒ–ã€ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªsurvivor https://blog.csdn.net/antony9118/article/details/51425581\nä»»åŠ¡:\næŸ¥çœ‹ inceptor ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆåƒåœ¾å›æ”¶å™¨ åˆ†åˆ«æ˜¯ç”¨äº†ä»€ä¹ˆç®—æ³•, æœ‰ä»€ä¹ˆå¥½å¤„? CMSInitiatingOccupancyFraction æ˜¯å•¥æ„æ€?  ç›´æ¥å†…å­˜ ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ã€‚è€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´ OutOfMemoryError å¼‚å¸¸å‡ºç°ã€‚\nJDK1.4 ä¸­æ–°åŠ å…¥çš„ NIO(New Input/Output) ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ ä¸ç¼“å­˜åŒºï¼ˆBufferï¼‰ çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ®ã€‚\næœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šæ”¶åˆ° Java å †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚(-XX:MaxDirectMemorySize)\nå¸¸ç”¨å‘½ä»¤ k8s ä¸Šæå…¶æ–¹ä¾¿çš„ç©æ³• kubectl exec -it xxx jps xx\nå¦‚æœåé¢è¦åŠ  flag å’‹åŠ?\nkubectl exec -it inceptor-server-inceptor2-b67857557-jjtjv \u0026ndash; jps -v\nç›´æ¥è¾“å‡ºåˆ°ç‰©ç†æœº kubectl exec -it inceptor-server-inceptor2-b67857557-jjtjv \u0026ndash; jps -v \u0026gt;\u0026gt; zz.log\njps JVM Process Status Tool, ç”¨äºåˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºè¿›ç¨‹. ç”¨äºæŸ¥çœ‹pod å†…æ˜¯å¦å­˜åœ¨è¿›ç¨‹æŒ‚æ‰/éªŒè¯æ˜¯å¦æ‰‹åŠ¨æ·»åŠ JVMå‚æ•°ã€‚ inceptor/slipstream å¯ä»¥é…åˆ grep æŸ¥è¯¢è™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„JVMå‚æ•°ã€‚æ˜¾ç¤ºæ²¡æœ‰jinfoå…¨ï¼Œä½†æ˜¯å¤Ÿç”¨ã€‚\n[root@linux-158-15 ~]# jps -v | more 43 InceptorServer2 -agentpath:/usr/lib/inceptor/bin/libagent.so -XX:MetaspaceSiz e=512m -XX:MaxMetaspaceSize=2g -Djava.net.preferIPv4Stack=true -Dsun.net.inetadd r.ttl=60 -XX:+UseParNewGC -XX:NewRatio=4 -XX:+CMSClassUnloadingEnabled -XX:MinHe apFreeRatio=100 -XX:MaxHeapFreeRatio=100 -XX:CMSMaxAbortablePrecleanTime=1000 -X X:+ExplicitGCInvokesConcurrent -XX:MaxTenuringThreshold=4 -XX:TargetSurvivorRati o=8 -XX:+HeapDumpOnOutOfMemoryError -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOcc upancyFraction=70 -Xms2048m -Xmx8192m -verbose:gc -XX:+PrintGCDetails -XX:+Print GCDateStamps -XX:+PrintGCTimeStamps -Djava.library.path=/usr/lib/hadoop/lib/nati ve -Dspark.akka.threads=8 -Dspark.akka.threads=8 -Dspark.rdd.compress=false -Dsp ark.storage.memoryFraction=0.5 -Dspark.driver.host=linux-158-15 -Dclass.default. serializer= -Dspark.fastdisk.dir=/vdir/mnt/ramdisk/ngmr -Dspark.storage.fastdisk Fraction=0.5 -Dngmr.task.pipeline=false -Dngmr.task.pipeline.start.fraction=0.5 -Dngmr.task.pipeline.task.timeout.ms=-1 -Dspark.local.dir=/vdir/mnt/disk1/hadoop /ng jinfo Configuration Info for Java, å®æ—¶æŸ¥çœ‹è™šæ‹Ÿæœºå„é¡¹å‚æ•°ï¼Œæ¶µç›–æ˜¾å¼å’Œé»˜è®¤ç­‰ç­‰ï¼Œå¤šå„¿å…¨ã€‚\njinfo pid (slipstream executor) Attaching to process ID 50, please wait... Debugger attached successfully. Server compiler detected. JVM version is 25.25-b02 Java System Properties: spark.storage.fastdiskFraction = 0.3 java.vendor = Oracle Corporation inceptor.executorID.zkPath = /slipstream2/executorID sun.java.launcher = SUN_STANDARD sun.management.compiler = HotSpot 64-Bit Tiered Compilers sun.nio.ch.bugLevel = ngmr.engine = morphling spark.network.numberOfBuffers = 10240 os.name = Linux ngmr.task.pipeline.task.timeout.ms = -1 sun.boot.class.path = /usr/java/jdk1.8.0_25/jre/lib/resources.jar:/usr/java/jdk1.8.0_25/jre/lib/rt.jar:/usr/java/jdk1.8.0_25/jre/lib/sunrsasign.jar:/usr/java/jdk1.8.0_25/jre/lib/jsse.jar:/usr/java/jdk1.8.0_25/jre/lib/jce.jar:/usr/java/jdk1.8.0_25/jre/lib/charsets.jar:/usr/java/jdk1.8.0_25/jre/lib/jfr.jar:/usr/java/jdk1.8.0_25/jre/classes spark.network.client.numThreads = 0 java.vm.specification.vendor = Oracle Corporation slipstream.metrics.gateway.host = linux-pm-0-37 java.runtime.version = 1.8.0_25-b17 spark.network.server.numThreads = 0 inceptor.log.dir = /var/log/slipstream2 user.name = hive sun.net.inetaddr.ttl = 60 transwarp.io.netty.noKeySetOptimization = true user.language = en sun.boot.library.path = /usr/java/jdk1.8.0_25/jre/lib/amd64 ngmr.task.pipeline.start.fraction = 0.5 spark.fastdisk.dir = /vdir/mnt/ramdisk/ngmr java.version = 1.8.0_25 spark.kerberos.keytabs = /etc/slipstream2/conf/slipstream.keytab user.timezone = Asia/Shanghai java.net.preferIPv4Stack = true spark.rdd.compress = false sun.arch.data.model = 64 java.endorsed.dirs = /usr/java/jdk1.8.0_25/jre/lib/endorsed sun.cpu.isalist = sun.jnu.encoding = UTF-8 file.encoding.pkg = sun.io spark.kerberos.principal = hive/_HOST@TDH file.separator = / java.specification.name = Java Platform API Specification java.class.version = 52.0 user.country = US java.home = /usr/java/jdk1.8.0_25/jre java.vm.info = mixed mode spark.storage.memoryFraction = 0.5 os.version = 3.10.0-693.el7.x86_64 path.separator = : java.vm.version = 25.25-b02 ngmr.task.pipeline = false java.awt.printerjob = sun.print.PSPrinterJob spark.network.server.backlog = 5 sun.io.unicode.encoding = UnicodeLittle awt.toolkit = sun.awt.X11.XToolkit user.home = /home/hive transwarp.io.netty.noUnsafe = true java.specification.vendor = Oracle Corporation spark.shuffle.io.preferDirectBufs = true spark.shuffle.io.numConnectionsPerPeer = 5 java.library.path = /usr/lib/hadoop/lib/native java.vendor.url = http://java.oracle.com/ java.vm.vendor = Oracle Corporation java.runtime.name = Java(TM) SE Runtime Environment sun.java.command = io.transwarp.nucleon.executor.CoarseGrainedExecutorBackend akka.tcp://sparkDriver@linux-pm-0-37:52888/user/CoarseGrainedScheduler 0 linux-pm-0-38 30 java.class.path = /etc/slipstream2/conf:/etc/hdfs1/conf:/etc/yarn1/conf:/etc/hyperbase1/conf::/usr/lib/guardian-plugins/lib/*:/usr/lib/inceptor/lib/HikariCP-2.6.1.jar:/usr/lib/inceptor/lib/JavaEWAH-0.3.2.jar:/usr.......ç­‰ç­‰ java.vm.specification.name = Java Virtual Machine Specification java.vm.specification.version = 1.8 sun.cpu.endian = little sun.os.patch.level = unknown java.io.tmpdir = /tmp spark.memory.segmentSize = 32768 inceptor.executorID.zkTimeout = 10000 java.vendor.url.bug = http://bugreport.sun.com/bugreport/ transwarp.io.netty.recycler.maxCapacityPerThread = 0 spark.network.client.connectTimeoutSec = 120 spark.network.sendAndReceiveBuffer = 0 inceptor.executorID.zkServer = linux-pm-0-37,linux-pm-0-38,linux-pm-0-40 os.arch = amd64 java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment class.default.serializer = java.ext.dirs = /usr/java/jdk1.8.0_25/jre/lib/ext:/usr/java/packages/lib/ext user.dir = /home/hive inceptor.executorID.zkPort = 2181 spark.local.dir = /vdir/mnt/disk1/hadoop/ngmr/slipstream2,/vdir/mnt/disk2/hadoop/ngmr/slipstream2,/vdir/mnt/disk3/hadoop/ngmr/slipstream2,/vdir/mnt/disk4/hadoop/ngmr/slipstream2,/vdir/mnt/disk5/hadoop/ngmr/slipstream2 line.separator = java.vm.name = Java HotSpot(TM) 64-Bit Server VM java.security.auth.login.config = /etc/slipstream2/conf/jaas.conf inceptor.authentication = kerberos file.encoding = UTF-8 java.specification.version = 1.8 spark.akka.threads = 8 inceptor.log.file = inceptor-executor.log VM Flags: Non-default VM flags: -XX:CICompilerCount=15 -XX:+CMSClassUnloadingEnabled -XX:CMSInitiatingOccupancyFraction=55 -XX:CMSMaxAbortablePrecleanTime=1000 -XX:+ExplicitGCInvokesConcurrent -XX:+HeapDumpOnOutOfMemoryError -XX:InitialHeapSize=33554432000 -XX:InitialTenuringThreshold=4 -XX:MaxDirectMemorySize=34359738368 -XX:MaxHeapFreeRatio=100 -XX:MaxHeapSize=33554432000 -XX:MaxMetaspaceSize=268435456 -XX:MaxNewSize=6710886400 -XX:MaxTenuringThreshold=4 -XX:MetaspaceSize=268435456 -XX:MinHeapDeltaBytes=196608 -XX:MinHeapFreeRatio=99 -XX:NewRatio=4 -XX:NewSize=6710886400 -XX:OldPLABSize=16 -XX:OldSize=26843545600 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:TargetSurvivorRatio=8 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:+UseParNewGC Command line: -agentpath:/usr/lib/inceptor/bin/libagent.so -Dsun.net.inetaddr.ttl=60 -Djava.net.preferIPv4Stack=true -Dspark.akka.threads=8 -Dspark.rdd.compress=false -Dspark.storage.memoryFraction=0.5 -Dclass.default.serializer= -Dspark.fastdisk.dir=/vdir/mnt/ramdisk/ngmr -Dspark.storage.fastdiskFraction=0.3 -Dngmr.task.pipeline=false -Dngmr.task.pipeline.start.fraction=0.5 -Dngmr.task.pipeline.task.timeout.ms=-1 -verbose:gc -Xloggc:/var/log/slipstream2/inceptor-executor.gc.log -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -Dspark.local.dir=/vdir/mnt/disk1/hadoop/ngmr/slipstream2,/vdir/mnt/disk2/hadoop/ngmr/slipstream2,/vdir/mnt/disk3/hadoop/ngmr/slipstream2,/vdir/mnt/disk4/hadoop/ngmr/slipstream2,/vdir/mnt/disk5/hadoop/ngmr/slipstream2 -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=256m -Djava.library.path=/usr/lib/hadoop/lib/native -Dinceptor.executorID.zkPath=/slipstream2/executorID -Dinceptor.executorID.zkServer=linux-pm-0-37,linux-pm-0-38,linux-pm-0-40 -Dinceptor.executorID.zkPort=2181 -Dinceptor.executorID.zkTimeout=10000 -XX:MaxDirectMemorySize=32G -Xms32000m -Xmx32000m -XX:+UseParNewGC -XX:NewRatio=4 -XX:+CMSClassUnloadingEnabled -XX:MinHeapFreeRatio=100 -XX:MaxHeapFreeRatio=100 -XX:CMSMaxAbortablePrecleanTime=1000 -XX:+ExplicitGCInvokesConcurrent -XX:MaxTenuringThreshold=4 -XX:TargetSurvivorRatio=8 -XX:+HeapDumpOnOutOfMemoryError -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=55 -Dinceptor.log.dir=/var/log/slipstream2 -Dinceptor.log.file=inceptor-executor.log -Dinceptor.authentication=kerberos -Dspark.kerberos.keytabs=/etc/slipstream2/conf/slipstream.keytab -Dspark.kerberos.principal=hive/_HOST@TDH -Dngmr.engine=morphling -Dspark.network.sendAndReceiveBuffer=0 -Dspark.network.numberOfBuffers=10240 -Dspark.memory.segmentSize=32768 -Dspark.network.server.numThreads=0 -Dspark.network.client.numThreads=0 -Dspark.network.client.connectTimeoutSec=120 -Dspark.shuffle.io.preferDirectBufs=true -Dspark.shuffle.io.numConnectionsPerPeer=5 -Dspark.network.server.backlog=5 -Dslipstream.metrics.gateway.host=linux-pm-0-37 -Djava.security.auth.login.config=/etc/slipstream2/conf/jaas.conf https://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html\njstat https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html\n-gcï¼šç›‘è§† JAVA å †æƒ…å†µï¼Œå¸¸ç”¨æŸ¥çœ‹ gc å®¹é‡æƒ…å†µçš„å·¥å…·\n-gcutilï¼šä¸»è¦å…³æ³¨ç™¾åˆ†æ¯”ä¿¡æ¯\n-gccauseï¼šå’Œç™¾åˆ†æ¯”è¾“å‡ºä¸€æ ·ï¼Œå¤šä¸€ä¸ªä¸Šæ¬¡åƒåœ¾æ”¶é›†äº§ç”ŸåŸå›  å»ºè®®ä½¿ç”¨ -gccause æ”¶é›† GC ä¿¡æ¯ï¼ï¼ï¼\nLGCCï¼šCause of last Garbage Collection GCCï¼šCause of current Garbage Collection YGC ï¼šå¯¹æ–°ç”Ÿä»£å †è¿›è¡ŒGCã€‚é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡çš„å­˜æ´»å¯¿å‘½è¾ƒçŸ­ï¼Œåœ¨æ–°ç”Ÿä»£é‡Œè¢«å›æ”¶ã€‚æ€§èƒ½è€—è´¹è¾ƒå°ã€‚ FGC ï¼šå…¨å †èŒƒå›´çš„GCã€‚é»˜è®¤å †ç©ºé—´ä½¿ç”¨åˆ°è¾¾80%(å¯è°ƒæ•´)çš„æ—¶å€™ä¼šè§¦å‘FGCã€‚\n[root@linux-158-15 ~]# jstat -gccause 43 2 5 S0 S1 E O M CCS YGC YGCT FGC FGCT GCT LGCC GCC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC ä»¥ä¸Šè¡¨æ˜è¯¥ inceptor server æ–°ç”Ÿä»£EdenåŒºï¼ˆEï¼‰ä½¿ç”¨äº† 56% çš„ç©ºé—´ï¼Œä¸¤ä¸ªSurvivor åŒºï¼ˆSurvivor0ã€Survivor1ï¼‰ï¼Œè€å¹´ä»£ï¼ˆO) å’Œ å…ƒç©ºé—´ï¼ˆMï¼‰ï¼Œç¨‹åºè¿è¡Œä»¥æ¥å‘ç”Ÿäº† 32 æ¬¡ Minor GCï¼ˆYGC Young GCï¼‰ï¼Œæ€»è€—æ—¶ 2.6 sï¼Œå‘ç”Ÿ Full GC ï¼ˆFGCï¼‰5æ¬¡ï¼Œæ€»è€—æ—¶ 7sï¼Œä¸Šæ¬¡GCï¼ˆLGCCï¼‰ æ˜¯å› ä¸º Allocation Failure ï¼ˆAllocation Failureï¼š è¡¨æ˜æœ¬æ¬¡å¼•èµ·GCçš„åŸå› æ˜¯å› ä¸ºåœ¨å¹´è½»ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´èƒ½å¤Ÿå­˜å‚¨æ–°çš„æ•°æ®äº†ï¼‰ï¼Œç°åœ¨æ²¡æœ‰åœ¨GC ï¼ˆGCCï¼‰\npsï¼šæ–¹æ³•åŒº P (æˆ–æ°¸ä¹…ä»£)ï¼Œç”¨æ¥å­˜æ”¾classï¼ŒMethodç­‰å…ƒæ•°æ®ä¿¡æ¯ï¼Œä½†åœ¨JDK1.8å·²ç»æ²¡æœ‰äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯MetaSpace(å…ƒç©ºé—´)ï¼Œå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºé‡Œé¢ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚\nä¸ºä»€ä¹ˆè¦ç”¨å…ƒç©ºé—´ä»£æ›¿æ°¸ä¹…ä»£ï¼Ÿ (1) ç±»ä»¥åŠæ–¹æ³•çš„ä¿¡æ¯æ¯”è¾ƒéš¾ç¡®å®šå…¶å¤§å°ï¼Œå› æ­¤å¯¹äºæ°¸ä¹…ä»£çš„æŒ‡å®šæ¯”è¾ƒå›°éš¾ï¼Œå¤ªå°å®¹æ˜“å¯¼è‡´æ°¸ä¹…ä»£æº¢å‡ºï¼Œå¤ªå¤§å®¹æ˜“å¯¼è‡´è€å¹´ä»£æº¢å‡ºã€‚ (2) æ°¸ä¹…ä»£ä¼šç»™GCå¸¦æ¥ä¸éœ€è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½ã€‚ (3) Oracleå¯èƒ½ä¼šå°†HotSpotå’ŒJrockitåˆäºŒä¸ºä¸€ã€‚\nCCS: Compressed class space utilization as a percentage.\nYGC å’Œ Survivor ^C[root@linux-pm-158-51 ~]# jstat -gcutil 47 5s S0 S1 E O M CCS YGC YGCT FGC FGCT GCT 0.00 19.66 54.19 27.52 98.97 97.97 39 1.932 0 0.000 1.932 0.00 19.66 61.45 27.52 98.97 97.97 39 1.932 0 0.000 1.932 0.00 19.66 74.16 27.52 98.97 97.97 39 1.932 0 0.000 1.932 52.19 0.00 30.43 27.94 98.87 98.07 40 1.972 0 0.000 1.972 52.19 0.00 63.37 27.94 98.87 98.07 40 1.972 0 0.000 1.972 52.19 0.00 67.65 27.94 98.87 98.07 40 1.972 0 0.000 1.972 52.19 0.00 83.11 27.94 98.87 98.07 40 1.972 0 0.000 1.972 0.00 63.95 14.55 28.95 98.87 98.15 41 2.021 0 0.000 2.021 81.82 0.00 7.30 30.05 98.83 98.19 42 2.098 0 0.000 2.098 81.82 0.00 44.98 30.05 98.83 98.19 42 2.098 0 0.000 2.098 81.82 0.00 69.58 30.05 98.83 98.19 42 2.098 0 0.000 2.098 81.82 0.00 69.73 30.05 98.83 98.19 42 2.098 0 0.000 2.098 0.00 56.05 17.56 31.32 98.90 98.19 43 2.137 0 0.000 2.137 0.00 56.05 37.69 31.32 98.90 98.19 43 2.137 0 0.000 2.137 44.39 0.00 40.69 32.05 98.95 98.19 44 2.222 0 0.000 2.222 44.39 0.00 90.69 32.05 98.95 98.19 44 2.222 0 0.000 2.222 0.00 44.85 19.95 32.76 99.01 98.20 45 2.308 0 0.000 2.308 0.00 44.85 21.26 32.76 99.01 98.20 45 2.308 0 0.000 2.308 0.00 44.85 33.22 32.76 99.01 98.20 45 2.308 0 0.000 2.308 0.00 29.63 43.46 33.68 98.91 98.20 47 2.453 0 0.000 2.453 24.94 0.00 93.40 34.12 98.92 98.20 48 2.549 0 0.000 2.549 24.94 0.00 95.36 34.12 98.92 98.20 48 2.549 0 0.000 2.549 24.94 0.00 96.11 34.12 98.92 98.20 48 2.549 0 0.000 2.549 S0C: Current survivor space 0 capacity (kB).\nS1C: Current survivor space 1 capacity (kB).\nS0U: Survivor space 0 utilization (kB).\nS1U: Survivor space 1 utilization (kB).\nEC: Current eden space capacity (kB).\nEU: Eden space utilization (kB).\nOC: Current old space capacity (kB).\nOU: Old space utilization (kB).\nMC: Metaspace capacity (kB).\nMU: Metacspace utilization (kB).\nCCSC: Compressed class space capacity (kB).\nCCSU: Compressed class space used (kB).\nYGC: Number of young generation garbage collection events.\nYGCT: Young generation garbage collection time.\nFGC: Number of full GC events.\nFGCT: Full garbage collection time.\nGCT: Total garbage collection time.\nThoughts https://www.oracle.com/technetwork/java/tuning-139912.html\n-XX:TargetSurvivorRatio=8 å¹¶æ²¡æœ‰ç”Ÿæ•ˆ(è¿˜å¥½è¿˜å¥½), but why?\nageTable.cpp\njmap Memory Map for Java, ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§\njmap -heap 47\næ˜¾ç¤ºå †ä¸­å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡ jmap -histo:live ${JAVA_PID} ã€ä¸€èˆ¬ç®€ç§°ä¸ºjmapï¼ˆç»Ÿè®¡ä¿¡æ¯ï¼‰ã€‘ç›¸å…³æ•ˆæœï¼š è§¦å‘ä¸€æ¬¡å¸¸è§„full gc jmap -dump:live,format=b,file=${FILE_PATH} ${JAVA_PID} ã€ä¸€èˆ¬ç®€ç§°ä¸ºheapdumpã€‘ ç›¸å…³æ•ˆæœï¼š è§¦å‘ä¸€æ¬¡å¸¸è§„full gcï¼Œå°†æ‰€æœ‰liveå¯¹è±¡å†™å…¥æ–‡ä»¶ã€‚ æ“ä½œåŠæ³¨æ„äº‹é¡¹ï¼š a. ç”±äºliveå¯¹è±¡æ€»å¤§å°æœ€å¤§å¯èƒ½è¾¾åˆ°å †å¤§å°(-XmxæŒ‡å®š)ï¼Œç”šè‡³ç”±äºå­˜å‚¨æ ¼å¼é—®é¢˜è¾¾åˆ°æ›´å¤§ï¼Œæ³¨æ„å­˜å‚¨æ–‡ä»¶çš„ç£ç›˜å¯ç”¨ç©ºé—´ã€‚ b. ä¸€èˆ¬å¯å…ˆä½¿ç”¨histoåˆ†æä¸€ä¸‹æ´»å¯¹è±¡æ€»å¤§å°ï¼Œä»¥æ­¤ä¼°è®¡æ–‡ä»¶å¤§å°ã€‚ c. ç½‘ç»œä¼ è¾“è¯¥æ–‡ä»¶å¼ºçƒˆå»ºè®®å…ˆé‡‡ç”¨å¸¸è§å‹ç¼©.tar.gzç­‰ï¼Œå‹ç¼©ç‡å¯è¾¾10å€ã€‚ ps: æŒç»­ FGC å¯èƒ½å‡ºç° Unable to open socket file çš„é”™è¯¯ï¼Œå› ä¸ºå½“å‰Javaè¿›ç¨‹ä¸€ç›´åœ¨æŒç»­çš„GCï¼Œè€Œåœ¨GCæœŸé—´javaè¿›ç¨‹æ˜¯ä¸å“åº”å¤–éƒ¨jmapè¯·æ±‚ï¼Œå»ºè®®ä¸€é¡¿çŒ›æ‰“ï¼Œæ— é—´éš”æŒç»­åœ°å°è¯•jmapå‘½ä»¤ä¸€å®šæ—¶é—´ï¼ˆä¸è¶…è¿‡2åˆ†é’Ÿï¼‰ï¼Œä¸€èˆ¬åœ¨å…¶ä¸­å¯ä»¥æœ‰æ¦‚ç‡æˆåŠŸæ‰“å‡ºjmapã€‚\npps: ç”± live å¼•èµ·çš„ FGC å¯ä»¥åœ¨GCæ—¥å¿—çœ‹åˆ°:Heap Inspection Initiated GC æ ‡å¿—\njstack Stack Trace for Java, ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼Œçº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ ç›®çš„é€šå¸¸æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´æŒ‚ èµ·ç­‰ï¼Œéƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚çº¿ç¨‹å‡ºç°åœé¡¿æ—¶é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œ å°±å¯ä»¥è·çŸ¥æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ç€ä»€ä¹ˆèµ„æºã€‚\nä¸€èˆ¬å­˜åœ¨ incepto job å¡æ­»ï¼Œç­‰æƒ…å†µéœ€è¦ç”¨åˆ°ï¼Œéš” x ç§’æ‰“å‡ ä¸ªã€‚\njstack pid å¯å°è¯•â€œsu hiveâ€ï¼Œå†æ‰“jstackä¿¡æ¯ã€‚ sudo -u hive /usr/java/latest/bin/jstack {PID} Slipstream å¸¸ç”¨åˆ†æ (å¾…ç»­) -XX:CMSInitiatingOccupancyFraction=70 CMSåƒåœ¾æ”¶é›†å™¨ï¼Œå½“è€å¹´ä»£è¾¾åˆ°70%æ—¶ï¼Œè§¦å‘CMSåƒåœ¾å›æ”¶ã€‚\nä½œä¸š é˜…è¯»:\nå¸¸è§OOMæŠ¥é”™ https://my.oschina.net/huyuBlog/blog/1788473\nRef ã€Šæ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºã€‹\næ·±å…¥ç†è§£JVMè™šæ‹Ÿæœº ç¬”è®° https://www.cnblogs.com/chanshuyi/p/jvm_serial_00_why_learn_jvm.html\nã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹\næ€»ç»“å›¾ https://www.zhihu.com/question/29833675\nä¸ºä»€ä¹ˆ 32 ä½ JVM æœ€å¤šä½¿ç”¨ 4G å†…å­˜.\nhttps://xiaozhuanlan.com/topic/1847690325#section153permgenmetaspace\nåˆ†ä»£ç†è®º https://blog.csdn.net/Muyundefeng/article/details/72667863\nä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ª survivor åŒº https://blog.csdn.net/antony9118/article/details/51425581\nJVM å‚æ•°è§£æ https://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html\nGCåˆ†ä»£æ”¶é›† https://juejin.im/post/5b6b986c6fb9a04fd1603f4a\nGC åˆ†ç±» ä½œè€…ï¼šRednaxelaFX é“¾æ¥ï¼šhttps://www.zhihu.com/question/41922036/answer/93079526\n","href":"/java/jvm%E5%8E%9F%E7%90%86%E5%85%A5%E9%97%A8/","title":"JVMåŸç†å…¥é—¨"},{"content":" Java åŸºç¡€è¿ç»´å·¥å…·ä½¿ç”¨   jps JVM Process Status Tool, ç”¨äºåˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºè¿›ç¨‹. ç”¨äºæŸ¥çœ‹pod å†…æ˜¯å¦å­˜åœ¨è¿›ç¨‹æŒ‚æ‰/éªŒè¯æ˜¯å¦æ‰‹åŠ¨æ·»åŠ JVMå‚æ•°ã€‚ inceptor/slipstream å¯ä»¥é…åˆ grep æŸ¥è¯¢è™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„JVMå‚æ•°ã€‚æ˜¾ç¤ºæ²¡æœ‰jinfoå…¨ï¼Œä½†æ˜¯å¤Ÿç”¨ã€‚\n[root@linux-158-15 ~]# jps -v | more 43 InceptorServer2 -agentpath:/usr/lib/inceptor/bin/libagent.so -XX:MetaspaceSiz e=512m -XX:MaxMetaspaceSize=2g -Djava.net.preferIPv4Stack=true -Dsun.net.inetadd r.ttl=60 -XX:+UseParNewGC -XX:NewRatio=4 -XX:+CMSClassUnloadingEnabled -XX:MinHe apFreeRatio=100 -XX:MaxHeapFreeRatio=100 -XX:CMSMaxAbortablePrecleanTime=1000 -X X:+ExplicitGCInvokesConcurrent -XX:MaxTenuringThreshold=4 -XX:TargetSurvivorRati o=8 -XX:+HeapDumpOnOutOfMemoryError -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOcc upancyFraction=70 -Xms2048m -Xmx8192m -verbose:gc -XX:+PrintGCDetails -XX:+Print GCDateStamps -XX:+PrintGCTimeStamps -Djava.library.path=/usr/lib/hadoop/lib/nati ve -Dspark.akka.threads=8 -Dspark.akka.threads=8 -Dspark.rdd.compress=false -Dsp ark.storage.memoryFraction=0.5 -Dspark.driver.host=linux-158-15 -Dclass.default. serializer= -Dspark.fastdisk.dir=/vdir/mnt/ramdisk/ngmr -Dspark.storage.fastdisk Fraction=0.5 -Dngmr.task.pipeline=false -Dngmr.task.pipeline.start.fraction=0.5 -Dngmr.task.pipeline.task.timeout.ms=-1 -Dspark.local.dir=/vdir/mnt/disk1/hadoop /ng jstat JVM Statistics Monitoring Tool, ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯ã€‚\njstat [ option vmid [interval[s|ms] [count]] ] æ¯200æ¯«ç§’æŸ¥è¯¢ä¸€æ¬¡ è¿›ç¨‹43 çš„åƒåœ¾æ”¶é›†æƒ…å†µï¼Œä¸€å…±æŸ¥è¯¢5æ¬¡ jstat -gc 43 200 5 2 ç§’ jstat -gc 43 2s 5 jstat å¸¸ç”¨é€‰é¡¹ https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html\n-gcï¼šç›‘è§† JAVA å †æƒ…å†µï¼Œå¸¸ç”¨æŸ¥çœ‹ gc å®¹é‡æƒ…å†µçš„å·¥å…·\n-gcutilï¼šä¸»è¦å…³æ³¨ç™¾åˆ†æ¯”ä¿¡æ¯\n-gccauseï¼šå’Œç™¾åˆ†æ¯”è¾“å‡ºä¸€æ ·ï¼Œå¤šä¸€ä¸ªä¸Šæ¬¡åƒåœ¾æ”¶é›†äº§ç”ŸåŸå›  å»ºè®®ä½¿ç”¨ -gccause æ”¶é›† GC ä¿¡æ¯ï¼ï¼ï¼\nLGCCï¼šCause of last Garbage Collection GCCï¼šCause of current Garbage Collection YGC ï¼šå¯¹æ–°ç”Ÿä»£å †è¿›è¡ŒGCã€‚é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡çš„å­˜æ´»å¯¿å‘½è¾ƒçŸ­ï¼Œåœ¨æ–°ç”Ÿä»£é‡Œè¢«å›æ”¶ã€‚æ€§èƒ½è€—è´¹è¾ƒå°ã€‚ FGC ï¼šå…¨å †èŒƒå›´çš„GCã€‚é»˜è®¤å †ç©ºé—´ä½¿ç”¨åˆ°è¾¾80%(å¯è°ƒæ•´)çš„æ—¶å€™ä¼šè§¦å‘FGCã€‚\n[root@linux-158-15 ~]# jstat -gccause 43 2 5 S0 S1 E O M CCS YGC YGCT FGC FGCT GCT LGCC GCC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC 20.61 0.00 56.14 3.41 98.85 98.17 32 2.696 5 7.225 9.921 Allocation Failure No GC ä»¥ä¸Šè¡¨æ˜è¯¥ inceptor server æ–°ç”Ÿä»£EdenåŒºï¼ˆEï¼‰ä½¿ç”¨äº† 56% çš„ç©ºé—´ï¼Œä¸¤ä¸ªSurvivor åŒºï¼ˆSurvivor0ã€Survivor1ï¼‰ï¼Œè€å¹´ä»£ï¼ˆO) å’Œ å…ƒç©ºé—´ï¼ˆMï¼‰ï¼Œç¨‹åºè¿è¡Œä»¥æ¥å‘ç”Ÿäº† 32 æ¬¡ Minor GCï¼ˆYGC Young GCï¼‰ï¼Œæ€»è€—æ—¶ 2.6 sï¼Œå‘ç”Ÿ Full GC ï¼ˆFGCï¼‰5æ¬¡ï¼Œæ€»è€—æ—¶ 7sï¼Œä¸Šæ¬¡GCï¼ˆLGCCï¼‰ æ˜¯å› ä¸º Allocation Failure ï¼ˆAllocation Failureï¼š è¡¨æ˜æœ¬æ¬¡å¼•èµ·GCçš„åŸå› æ˜¯å› ä¸ºåœ¨å¹´è½»ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´èƒ½å¤Ÿå­˜å‚¨æ–°çš„æ•°æ®äº†ï¼‰ï¼Œç°åœ¨æ²¡æœ‰åœ¨GC ï¼ˆGCCï¼‰\npsï¼šæ–¹æ³•åŒº P (æˆ–æ°¸ä¹…ä»£)ï¼Œç”¨æ¥å­˜æ”¾classï¼ŒMethodç­‰å…ƒæ•°æ®ä¿¡æ¯ï¼Œä½†åœ¨JDK1.8å·²ç»æ²¡æœ‰äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯MetaSpace(å…ƒç©ºé—´)ï¼Œå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºé‡Œé¢ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚\nä¸ºä»€ä¹ˆè¦ç”¨å…ƒç©ºé—´ä»£æ›¿æ°¸ä¹…ä»£ï¼Ÿ (1) ç±»ä»¥åŠæ–¹æ³•çš„ä¿¡æ¯æ¯”è¾ƒéš¾ç¡®å®šå…¶å¤§å°ï¼Œå› æ­¤å¯¹äºæ°¸ä¹…ä»£çš„æŒ‡å®šæ¯”è¾ƒå›°éš¾ï¼Œå¤ªå°å®¹æ˜“å¯¼è‡´æ°¸ä¹…ä»£æº¢å‡ºï¼Œå¤ªå¤§å®¹æ˜“å¯¼è‡´è€å¹´ä»£æº¢å‡ºã€‚ (2) æ°¸ä¹…ä»£ä¼šç»™GCå¸¦æ¥ä¸éœ€è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½ã€‚ (3) Oracleå¯èƒ½ä¼šå°†HotSpotå’ŒJrockitåˆäºŒä¸ºä¸€ã€‚\nYGC FGC è§¦å‘æ—¶æœº YGCçš„æ—¶æœº:\nednç©ºé—´ä¸è¶³\nFGCçš„æ—¶æœºï¼š\n1.oldç©ºé—´ä¸è¶³ï¼›\n2.permç©ºé—´ä¸è¶³ï¼›\n3.æ˜¾ç¤ºè°ƒç”¨System.gc()Â ï¼ŒåŒ…æ‹¬RMIç­‰çš„å®šæ—¶è§¦å‘;\n4.YGCæ—¶çš„æ‚²è§‚ç­–ç•¥ï¼›\n5.dump liveçš„å†…å­˜ä¿¡æ¯æ—¶(jmap â€“dump:live)ã€‚\nå¯¹YGCçš„Â è§¦å‘æ—¶æœºï¼Œç›¸å½“çš„æ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯edenç©ºé—´ä¸è¶³ï¼ŒÂ è¿™æ—¶å€™å°±è‚¯å®šä¼šè§¦å‘ygc\nå¯¹äºFGCçš„è§¦å‘æ—¶æœºï¼ŒÂ oldç©ºé—´ä¸è¶³ï¼ŒÂ å’Œpermçš„ç©ºé—´ä¸è¶³ï¼ŒÂ è°ƒç”¨system.gc()è¿™å‡ ä¸ªéƒ½æ¯”è¾ƒæ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒÂ ä¸€èˆ¬éƒ½ä¼šè§¦å‘GCã€‚\njinfo Configuration Info for Java, å®æ—¶æŸ¥çœ‹è™šæ‹Ÿæœºå„é¡¹å‚æ•°ï¼Œæ¶µç›–æ˜¾å¼å’Œé»˜è®¤ç­‰ç­‰ï¼Œå¤šå„¿å…¨ã€‚\njinfo pid https://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html\njmap Memory Map for Java, ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§\njmap -heap 47\næ˜¾ç¤ºå †ä¸­å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡ jmap -histo:live ${JAVA_PID} ã€ä¸€èˆ¬ç®€ç§°ä¸ºjmapï¼ˆç»Ÿè®¡ä¿¡æ¯ï¼‰ã€‘ç›¸å…³æ•ˆæœï¼š è§¦å‘ä¸€æ¬¡å¸¸è§„full gc jmap -dump:live,format=b,file=${FILE_PATH} ${JAVA_PID} ã€ä¸€èˆ¬ç®€ç§°ä¸ºheapdumpã€‘ ç›¸å…³æ•ˆæœï¼š è§¦å‘ä¸€æ¬¡å¸¸è§„full gcï¼Œå°†æ‰€æœ‰liveå¯¹è±¡å†™å…¥æ–‡ä»¶ã€‚ æ“ä½œåŠæ³¨æ„äº‹é¡¹ï¼š a. ç”±äºliveå¯¹è±¡æ€»å¤§å°æœ€å¤§å¯èƒ½è¾¾åˆ°å †å¤§å°(-XmxæŒ‡å®š)ï¼Œç”šè‡³ç”±äºå­˜å‚¨æ ¼å¼é—®é¢˜è¾¾åˆ°æ›´å¤§ï¼Œæ³¨æ„å­˜å‚¨æ–‡ä»¶çš„ç£ç›˜å¯ç”¨ç©ºé—´ã€‚ b. ä¸€èˆ¬å¯å…ˆä½¿ç”¨histoåˆ†æä¸€ä¸‹æ´»å¯¹è±¡æ€»å¤§å°ï¼Œä»¥æ­¤ä¼°è®¡æ–‡ä»¶å¤§å°ã€‚ c. ç½‘ç»œä¼ è¾“è¯¥æ–‡ä»¶å¼ºçƒˆå»ºè®®å…ˆé‡‡ç”¨å¸¸è§å‹ç¼©.tar.gzç­‰ï¼Œå‹ç¼©ç‡å¯è¾¾10å€ã€‚ ps: æŒç»­ FGC å¯èƒ½å‡ºç° Unable to open socket file çš„é”™è¯¯ï¼Œå› ä¸ºå½“å‰Javaè¿›ç¨‹ä¸€ç›´åœ¨æŒç»­çš„GCï¼Œè€Œåœ¨GCæœŸé—´javaè¿›ç¨‹æ˜¯ä¸å“åº”å¤–éƒ¨jmapè¯·æ±‚ï¼Œå»ºè®®ä¸€é¡¿çŒ›æ‰“ï¼Œæ— é—´éš”æŒç»­åœ°å°è¯•jmapå‘½ä»¤ä¸€å®šæ—¶é—´ï¼ˆä¸è¶…è¿‡2åˆ†é’Ÿï¼‰ï¼Œä¸€èˆ¬åœ¨å…¶ä¸­å¯ä»¥æœ‰æ¦‚ç‡æˆåŠŸæ‰“å‡ºjmapã€‚\npps: ç”± live å¼•èµ·çš„ FGC å¯ä»¥åœ¨GCæ—¥å¿—çœ‹åˆ°:Heap Inspection Initiated GC æ ‡å¿—\njstack Stack Trace for Java, ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼Œçº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ ç›®çš„é€šå¸¸æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´æŒ‚ èµ·ç­‰ï¼Œéƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚çº¿ç¨‹å‡ºç°åœé¡¿æ—¶é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œ å°±å¯ä»¥è·çŸ¥æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ç€ä»€ä¹ˆèµ„æºã€‚\nä¸€èˆ¬å­˜åœ¨ incepto job å¡æ­»ï¼Œç­‰æƒ…å†µéœ€è¦ç”¨åˆ°ï¼Œéš” x ç§’æ‰“å‡ ä¸ªã€‚\njstack pid å¯å°è¯•â€œsu hiveâ€ï¼Œå†æ‰“jstackä¿¡æ¯ã€‚ sudo -u hive /usr/java/latest/bin/jstack {PID} Ref jstat å«ä¹‰ï¼šhttps://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html\njmap å§¿åŠ¿ï¼šhttp://172.16.1.168:8090/pages/viewpage.action?pageId=18684230\njstack å§¿åŠ¿ï¼šhttp://172.16.1.168:8090/pages/viewpage.action?pageId=18683344\n","href":"/java/jvm%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/","title":"JVMå·¥å…·ä½¿ç”¨"},{"content":"","href":"/flink/","title":"Flinks"},{"content":" Flink æºç é˜…è¯»ä¹‹ä»»åŠ¡æäº¤åŸºæœ¬æµç¨‹ org.apache.flink.runtime.blob.BlobServer#run java.net.ServerSocket#accept\nBlobServer.run\næ¶‰åŠçš„ç±»:\norg.apache.flink.client.cli.CliFrontend org.apache.flink.client.ClientUtils org.apache.flink.streaming.examples.wordcount.WordCount\norg.apache.flink.runtime.blob.BlobServer#run\norg.apache.flink.runtime.taskexecutor.TaskExecutor#submitTask\norg.apache.flink.runtime.deployment.TaskDeploymentDescriptor\næµç¨‹å‡†å¤‡ ä»¥è¿œç¨‹è°ƒè¯•æ¨¡å¼è¿è¡Œ org.apache.flink.client.cli.CliFrontend\norg.apache.flink.runtime.entrypoint.StandaloneSessionClusterEntrypoint\norg.apache.flink.runtime.taskexecutor.TaskManagerRunner\nä½¿ç”¨ ./flink æäº¤ WordCount.jar, æŸ¥çœ‹æ•´ä¸ªä»»åŠ¡çš„æµè½¬è¿‡ç¨‹\norg.apache.flink.client.program.PackagedProgram#callMainMethod java.lang.reflect.Method#invoke\norg.apache.flink.streaming.api.environment.StreamContextEnvironment#execute\norg.apache.flink.streaming.api.graph.StreamGraphGenerator#generate\norg.apache.flink.streaming.api.graph.StreamGraphGenerator#transform\norg.apache.flink.streaming.api.environment.StreamExecutionEnvironment#executeAsync(org.apache.flink.streaming.api.graph.StreamGraph)\norg.apache.flink.core.execution.JobListener#onJobSubmitted\norg.apache.flink.client.program.rest.RestClusterClient#submitJob\nJM\norg.apache.flink.runtime.dispatcher.Dispatcher#submitJob log.info(\u0026ldquo;Received JobGraph submission {} ({}).\u0026rdquo;, jobGraph.getJobID(), jobGraph.getName());\norg.apache.flink.runtime.dispatcher.Dispatcher#runJob\norg.apache.flink.runtime.dispatcher.Dispatcher#createJobManagerRunner\nflink-rest-server-netty-worker-thread org.apache.flink.runtime.rest.handler.AbstractRestHandler#handleRequest org.apache.flink.runtime.rest.handler.AbstractRestHandler#respondToRequest\norg.apache.flink.runtime.rpc.akka.AkkaRpcActor#handleRpcMessage\nJM org.apache.flink.runtime.blob.BlobServer#run java.net.ServerSocket#accept\norg.apache.flink.streaming.api.environment.StreamContextEnvironment#execute\nJob å‘åˆ° JM å\norg.apache.flink.runtime.dispatcher.Dispatcher#runJob\norg.apache.flink.runtime.jobmaster.JobMaster#offerSlots\nScheduler è°ƒåº¦ ç”Ÿæˆ StreamGraph org.apache.flink.runtime.executiongraph.Execution\nå‘ç»™ TM RemoteRpcInvocation(submitTask(TaskDeploymentDescriptor, JobMasterId, Time))\norg.apache.flink.runtime.taskexecutor.TaskExecutor#submitTask\nsubmitTask æ–¹æ³• new ä¸€ä¸ª Task\nTM å» Blobserver æ‹¿jar https://juejin.im/post/5e80ae51518825736d278248\norg.apache.flink.runtime.taskmanager.Task#startTaskThread\nInputGateDeploymentDescriptor æ˜¯ä»€ä¹ˆ\nWhatâ€˜s more é€šè¿‡åŸºæœ¬çš„æ‰§è¡Œæµç¨‹æˆ‘ä»¬å¯ä»¥è¡ç”Ÿå‡ºå¾ˆå¤šç²¾è¿›çš„çŸ¥è¯†å»äº†è§£.\n å¦‚ä½•ç”Ÿæˆ Job é“¾ RPC å…·ä½“å®ç°, éƒ½æ˜¯å¹²å˜›çš„ Checkpointæœºåˆ¶ Task å®¹é”™ ä¸Kafka çš„å¯¹æ¥ç­‰ç­‰  ","href":"/flink/flink%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B9%8B%E4%BB%BB%E5%8A%A1%E6%8F%90%E4%BA%A4%E6%B5%81%E7%A8%8B/","title":"Flinkæºç é˜…è¯»ä¹‹ä»»åŠ¡æäº¤æµç¨‹"},{"content":" Flinkæºç é˜…è¯»ä¹‹å¯åŠ¨æµç¨‹  æœ¬æ–‡åˆ†æäº† Flink standalone/yarn çš„å¯åŠ¨æµç¨‹\n å…ˆçœ‹å¯åŠ¨è„šæœ¬ start-cluster.sh ## è¯»å–é»˜è®¤ config é…ç½®æ–‡ä»¶ . \u0026#34;$bin\u0026#34;/config.sh # Start the JobManager instance(s) ## ç”¨æ¥å®šåˆ¶ shell ç¯å¢ƒ -s å¼€å¯æŸä¸ªé€‰é¡¹ nocasematch å¿½ç•¥å¤§å°å†™ shopt -s nocasematch ## æ”¯æŒé«˜å¯ç”¨æ¨¡å¼å¯åŠ¨ if [[ $HIGH_AVAILABILITY == \u0026#34;zookeeper\u0026#34; ]]; then # HA Mode readMasters echo \u0026#34;Starting HA cluster with ${#MASTERS[@]}masters.\u0026#34; for ((i=0;i\u0026lt;${#MASTERS[@]};++i)); do master=${MASTERS[i]} webuiport=${WEBUIPORTS[i]} if [ ${MASTERS_ALL_LOCALHOST} = true ] ; then \u0026#34;${FLINK_BIN_DIR}\u0026#34;/jobmanager.sh start \u0026#34;${master}\u0026#34; \u0026#34;${webuiport}\u0026#34; else ssh -n $FLINK_SSH_OPTS $master -- \u0026#34;nohup /bin/bash -l \\\u0026#34;${FLINK_BIN_DIR}/jobmanager.sh\\\u0026#34; start ${master}${webuiport}\u0026amp;\u0026#34; fi done else ## æ­£å¸¸ cluster æ¨¡å¼å¯åŠ¨ echo \u0026#34;Starting cluster.\u0026#34; # Start single JobManager on this machine \u0026#34;$FLINK_BIN_DIR\u0026#34;/jobmanager.sh start fi shopt -u nocasematch # Start TaskManager instance(s) TMSlaves start æŸ¥çœ‹å®é™…å¯åŠ¨çš„ jobmanager.sh # Start/stop a Flink JobManager. ## echo å‡ºè„šæœ¬çš„ç”¨æ³•ï¼Œå¯ä»¥å­¦ç€è¿™ç§å†™æ³• USAGE=\u0026#34;Usage: jobmanager.sh ((start|start-foreground) [host] [webui-port])|stop|stop-all\u0026#34; ## %1 è¡¨ç¤ºç¬¬ä¸€ä¸ªå˜é‡ STARTSTOP=$1 ## ç¬¬äºŒä¸ª HOST=$2 # optional when starting multiple instances ## ç¬¬ä¸‰ä¸ª WEBUIPORT=$3 # optional when starting multiple instances ## å¦‚æœç¬¬ä¸€ä¸ªå‚æ•° STARTSTOP ä¸æ˜¯ä»¥ä¸‹å‡ ç§ï¼Œåˆ™è¿”å› USAGE; å­¦ä¹  if [[ $STARTSTOP != \u0026#34;start\u0026#34; ]] \u0026amp;\u0026amp; [[ $STARTSTOP != \u0026#34;start-foreground\u0026#34; ]] \u0026amp;\u0026amp; [[ $STARTSTOP != \u0026#34;stop\u0026#34; ]] \u0026amp;\u0026amp; [[ $STARTSTOP != \u0026#34;stop-all\u0026#34; ]]; then echo $USAGE exit 1 fi ## è¿™ä¸ªå‘½ä»¤å¾ˆå°‘ç›´æ¥åœ¨shellå‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠå®ƒç”¨åœ¨shellè„šæœ¬ä¸­ï¼Œç”¨äºå–å¾—è„šæœ¬æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œç„¶åå°†å½“å‰ç›®å½•åˆ‡æ¢è¿‡å»ã€‚ bin=`dirname \u0026#34;$0\u0026#34;` bin=`cd \u0026#34;$bin\u0026#34;; pwd` ## è¯»å–é…ç½®æ–‡ä»¶ . \u0026#34;$bin\u0026#34;/config.sh ## å¯åŠ¨å…¥å£ï¼Œé»˜è®¤ standalonesession ENTRYPOINT=standalonesession if [[ $STARTSTOP == \u0026#34;start\u0026#34; ]] || [[ $STARTSTOP == \u0026#34;start-foreground\u0026#34; ]]; then if [ ! -z \u0026#34;${FLINK_JM_HEAP_MB}\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;${FLINK_JM_HEAP}\u0026#34; == 0 ]; then echo \u0026#34;used deprecated key \\`${KEY_JOBM_MEM_MB}\\`, please replace with key \\`${KEY_JOBM_MEM_SIZE}\\`\u0026#34; else flink_jm_heap_bytes=$(parseBytes ${FLINK_JM_HEAP}) FLINK_JM_HEAP_MB=$(getMebiBytes ${flink_jm_heap_bytes}) fi if [[ ! ${FLINK_JM_HEAP_MB} =~ $IS_NUMBER ]] || [[ \u0026#34;${FLINK_JM_HEAP_MB}\u0026#34; -lt \u0026#34;0\u0026#34; ]]; then echo \u0026#34;[ERROR] Configured JobManager memory size is not a valid value. Please set \u0026#39;${KEY_JOBM_MEM_SIZE}\u0026#39; in ${FLINK_CONF_FILE}.\u0026#34; exit 1 fi if [ \u0026#34;${FLINK_JM_HEAP_MB}\u0026#34; -gt \u0026#34;0\u0026#34; ]; then export JVM_ARGS=\u0026#34;$JVM_ARGS-Xms\u0026#34;$FLINK_JM_HEAP_MB\u0026#34;m -Xmx\u0026#34;$FLINK_JM_HEAP_MB\u0026#34;m\u0026#34; fi # Add JobManager-specific JVM options export FLINK_ENV_JAVA_OPTS=\u0026#34;${FLINK_ENV_JAVA_OPTS}${FLINK_ENV_JAVA_OPTS_JM}\u0026#34; # Startup parameters ## ç›¸å…³å‚æ•°å¯ä»¥åŠ åˆ°è¿™é‡Œ args=(\u0026#34;--configDir\u0026#34; \u0026#34;${FLINK_CONF_DIR}\u0026#34; \u0026#34;--executionMode\u0026#34; \u0026#34;cluster\u0026#34;) if [ ! -z $HOST ]; then args+=(\u0026#34;--host\u0026#34;) args+=(\u0026#34;${HOST}\u0026#34;) fi if [ ! -z $WEBUIPORT ]; then args+=(\u0026#34;--webui-port\u0026#34;) args+=(\u0026#34;${WEBUIPORT}\u0026#34;) fi fi if [[ $STARTSTOP == \u0026#34;start-foreground\u0026#34; ]]; then exec \u0026#34;${FLINK_BIN_DIR}\u0026#34;/flink-console.sh $ENTRYPOINT \u0026#34;${args[@]}\u0026#34; else \u0026#34;${FLINK_BIN_DIR}\u0026#34;/flink-daemon.sh $STARTSTOP $ENTRYPOINT \u0026#34;${args[@]}\u0026#34; fi flink çœŸæ­£çš„å¯åŠ¨ç±» flink-daemon.sh # Start/stop a Flink daemon. USAGE=\u0026#34;Usage: flink-daemon.sh (start|stop|stop-all) (taskexecutor|zookeeper|historyserver|standalonesession|standalonejob) [args]\u0026#34; STARTSTOP=$1 DAEMON=$2 ARGS=(\u0026#34;${@:3}\u0026#34;) # get remaining arguments as array bin=`dirname \u0026#34;$0\u0026#34;` bin=`cd \u0026#34;$bin\u0026#34;; pwd` . \u0026#34;$bin\u0026#34;/config.sh case $DAEMON in (taskexecutor) ## Task Manager å¯åŠ¨ç±» CLASS_TO_RUN=org.apache.flink.runtime.taskexecutor.TaskManagerRunner ;; (zookeeper) CLASS_TO_RUN=org.apache.flink.runtime.zookeeper.FlinkZooKeeperQuorumPeer ;; (historyserver) CLASS_TO_RUN=org.apache.flink.runtime.webmonitor.history.HistoryServer ;; ## é»˜è®¤ä¼ æ»´å°±æ˜¯ standalonesession æ‰€ä»¥æ˜¯åœ¨è¿™é‡Œå•¦ (standalonesession) CLASS_TO_RUN=org.apache.flink.runtime.entrypoint.StandaloneSessionClusterEntrypoint ;; (standalonejob) CLASS_TO_RUN=org.apache.flink.container.entrypoint.StandaloneJobClusterEntryPoint ;; (*) echo \u0026#34;Unknown daemon \u0026#39;${DAEMON}\u0026#39;. $USAGE.\u0026#34; exit 1 ;; esac if [ \u0026#34;$FLINK_IDENT_STRING\u0026#34; = \u0026#34;\u0026#34; ]; then FLINK_IDENT_STRING=\u0026#34;$USER\u0026#34; fi FLINK_TM_CLASSPATH=`constructFlinkClassPath` pid=$FLINK_PID_DIR/flink-$FLINK_IDENT_STRING-$DAEMON.pid mkdir -p \u0026#34;$FLINK_PID_DIR\u0026#34; # Log files for daemons are indexed from the process ID\u0026#39;s position in the PID # file. The following lock prevents a race condition during daemon startup # when multiple daemons read, index, and write to the PID file concurrently. # The lock is created on the PID directory since a lock file cannot be safely # removed. The daemon is started with the lock closed and the lock remains # active in this script until the script exits. command -v flock \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 if [[ $? -eq 0 ]]; then exec 200\u0026lt;\u0026#34;$FLINK_PID_DIR\u0026#34; flock 200 fi # Ascending ID depending on number of lines in pid file. # This allows us to start multiple daemon of each type. id=$([ -f \u0026#34;$pid\u0026#34; ] \u0026amp;\u0026amp; echo $(wc -l \u0026lt; \u0026#34;$pid\u0026#34;) || echo \u0026#34;0\u0026#34;) FLINK_LOG_PREFIX=\u0026#34;${FLINK_LOG_DIR}/flink-${FLINK_IDENT_STRING}-${DAEMON}-${id}-${HOSTNAME}\u0026#34; log=\u0026#34;${FLINK_LOG_PREFIX}.log\u0026#34; out=\u0026#34;${FLINK_LOG_PREFIX}.out\u0026#34; log_setting=(\u0026#34;-Dlog.file=${log}\u0026#34; \u0026#34;-Dlog4j.configuration=file:${FLINK_CONF_DIR}/log4j.properties\u0026#34; \u0026#34;-Dlogback.configurationFile=file:${FLINK_CONF_DIR}/logback.xml\u0026#34;) JAVA_VERSION=$(${JAVA_RUN} -version 2\u0026gt;\u0026amp;1 | sed \u0026#39;s/.*version \u0026#34;\\(.*\\)\\.\\(.*\\)\\..*\u0026#34;/\\1\\2/; 1q\u0026#39;) # Only set JVM 8 arguments if we have correctly extracted the version if [[ ${JAVA_VERSION} =~ ${IS_NUMBER} ]]; then if [ \u0026#34;$JAVA_VERSION\u0026#34; -lt 18 ]; then JVM_ARGS=\u0026#34;$JVM_ARGS-XX:MaxPermSize=256m\u0026#34; fi fi case $STARTSTOP in (start) # Rotate log files rotateLogFilesWithPrefix \u0026#34;$FLINK_LOG_DIR\u0026#34; \u0026#34;$FLINK_LOG_PREFIX\u0026#34; # Print a warning if daemons are already running on host if [ -f \u0026#34;$pid\u0026#34; ]; then active=() while IFS=\u0026#39;\u0026#39; read -r p || [[ -n \u0026#34;$p\u0026#34; ]]; do kill -0 $p \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 if [ $? -eq 0 ]; then active+=($p) fi done \u0026lt; \u0026#34;${pid}\u0026#34; count=\u0026#34;${#active[@]}\u0026#34; if [ ${count} -gt 0 ]; then echo \u0026#34;[INFO] $countinstance(s) of $DAEMONare already running on $HOSTNAME.\u0026#34; fi fi # Evaluate user options for local variable expansion FLINK_ENV_JAVA_OPTS=$(eval echo ${FLINK_ENV_JAVA_OPTS}) echo \u0026#34;Starting $DAEMONdaemon on host $HOSTNAME.\u0026#34; $JAVA_RUN $JVM_ARGS ${FLINK_ENV_JAVA_OPTS} \u0026#34;${log_setting[@]}\u0026#34; -classpath \u0026#34;`manglePathList \u0026#34;$FLINK_TM_CLASSPATH:$INTERNAL_HADOOP_CLASSPATHS\u0026#34;`\u0026#34; ${CLASS_TO_RUN} \u0026#34;${ARGS[@]}\u0026#34; \u0026gt; \u0026#34;$out\u0026#34; 200\u0026lt;\u0026amp;- 2\u0026gt;\u0026amp;1 \u0026lt; /dev/null \u0026amp; mypid=$! # Add to pid file if successful start if [[ ${mypid} =~ ${IS_NUMBER} ]] \u0026amp;\u0026amp; kill -0 $mypid \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ; then echo $mypid \u0026gt;\u0026gt; \u0026#34;$pid\u0026#34; else echo \u0026#34;Error starting $DAEMONdaemon.\u0026#34; exit 1 fi ;; (stop) if [ -f \u0026#34;$pid\u0026#34; ]; then # Remove last in pid file to_stop=$(tail -n 1 \u0026#34;$pid\u0026#34;) if [ -z $to_stop ]; then rm \u0026#34;$pid\u0026#34; # If all stopped, clean up pid file echo \u0026#34;No $DAEMONdaemon to stop on host $HOSTNAME.\u0026#34; else sed \\$d \u0026#34;$pid\u0026#34; \u0026gt; \u0026#34;$pid.tmp\u0026#34; # all but last line # If all stopped, clean up pid file [ $(wc -l \u0026lt; \u0026#34;$pid.tmp\u0026#34;) -eq 0 ] \u0026amp;\u0026amp; rm \u0026#34;$pid\u0026#34; \u0026#34;$pid.tmp\u0026#34; || mv \u0026#34;$pid.tmp\u0026#34; \u0026#34;$pid\u0026#34; if kill -0 $to_stop \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;Stopping $DAEMONdaemon (pid: $to_stop) on host $HOSTNAME.\u0026#34; kill $to_stop else echo \u0026#34;No $DAEMONdaemon (pid: $to_stop) is running anymore on $HOSTNAME.\u0026#34; fi fi else echo \u0026#34;No $DAEMONdaemon to stop on host $HOSTNAME.\u0026#34; fi ;; (stop-all) if [ -f \u0026#34;$pid\u0026#34; ]; then mv \u0026#34;$pid\u0026#34; \u0026#34;${pid}.tmp\u0026#34; while read to_stop; do if kill -0 $to_stop \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;Stopping $DAEMONdaemon (pid: $to_stop) on host $HOSTNAME.\u0026#34; kill $to_stop else echo \u0026#34;Skipping $DAEMONdaemon (pid: $to_stop), because it is not running anymore on $HOSTNAME.\u0026#34; fi done \u0026lt; \u0026#34;${pid}.tmp\u0026#34; rm \u0026#34;${pid}.tmp\u0026#34; fi ;; (*) echo \u0026#34;Unexpected argument \u0026#39;$STARTSTOP\u0026#39;. $USAGE.\u0026#34; exit 1 ;; esac ç»ˆäºæ‰¾åˆ° StandaloneSessionClusterEntrypoint å¯åŠ¨ç±» å•¦ é€šè¿‡æŸ¥çœ‹ ä¸‰ ä¸ªå¯åŠ¨è„šæœ¬ï¼Œç»ˆäºæ‰¾åˆ°äº† standalone çš„å¯åŠ¨ç±» StandaloneSessionClusterEntrypointï¼Œä¸‹é¢çœ‹çœ‹æºç æ˜¯æ€ä¹ˆå®ç°çš„\n","href":"/flink/flink%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B9%8B%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/","title":"Flinkæºç é˜…è¯»ä¹‹å¯åŠ¨æµç¨‹"},{"content":"","href":"/scala/intro/","title":"Intro"},{"content":"","href":"/scala/","title":"Scalas"},{"content":"","href":"/java/intro/","title":"Intro"},{"content":" haha ","href":"/flink/intro/","title":"Intro"},{"content":"","href":"/kafka/","title":"Kafkas"},{"content":" kafkaæºç è§£æä¹‹ ServerSocketChannel è¯¦è§£  ç”±äºkafka socketServer ä½¿ç”¨åˆ°äº† nio çš„ serverSocketChannel, æœ¬æ–‡è¯¦ç»†è§£æäº† è¯¥ç±»çš„ä½¿ç”¨æ–¹æ³•ã€‚ https://blog.csdn.net/kavu1/article/details/53212178\n Kafka çš„ kafka.network.Acceptor è´Ÿè´£ç›‘å¬å¤–ç•Œ Socket è¿æ¥å¹¶æŠŠè¯·æ±‚è½¬å‘ç»™ kafka.network.Processorï¼Œå®Œäº‹å Processor è´Ÿè´£è½¬å‘ Socket çš„è¯·æ±‚å’Œå“åº”ï¼Œå¹¶å°†å…¶å‘é€åˆ° kafka.network.RequestChannelã€‚\nä¸java.net.Socketç±»å’Œjava.net.ServerSocketç±»ç›¸å¯¹åº”ï¼ŒNIOä¹Ÿæä¾›äº†SocketChannelå’ŒServerSocketChannelä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°ã€‚è¿™ä¸¤ç§æ–°å¢çš„é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚ ä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©åŒæ­¥é˜»å¡I/Oä»¥é™ä½ç¼–ç¨‹å¤æ‚åº¦ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ç½‘ç»œåº”ç”¨ï¼Œéœ€è¦ä½¿ç”¨NIOçš„éé˜»å¡æ¨¡å¼è¿›è¡Œå¼€å‘ã€‚ é“¾æ¥ï¼šhttps://www.jianshu.com/p/5442b04ccff8\næ³¨æ„, å¦‚æœä¸€ä¸ª Channel è¦æ³¨å†Œåˆ° Selector ä¸­, é‚£ä¹ˆè¿™ä¸ª Channel å¿…é¡»æ˜¯éé˜»å¡çš„, å³channel.configureBlocking(false); å› ä¸º Channel å¿…é¡»è¦æ˜¯éé˜»å¡çš„, å› æ­¤ FileChannel æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨é€‰æ‹©å™¨çš„, å› ä¸º FileChannel éƒ½æ˜¯é˜»å¡çš„.\nServerSocketChannel ä¸ ServerSocket ServerSocketChannelç±»ä¼¼äºSocketChannel,åªä¸è¿‡ServerSocketChannelä½¿ç”¨serverç«¯.ServerSocketChannelæ˜¯ServerSocket + Selectorçš„é«˜å±‚ å°è£….å¯ä»¥é€šè¿‡socket()æ–¹æ³•è·å¾—ä¸å…¶å…³è”çš„ServerSocket.\näº‹å®ä¸Šchannelå³ä¸ºsocketé“¾æ¥çš„é«˜å±‚å°è£…,æ¯ä¸ªchanneléƒ½ç»‘å®šåœ¨ä¸€ä¸ªsocketä¸Š,å®ƒä»¬æ¯æ¯ç›¸å…³.\nSocketChannelçš„å…³é—­æ”¯æŒå¼‚æ­¥å…³é—­(æ¥è‡ªInterruptableChannelç‰¹æ€§),è¿™ä¸Channelç±»ä¸­æŒ‡å®šçš„å¼‚æ­¥closeæ“ä½œæœ‰å…³.å¦‚æœä¸€ä¸ªçº¿ç¨‹å…³é—­äº†æŸä¸ªSocket input,é‚£ä¹ˆåŒæ—¶å¦ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡åœ¨è¯¥SocketChannelçš„readæ“ä½œä¸­,é‚£ä¹ˆå¤„äºé˜»å¡çº¿ç¨‹ä¸­çš„è¯»å–æ“ä½œå°†å®Œæˆ,è€Œä¸è¯»å–ä»»ä½•å­—èŠ‚ä¸”è¿”å›-1.å¦‚æœä¸€ä¸ªçº¿ç¨‹å…³é—­äº†socket output,è€ŒåŒæ—¶å¦ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡åœ¨è¯¥socketChannelçš„writeæ“ä½œä¸­,æ­¤æ—¶é˜»å¡çº¿ç¨‹å°†æ”¶åˆ°AsynchronousClosedException.\nSocketChannelæ˜¯çº¿ç¨‹å®‰å…¨çš„,ä½†æ˜¯ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºreadæˆ–è€…writeæ“ä½œ(readæ“ä½œåŒæ­¥readLock,writeæ“ä½œåŒæ­¥writeLock,2ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›è¡Œreadå’Œwrite;),ä¸è¿‡DatagramChannelæ”¯æŒå¹¶å‘çš„è¯»å†™.\nå‚è€ƒ:http://shift-alt-ctrl.iteye.com/blog/1840409\nNIO çš„å››ç§äº‹ä»¶    OP_ACCEPT OP_CONNECT OP_WRITE OP_READ        Y Y Y SocketChannel å®¢æˆ·ç«¯   Y    ServerSocketChannel æœåŠ¡ç«¯     Y Y SocketChannel æœåŠ¡ç«¯            å°±ç»ªæ¡ä»¶ï¼š\nOP_ACCEPTå°±ç»ªæ¡ä»¶ï¼š å½“æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æ—¶ï¼Œè¯¥æ“ä½œå°±ç»ªã€‚è¿™æ˜¯ServerSocketChannelä¸Šå”¯ä¸€æœ‰æ•ˆçš„æ“ä½œã€‚ OP_CONNECTå°±ç»ªæ¡ä»¶ï¼š åªæœ‰å®¢æˆ·ç«¯SocketChannelä¼šæ³¨å†Œè¯¥æ“ä½œï¼Œå½“å®¢æˆ·ç«¯è°ƒç”¨SocketChannel.connect()æ—¶ï¼Œè¯¥æ“ä½œä¼šå°±ç»ªã€‚ OP_READå°±ç»ªæ¡ä»¶ï¼š è¯¥æ“ä½œå¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„SocketChanneléƒ½æœ‰æ•ˆï¼Œå½“OSçš„è¯»ç¼“å†²åŒºä¸­æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œè¯¥æ“ä½œå°±ç»ªã€‚ OP_WRITEå°±ç»ªæ¡ä»¶ï¼š è¯¥æ“ä½œå¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„SocketChanneléƒ½æœ‰æ•ˆï¼Œå½“OSçš„å†™ç¼“å†²åŒºä¸­æœ‰ç©ºé—²çš„ç©ºé—´æ—¶ï¼Œè¯¥æ“ä½œå°±ç»ªã€‚\nAcceptor ä¸ java.nio.channels.ServerSocketChannel å¯ä»¥ç†è§£ä¸º Acceptor ä¸ºäº†å’Œ processor é€šä¿¡ï¼Œ æ˜¯åŒ…è£…äº† ä¸€å±‚çš„ ServerSocketChannelã€‚\næŸ¥çœ‹ acceptor çš„ class å’Œ run æ–¹æ³•ï¼Œ å‘ç°ä¸»è¦æ˜¯ï¼š\n é€šè¿‡ new ServerSocketChannel å¼€å¯ Socket æœåŠ¡ æ³¨å†Œ OP_ACCEPT äº‹ä»¶ï¼Œè¡¨ç¤ºè¯¥accptor å¯ä»¥è¢«å¤–ç•Œè®¿é—®ï¼Œå·²ç»å¼€å§‹ç›‘å¬ é€šè¿‡ key.isAcceptable ç¡®è®¤ acceptor æ­£å¸¸ï¼Œä½¿ç”¨ round-robin è½®è¯¢å°†å¯¹åº”çš„ SocketChannel å‘é€åˆ° Processor çº¿ç¨‹ã€‚  Selectorä¸æ–­è½®è¯¢æ˜¯å¦æœ‰äº‹ä»¶å‡†å¤‡å¥½äº†ï¼Œå¦‚æœæœ‰äº‹ä»¶å‡†å¤‡å¥½äº†åˆ™è·å–äº‹ä»¶ç›¸åº”çš„SelectionKeyï¼Œè¿›å…¥äº‹ä»¶å¤„ç†\n","href":"/kafka/kafka%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B9%8Bserversocketchannel/","title":"Kafkaæºç é˜…è¯»ä¹‹ServerSocketChannel"},{"content":" kafkaæºç è§£æä¹‹æ€§èƒ½ç¯‡ æ¦‚å¿µç¯‡ Linux çš„ Page Cache å’Œ Buffer Cache page cacheæ˜¯ç³»ç»Ÿè¯»å†™ç£ç›˜æ–‡ä»¶æ—¶ä¸ºäº†æé«˜æ€§èƒ½è€Œå°†ä¸€éƒ¨åˆ†æ–‡ä»¶ç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚ è¿™ç§åšæ³•è™½ç„¶æé«˜äº†ç£ç›˜I/Oæ€§èƒ½ï¼Œä½†æ˜¯ä¹Ÿæå¤§çš„å ç”¨äº†ç‰©ç†å†…å­˜ï¼Œç‰¹åˆ«å½“ç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶æ›´å®¹æ˜“å‡ºç°é—®é¢˜ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¹³å¸¸å‘ç¡¬ç›˜å†™æ–‡ä»¶æ—¶ï¼Œé»˜è®¤å¼‚æ­¥æƒ…å†µä¸‹ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°ç¡¬ç›˜ä¸­æ‰è¿”å›çš„ï¼Œè€Œæ˜¯æˆåŠŸæ‹·è´åˆ°å†…æ ¸çš„page cacheåå°±ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¡¬ç›˜å†™æ“ä½œä¸ä¼šæ˜¯æ€§èƒ½ç“¶é¢ˆã€‚å†™å…¥åˆ°å†…æ ¸page cacheçš„pagesæˆä¸ºdirty pagesï¼Œç¨åä¼šç”±å†…æ ¸çº¿ç¨‹pdflushçœŸæ­£å†™å…¥åˆ°ç¡¬ç›˜ä¸Šã€‚\nä»ç¡¬ç›˜è¯»å–æ–‡ä»¶æ—¶ï¼ŒåŒæ ·ä¸æ˜¯ç›´æ¥æŠŠç¡¬ç›˜ä¸Šæ–‡ä»¶å†…å®¹è¯»å–åˆ°ç”¨æˆ·æ€å†…å­˜ï¼Œè€Œæ˜¯å…ˆæ‹·è´åˆ°å†…æ ¸çš„page cacheï¼Œç„¶åå†â€œæ‹·è´â€åˆ°ç”¨æˆ·æ€å†…å­˜ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥è®¿é—®è¯¥æ–‡ä»¶ã€‚å› ä¸ºæ¶‰åŠåˆ°ç¡¬ç›˜æ“ä½œï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¯»å–ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¸ä¼šæœ‰æ€§èƒ½æå‡ï¼›ä¸è¿‡ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å·²ç»å­˜åœ¨page cacheä¸­ï¼Œå†æ¬¡è¯»å–è¯¥æ–‡ä»¶æ—¶å°±å¯ä»¥ç›´æ¥ä»page cacheä¸­å‘½ä¸­è¯»å–ä¸æ¶‰åŠç¡¬ç›˜æ“ä½œï¼Œè¿™æ—¶æ€§èƒ½å°±ä¼šæœ‰å¾ˆå¤§æé«˜ã€‚\nPage Cache çš„æ„æˆ page cacheä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€æ£µåŸºæ•°æ ‘ï¼ˆradix treeï¼Œæœ¬è´¨ä¸Šæ˜¯å¤šå‰æœç´¢æ ‘ï¼‰ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªé¡µã€‚æ ¹æ®æ–‡ä»¶å†…çš„åç§»é‡å°±å¯ä»¥å¿«é€Ÿå®šä½åˆ°æ‰€åœ¨çš„é¡µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nåŸç†ç¯‡ Kafkaä¸ºä»€ä¹ˆä¸è‡ªå·±ç®¡ç†ç¼“å­˜ï¼Œè€Œéè¦ç”¨page cacheï¼ŸåŸå› æœ‰å¦‚ä¸‹ä¸‰ç‚¹ï¼š\n JVMä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼Œæ•°æ®çš„å¯¹è±¡å­˜å‚¨ä¼šå¸¦æ¥æ‰€è°“object overheadï¼Œæµªè´¹ç©ºé—´ï¼›\n å¦‚æœç”±JVMæ¥ç®¡ç†ç¼“å­˜ï¼Œä¼šå—åˆ°GCçš„å½±å“ï¼Œå¹¶ä¸”è¿‡å¤§çš„å †ä¹Ÿä¼šæ‹–ç´¯GCçš„æ•ˆç‡ï¼Œé™ä½ååé‡ï¼›\n ä¸€æ—¦ç¨‹åºå´©æºƒï¼Œè‡ªå·±ç®¡ç†çš„ç¼“å­˜æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ã€‚\n  Kafkaä¸‰å¤§ä»¶ï¼ˆbrokerã€producerã€consumerï¼‰ä¸page cacheçš„å…³ç³»å¯ä»¥ç”¨ä¸‹é¢çš„ç®€å›¾æ¥è¡¨ç¤ºã€‚\n![page cache](./images/pagecache.jpgï¼‰\nproducerç”Ÿäº§æ¶ˆæ¯æ—¶ï¼Œä¼šä½¿ç”¨pwrite()ç³»ç»Ÿè°ƒç”¨ã€å¯¹åº”åˆ°Java NIOä¸­æ˜¯FileChannel.write() APIã€‘æŒ‰åç§»é‡å†™å…¥æ•°æ®ï¼Œå¹¶ä¸”éƒ½ä¼šå…ˆå†™å…¥page cacheé‡Œã€‚consumeræ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œä¼šä½¿ç”¨sendfile()ç³»ç»Ÿè°ƒç”¨ã€å¯¹åº”FileChannel.transferTo() APIã€‘ï¼Œé›¶æ‹·è´åœ°å°†æ•°æ®ä»page cacheä¼ è¾“åˆ°brokerçš„Socket bufferï¼Œå†é€šè¿‡ç½‘ç»œä¼ è¾“ã€‚\nhttps://zhuanlan.zhihu.com/p/105509080\nå›¾ä¸­æ²¡æœ‰ç”»å‡ºæ¥çš„è¿˜æœ‰leaderä¸followerä¹‹é—´çš„åŒæ­¥ï¼Œè¿™ä¸consumeræ˜¯åŒç†çš„ï¼šåªè¦followerå¤„åœ¨ISRä¸­ï¼Œå°±ä¹Ÿèƒ½å¤Ÿé€šè¿‡é›¶æ‹·è´æœºåˆ¶å°†æ•°æ®ä»leaderæ‰€åœ¨çš„broker page cacheä¼ è¾“åˆ°followeræ‰€åœ¨çš„brokerã€‚\nåŒæ—¶ï¼Œpage cacheä¸­çš„æ•°æ®ä¼šéšç€å†…æ ¸ä¸­flusherçº¿ç¨‹çš„è°ƒåº¦ä»¥åŠå¯¹sync()/fsync()çš„è°ƒç”¨å†™å›åˆ°ç£ç›˜ï¼Œå°±ç®—è¿›ç¨‹å´©æºƒï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒæ•°æ®ä¸¢å¤±ã€‚å¦å¤–ï¼Œå¦‚æœconsumerè¦æ¶ˆè´¹çš„æ¶ˆæ¯ä¸åœ¨page cacheé‡Œï¼Œæ‰ä¼šå»ç£ç›˜è¯»å–ï¼Œå¹¶ä¸”ä¼šé¡ºä¾¿é¢„è¯»å‡ºä¸€äº›ç›¸é‚»çš„å—æ”¾å…¥page cacheï¼Œä»¥æ–¹ä¾¿ä¸‹ä¸€æ¬¡è¯»å–ã€‚\nç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºé‡è¦çš„ç»“è®ºï¼šå¦‚æœKafka producerçš„ç”Ÿäº§é€Ÿç‡ä¸consumerçš„æ¶ˆè´¹é€Ÿç‡ç›¸å·®ä¸å¤§ï¼Œé‚£ä¹ˆå°±èƒ½å‡ ä¹åªé å¯¹broker page cacheçš„è¯»å†™å®Œæˆæ•´ä¸ªç”Ÿäº§-æ¶ˆè´¹è¿‡ç¨‹ï¼Œç£ç›˜è®¿é—®éå¸¸å°‘ã€‚å¹¶ä¸”KafkaæŒä¹…åŒ–æ¶ˆæ¯åˆ°å„ä¸ªtopicçš„partitionæ–‡ä»¶æ—¶ï¼Œæ˜¯åªè¿½åŠ çš„é¡ºåºå†™ï¼Œå……åˆ†åˆ©ç”¨äº†ç£ç›˜é¡ºåºè®¿é—®å¿«çš„ç‰¹æ€§ï¼Œæ•ˆç‡é«˜ã€‚\næ³¨æ„äº‹é¡¹ä¸ç›¸å…³å‚æ•° å¯¹äºå•çº¯è¿è¡ŒKafkaçš„é›†ç¾¤è€Œè¨€ï¼Œé¦–å…ˆè¦æ³¨æ„çš„å°±æ˜¯ä¸ºKafkaè®¾ç½®åˆé€‚ï¼ˆä¸é‚£ä¹ˆå¤§ï¼‰çš„JVMå †å¤§å°ã€‚ä»ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼ŒKafkaçš„æ€§èƒ½ä¸å †å†…å­˜å…³ç³»å¹¶ä¸å¤§ï¼Œè€Œå¯¹page cacheéœ€æ±‚å·¨å¤§ã€‚æ ¹æ®ç»éªŒå€¼ï¼Œä¸ºKafkaåˆ†é…5~8GBçš„å †å†…å­˜å°±å·²ç»è¶³è¶³å¤Ÿç”¨äº†ï¼Œå°†å‰©ä¸‹çš„ç³»ç»Ÿå†…å­˜éƒ½ä½œä¸ºpage cacheç©ºé—´ï¼Œå¯ä»¥æœ€å¤§åŒ–I/Oæ•ˆç‡ã€‚\nå¦ä¸€ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„é—®é¢˜æ˜¯lagging consumerï¼Œå³é‚£äº›æ¶ˆè´¹é€Ÿç‡æ…¢ã€æ˜æ˜¾è½åçš„consumerã€‚å®ƒä»¬è¦è¯»å–çš„æ•°æ®æœ‰è¾ƒå¤§æ¦‚ç‡ä¸åœ¨broker page cacheä¸­ï¼Œå› æ­¤ä¼šå¢åŠ å¾ˆå¤šä¸å¿…è¦çš„è¯»ç›˜æ“ä½œã€‚æ¯”è¿™æ›´åçš„æ˜¯ï¼Œlagging consumerè¯»å–çš„â€œå†·â€æ•°æ®ä»ç„¶ä¼šè¿›å…¥page cacheï¼Œæ±¡æŸ“äº†å¤šæ•°æ­£å¸¸consumerè¦è¯»å–çš„â€œçƒ­â€æ•°æ®ï¼Œè¿å¸¦ç€æ­£å¸¸consumerçš„æ€§èƒ½å˜å·®ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªé—®é¢˜å°¤ä¸ºé‡è¦ã€‚\nå‰é¢å·²ç»è¯´è¿‡ï¼Œpage cacheä¸­çš„æ•°æ®ä¼šéšç€å†…æ ¸ä¸­flusherçº¿ç¨‹çš„è°ƒåº¦å†™å›ç£ç›˜ã€‚ä¸å®ƒç›¸å…³çš„æœ‰ä»¥ä¸‹4ä¸ªå‚æ•°ï¼Œå¿…è¦æ—¶å¯ä»¥è°ƒæ•´ã€‚\n/proc/sys/vm/dirty_writeback_centisecsï¼šflushæ£€æŸ¥çš„å‘¨æœŸã€‚å•ä½ä¸º0.01ç§’ï¼Œé»˜è®¤å€¼500ï¼Œå³5ç§’ã€‚æ¯æ¬¡æ£€æŸ¥éƒ½ä¼šæŒ‰ç…§ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°æ§åˆ¶çš„é€»è¾‘æ¥å¤„ç†ã€‚\n/proc/sys/vm/dirty_expire_centisecsï¼šå¦‚æœpage cacheä¸­çš„é¡µè¢«æ ‡è®°ä¸ºdirtyçš„æ—¶é—´è¶…è¿‡äº†è¿™ä¸ªå€¼ï¼Œå°±ä¼šè¢«ç›´æ¥åˆ·åˆ°ç£ç›˜ã€‚å•ä½ä¸º0.01ç§’ã€‚é»˜è®¤å€¼3000ï¼Œå³åŠåˆ†é’Ÿã€‚\n/proc/sys/vm/dirty_background_ratioï¼šå¦‚æœdirty pageçš„æ€»å¤§å°å ç©ºé—²å†…å­˜é‡çš„æ¯”ä¾‹è¶…è¿‡äº†è¯¥å€¼ï¼Œå°±ä¼šåœ¨åå°è°ƒåº¦flusherçº¿ç¨‹å¼‚æ­¥å†™ç£ç›˜ï¼Œä¸ä¼šé˜»å¡å½“å‰çš„write()æ“ä½œã€‚é»˜è®¤å€¼ä¸º10%ã€‚\n/proc/sys/vm/dirty_ratioï¼šå¦‚æœdirty pageçš„æ€»å¤§å°å æ€»å†…å­˜é‡çš„æ¯”ä¾‹è¶…è¿‡äº†è¯¥å€¼ï¼Œå°±ä¼šé˜»å¡æ‰€æœ‰è¿›ç¨‹çš„write()æ“ä½œï¼Œå¹¶ä¸”å¼ºåˆ¶æ¯ä¸ªè¿›ç¨‹å°†è‡ªå·±çš„æ–‡ä»¶å†™å…¥ç£ç›˜ã€‚é»˜è®¤å€¼ä¸º20%ã€‚\nç”±æ­¤å¯è§ï¼Œè°ƒæ•´ç©ºé—´æ¯”è¾ƒçµæ´»çš„æ˜¯å‚æ•°2ã€3ï¼Œè€Œå°½é‡ä¸è¦è¾¾åˆ°å‚æ•°4çš„é˜ˆå€¼ï¼Œä»£ä»·å¤ªå¤§äº†ã€‚\næˆ‘ä»¬åœ¨æ€§èƒ½ä¸Šå·²ç»åšäº†å¾ˆå¤§çš„åŠªåŠ›ã€‚ æˆ‘ä»¬ä¸»è¦çš„ä½¿ç”¨åœºæ™¯æ˜¯å¤„ç†WEBæ´»åŠ¨æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®é‡éå¸¸å¤§ï¼Œå› ä¸ºæ¯ä¸ªé¡µé¢éƒ½æœ‰å¯èƒ½å¤§é‡çš„å†™å…¥ã€‚æ­¤å¤–æˆ‘ä»¬å‡è®¾æ¯ä¸ªå‘å¸ƒ message è‡³å°‘è¢«ä¸€ä¸ªconsumer (é€šå¸¸å¾ˆå¤šä¸ªconsumer) æ¶ˆè´¹ï¼Œ å› æ­¤æˆ‘ä»¬å°½å¯èƒ½çš„å»é™ä½æ¶ˆè´¹çš„ä»£ä»·ã€‚\næˆ‘ä»¬è¿˜å‘ç°ï¼Œä»æ„å»ºå’Œè¿è¡Œè®¸å¤šç›¸ä¼¼ç³»ç»Ÿçš„ç»éªŒä¸Šæ¥çœ‹ï¼Œæ€§èƒ½æ˜¯å¤šç§Ÿæˆ·è¿è¥çš„å…³é”®ã€‚å¦‚æœä¸‹æ¸¸çš„åŸºç¡€è®¾æ–½æœåŠ¡å¾ˆè½»æ˜“è¢«åº”ç”¨å±‚å†²å‡»å½¢æˆç“¶é¢ˆï¼Œé‚£ä¹ˆä¸€äº›å°çš„æ”¹å˜ä¹Ÿä¼šé€ æˆé—®é¢˜ã€‚é€šè¿‡éå¸¸å¿«çš„(ç¼“å­˜)æŠ€æœ¯ï¼Œæˆ‘ä»¬èƒ½ç¡®ä¿åº”ç”¨å±‚å†²å‡»åŸºç¡€è®¾æ–½ä¹‹å‰ï¼Œå°†è´Ÿè½½ç¨³å®šä¸‹æ¥ã€‚ å½“å°è¯•å»è¿è¡Œæ”¯æŒé›†ä¸­å¼é›†ç¾¤ä¸Šæˆç™¾ä¸Šåƒä¸ªåº”ç”¨ç¨‹åºçš„é›†ä¸­å¼æœåŠ¡æ—¶ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºåº”ç”¨å±‚ä½¿ç”¨æ–¹å¼å‡ ä¹æ¯å¤©éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚\næˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚è®¨è®ºäº†ç£ç›˜æ€§èƒ½ã€‚ ä¸€æ—¦æ¶ˆé™¤äº†ç£ç›˜è®¿é—®æ¨¡å¼ä¸ä½³çš„æƒ…å†µï¼Œè¯¥ç±»ç³»ç»Ÿæ€§èƒ½ä½ä¸‹çš„ä¸»è¦åŸå› å°±å‰©ä¸‹äº†ä¸¤ä¸ªï¼šå¤§é‡çš„å°å‹ I/O æ“ä½œï¼Œä»¥åŠè¿‡å¤šçš„å­—èŠ‚æ‹·è´ã€‚\nå°å‹çš„ I/O æ“ä½œå‘ç”Ÿåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ä»¥åŠæœåŠ¡ç«¯è‡ªèº«çš„æŒä¹…åŒ–æ“ä½œä¸­ã€‚\nä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬çš„åè®®æ˜¯å»ºç«‹åœ¨ä¸€ä¸ª â€œæ¶ˆæ¯å—â€ çš„æŠ½è±¡åŸºç¡€ä¸Šï¼Œåˆç†å°†æ¶ˆæ¯åˆ†ç»„ã€‚ è¿™ä½¿å¾—ç½‘ç»œè¯·æ±‚å°†å¤šä¸ªæ¶ˆæ¯æ‰“åŒ…æˆä¸€ç»„ï¼Œè€Œä¸æ˜¯æ¯æ¬¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä»è€Œä½¿æ•´ç»„æ¶ˆæ¯åˆ†æ‹…ç½‘ç»œä¸­å¾€è¿”çš„å¼€é”€ã€‚Consumer æ¯æ¬¡è·å–å¤šä¸ªå¤§å‹æœ‰åºçš„æ¶ˆæ¯å—ï¼Œå¹¶ç”±æœåŠ¡ç«¯ ä¾æ¬¡å°†æ¶ˆæ¯å—ä¸€æ¬¡åŠ è½½åˆ°å®ƒçš„æ—¥å¿—ä¸­ã€‚\nè¿™ä¸ªç®€å•çš„ä¼˜åŒ–å¯¹é€Ÿåº¦æœ‰ç€æ•°é‡çº§çš„æå‡ã€‚æ‰¹å¤„ç†å…è®¸æ›´å¤§çš„ç½‘ç»œæ•°æ®åŒ…ï¼Œæ›´å¤§çš„é¡ºåºè¯»å†™ç£ç›˜æ“ä½œï¼Œè¿ç»­çš„å†…å­˜å—ç­‰ç­‰ï¼Œæ‰€æœ‰è¿™äº›éƒ½ä½¿ KafKa å°†éšæœºæµæ¶ˆæ¯é¡ºåºå†™å…¥åˆ°ç£ç›˜ï¼Œ å†ç”± consumers è¿›è¡Œæ¶ˆè´¹ã€‚\nå¦ä¸€ä¸ªä½æ•ˆç‡çš„æ“ä½œæ˜¯å­—èŠ‚æ‹·è´ï¼Œåœ¨æ¶ˆæ¯é‡å°‘æ—¶ï¼Œè¿™ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œå½±å“å°±ä¸å®¹å¿½è§†ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨ producer ï¼Œbroker å’Œ consumer éƒ½å…±äº«çš„æ ‡å‡†åŒ–çš„äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼ï¼Œè¿™æ ·æ•°æ®å—ä¸ç”¨ä¿®æ”¹å°±èƒ½åœ¨ä»–ä»¬ä¹‹é—´ä¼ é€’ã€‚\nbroker ç»´æŠ¤çš„æ¶ˆæ¯æ—¥å¿—æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ç›®å½•ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ç”±ä¸€ç³»åˆ—ä»¥ç›¸åŒæ ¼å¼å†™å…¥åˆ°ç£ç›˜çš„æ¶ˆæ¯é›†åˆç»„æˆï¼Œè¿™ç§å†™å…¥æ ¼å¼è¢« producer å’Œ consumer å…±ç”¨ã€‚ä¿æŒè¿™ç§é€šç”¨æ ¼å¼å¯ä»¥å¯¹ä¸€äº›å¾ˆé‡è¦çš„æ“ä½œè¿›è¡Œä¼˜åŒ–: æŒä¹…åŒ–æ—¥å¿—å—çš„ç½‘ç»œä¼ è¾“ã€‚ ç°ä»£çš„unix æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªé«˜åº¦ä¼˜åŒ–çš„ç¼–ç æ–¹å¼ï¼Œç”¨äºå°†æ•°æ®ä» pagecache è½¬ç§»åˆ° socket ç½‘ç»œè¿æ¥ä¸­ï¼›åœ¨ Linux ä¸­ç³»ç»Ÿè°ƒç”¨ sendfile åšåˆ°è¿™ä¸€ç‚¹ã€‚\nä¸ºäº†ç†è§£ sendfile çš„æ„ä¹‰ï¼Œäº†è§£æ•°æ®ä»æ–‡ä»¶åˆ°å¥—æ¥å­—çš„å¸¸è§æ•°æ®ä¼ è¾“è·¯å¾„å°±éå¸¸é‡è¦ï¼š\n æ“ä½œç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…æ ¸ç©ºé—´çš„ pagecache åº”ç”¨ç¨‹åºè¯»å–å†…æ ¸ç©ºé—´çš„æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´çš„ç¼“å†²åŒº åº”ç”¨ç¨‹åºå°†æ•°æ®(ç”¨æˆ·ç©ºé—´çš„ç¼“å†²åŒº)å†™å›å†…æ ¸ç©ºé—´åˆ°å¥—æ¥å­—ç¼“å†²åŒº(å†…æ ¸ç©ºé—´) æ“ä½œç³»ç»Ÿå°†æ•°æ®ä»å¥—æ¥å­—ç¼“å†²åŒº(å†…æ ¸ç©ºé—´)å¤åˆ¶åˆ°é€šè¿‡ç½‘ç»œå‘é€çš„ NIC ç¼“å†²åŒº è¿™æ˜¾ç„¶æ˜¯ä½æ•ˆçš„ï¼Œæœ‰å››æ¬¡ copy æ“ä½œå’Œä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨ã€‚ä½¿ç”¨ sendfile æ–¹æ³•ï¼Œå¯ä»¥å…è®¸æ“ä½œç³»ç»Ÿå°†æ•°æ®ä» pagecache ç›´æ¥å‘é€åˆ°ç½‘ç»œï¼Œè¿™æ ·é¿å…é‡æ–°å¤åˆ¶æ•°æ®ã€‚æ‰€ä»¥è¿™ç§ä¼˜åŒ–æ–¹å¼ï¼Œåªéœ€è¦æœ€åä¸€æ­¥çš„copyæ“ä½œï¼Œå°†æ•°æ®å¤åˆ¶åˆ° NIC ç¼“å†²åŒºã€‚  æˆ‘ä»¬æœŸæœ›ä¸€ä¸ªæ™®éçš„åº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ª topic è¢«å¤šæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚ä½¿ç”¨ä¸Šé¢æäº¤çš„ zero-copyï¼ˆé›¶æ‹·è´ï¼‰ä¼˜åŒ–ï¼Œæ•°æ®åœ¨ä½¿ç”¨æ—¶åªä¼šè¢«å¤åˆ¶åˆ° pagecache ä¸­ä¸€æ¬¡ï¼ŒèŠ‚çœäº†æ¯æ¬¡æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´å†…å­˜ä¸­ï¼Œå†ä»ç”¨æˆ·ç©ºé—´è¿›è¡Œè¯»å–çš„æ¶ˆè€—ã€‚è¿™ä½¿å¾—æ¶ˆæ¯èƒ½å¤Ÿä»¥æ¥è¿‘ç½‘ç»œè¿æ¥é€Ÿåº¦çš„ ä¸Šé™è¿›è¡Œæ¶ˆè´¹ã€‚\npagecache å’Œ sendfile çš„ç»„åˆä½¿ç”¨æ„å‘³ç€ï¼Œåœ¨ä¸€ä¸ªkafkaé›†ç¾¤ä¸­ï¼Œå¤§å¤šæ•° consumer æ¶ˆè´¹æ—¶ï¼Œæ‚¨å°†çœ‹ä¸åˆ°ç£ç›˜ä¸Šçš„è¯»å–æ´»åŠ¨ï¼Œå› ä¸ºæ•°æ®å°†å®Œå…¨ç”±ç¼“å­˜æä¾›ã€‚\nRef https://blog.csdn.net/u013411339/article/details/99514789\nhttp://kafka.apachecn.org/documentation.html#persistence\nhttps://zhuanlan.zhihu.com/p/105509080\nhttps://shiyueqi.github.io/2017/04/27/Kafka-Pagecache%E5%8E%9F%E7%90%86/\nhttps://www.jianshu.com/p/f0b294062de8\nhttps://www.jianshu.com/p/f0b294062de8\n","href":"/kafka/kafka%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B9%8B%E6%80%A7%E8%83%BD%E7%AF%87/","title":"Kafkaæºç é˜…è¯»ä¹‹æ€§èƒ½ç¯‡"},{"content":" Kafka æºç è§£æä¹‹ socketServer åŸç†ç¯‡  Kafka æ˜¯å¦‚ä½•åšåˆ°ç™¾ä¸‡çº§é«˜å¹¶å‘ä½å»¶è¿Ÿçš„?\n åŸç† æœ‰åˆ«äºä¼ ç»Ÿçš„ thread per connection æ¨¡å‹, Kafka ä½¿ç”¨åŸºäº NIO å®ç°çš„ Reactor æ¨¡å‹.\nKafka ä½¿ç”¨ nio å®ç°äº†è‡ªå·±çš„ socketServer ç½‘ç»œå±‚ä»£ç , è€Œéå¸¸è§çš„ nettyã€mina æ¡†æ¶, ä»æ€§èƒ½ä¸Šæ¥çœ‹è¿™ä¸€å—å¹¶ä¸æ˜¯ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆ.\nkafka socketServer é€šä¿¡é‡‡å–çš„æ˜¯ NIO çš„reactoræ¨¡å¼, æ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨æ¨¡å¼.\nä»€ä¹ˆæ˜¯ Reactor æ¨¡å‹  åŒæ­¥çš„ç­‰å¾…å¤šä¸ªäº‹ä»¶æºåˆ°è¾¾ï¼ˆé‡‡ç”¨select()å®ç°ï¼‰\n å°†äº‹ä»¶å¤šè·¯åˆ†è§£ä»¥åŠåˆ†é…ç›¸åº”çš„äº‹ä»¶æœåŠ¡è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªåˆ†æ´¾é‡‡ç”¨serveré›†ä¸­å¤„ç†ï¼ˆdispatchï¼‰\n åˆ†è§£çš„äº‹ä»¶ä»¥åŠå¯¹åº”çš„äº‹ä»¶æœåŠ¡åº”ç”¨ä»åˆ†æ´¾æœåŠ¡ä¸­åˆ†ç¦»å‡ºå»ï¼ˆhandlerï¼‰\n  ä¸ºä½•éœ€è¦ Reactor æ¨¡å‹  åŒæ­¥é˜»å¡IOï¼Œè¯»å†™é˜»å¡ï¼Œçº¿ç¨‹ç­‰å¾…æ—¶é—´è¿‡é•¿ åœ¨åˆ¶å®šçº¿ç¨‹ç­–ç•¥çš„æ—¶å€™ï¼Œåªèƒ½æ ¹æ®CPUçš„æ•°ç›®æ¥é™å®šå¯ç”¨çº¿ç¨‹èµ„æºï¼Œä¸èƒ½æ ¹æ®è¿æ¥å¹¶å‘æ•°ç›®æ¥åˆ¶å®šï¼Œä¹Ÿå°±æ˜¯è¿æ¥æœ‰é™åˆ¶ã€‚å¦åˆ™å¾ˆéš¾ä¿è¯å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„é«˜æ•ˆå’Œå…¬å¹³ã€‚ å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé€ æˆçº¿ç¨‹ä½¿ç”¨æ•ˆç‡å¹¶ä¸é«˜ï¼Œå¹¶ä¸”ä¸æ˜“æ‰©å±• çŠ¶æ€æ•°æ®ä»¥åŠå…¶ä»–éœ€è¦ä¿æŒä¸€è‡´çš„æ•°æ®ï¼Œéœ€è¦é‡‡ç”¨å¹¶å‘åŒæ­¥æ§åˆ¶  Kafka çš„ socketServer å¦‚ä½•å®ç° Reactor æ¨¡å‹ kafka çš„æ¶æ„æ¨¡å‹ å·¥ä½œåŸç†ï¼š 1ï¼‰å…ˆåˆ›å»ºServerSocketChannelå¯¹è±¡å¹¶åœ¨Selectorä¸Šæ³¨å†ŒOP_ACCEPTäº‹ä»¶ï¼ŒServerSocketChannelè´Ÿè´£ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥è¯·æ±‚ã€‚ 2ï¼‰å½“å®¢æˆ·ç«¯å‘èµ·æœåŠ¡ç«¯çš„ç½‘ç»œè¿æ¥æ—¶ï¼ŒæœåŠ¡ç«¯çš„Selectorç›‘å¬åˆ°æ­¤OP_ACCEPTäº‹ä»¶ï¼Œä¼šè§¦å‘Acceptoræ¥å¤„ç†OP_ACCEPTã€‚ 3ï¼‰å½“Acceptoræ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„Socketè¿æ¥è¯·æ±‚æ—¶ä¼šä¸ºè¿™ä¸ªè¿æ¥åˆ›å»ºå“åº”çš„SocketChannelï¼Œå°†SocketChannelè®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¹¶åœ¨Selectorä¸Šæ³¨å†Œå…¶å…³æ³¨çš„I/Oäº‹ä»¶ï¼Œå¦‚OP_READ,OP_WRITEã€‚æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„Socketè¿æ¥å»ºç«‹å®Œæˆã€‚ 4ï¼‰å½“å®¢æˆ·ç«¯é€šè¿‡å·²ç»å»ºç«‹çš„SocketChannelè¿æ¥å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯çš„Selectorä¼šç›‘å¬åˆ°OP_READäº‹ä»¶ï¼Œå¹¶è§¦å‘æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘ï¼ˆä¸Šå›¾ä¸­çš„Reader Handlerï¼‰ã€‚å½“æœåŠ¡ç«¯å¯ä»¥å‘å®¢æˆ·ç«¯å†™æ•°æ®æ—¶ï¼ŒæœåŠ¡ç«¯çš„Selectorä¼šç›‘å¬åˆ°OP_WRITEäº‹ä»¶ï¼Œå¹¶è§¦å‘ç›¸åº”çš„æ‰§è¡Œé€»è¾‘ï¼ˆä¸Šå›¾ä¸­çš„Writer Handlerï¼‰ã€‚ è¿™äº›äº‹æƒ…éƒ½æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„ï¼ŒKafkaProducerä¸­çš„Senderçº¿ç¨‹ä»¥åŠKafkaConsumerçš„ä»£ç éƒ½æ˜¯è¿™ç§è®¾è®¡ã€‚è¿™æ ·çš„è®¾è®¡æ—¶å€™å®¢æˆ·ç«¯è¿™æ ·çš„å¹¶å‘è¿æ¥æ•°å°ï¼Œæ•°æ®é‡è¾ƒå°çš„åœºæ™¯ï¼Œè¿™æ ·å¯¹äºæœåŠ¡ç«¯æ¥è¯´å°±ä¼šæœ‰ç¼ºç‚¹ã€‚å¦‚ï¼šæŸä¸ªè¯·æ±‚çš„å¤„ç†è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼Œé€ æˆæ‰€æœ‰çš„åç»­è¯·æ±‚è¯»æ— æ³•å¤„ç†ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚è¶…æ—¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå°±å¿…é¡»è¦æ±‚æœåŠ¡ç«¯åœ¨è¯»å–è¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚å·²ç»å‘é€å“åº”ç­‰å„ä¸ªç¯èŠ‚ä¸Šå¿…é¡»èƒ½è¿…é€Ÿçš„å®Œæˆï¼Œè¿™æ ·å°±æå‡äº†ç¼–ç¨‹çš„éš¾åº¦ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹å®ç°ä¸äº†ã€‚è€Œä¸”è¿™ç§æ¨¡å¼ä¸èƒ½åˆ©ç”¨æœåŠ¡å™¨å¤šæ ¸å¤šå¤„ç†å™¨çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œé€ æˆèµ„æºçš„æµªè´¹ã€‚ ä¸ºäº†æ»¡è¶³é«˜å¹¶å‘çš„éœ€æ±‚ï¼ŒæœåŠ¡ç«¯éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹æ¥æ‰§è¡Œé€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥å¯¹ä¸Šè¿°æ¶æ„åšè°ƒæ•´ï¼Œå°†ç½‘ç»œçš„è¯»å†™çš„é€»è¾‘å’Œä¸šåŠ¡å¤„ç†çš„é€»è¾‘è¿›è¡Œæ‹†åˆ†ï¼Œè®©å…¶ç”±ä¸åŒçš„çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œä»è€Œå®ç°å¤šçº¿ç¨‹å¤„ç†ã€‚ é“¾æ¥ï¼šhttps://www.jianshu.com/p/0239a3ced855\nå®¢æˆ·ç«¯è¯·æ±‚NIOçš„è¿æ¥å™¨Acceptorï¼ŒåŒæ—¶å®ƒè¿˜å…·å¤‡äº‹ä»¶çš„è½¬å‘åŠŸèƒ½ï¼Œè½¬å‘åˆ°Processorå¤„ç†,æœåŠ¡ç«¯ç½‘ç»œäº‹ä»¶å¤„ç†å™¨Processor è¯·æ±‚é˜Ÿåˆ—RequestChannelï¼Œå­˜å‚¨äº†æ‰€æœ‰å¾…å¤„ç†çš„è¯·æ±‚ä¿¡æ¯, è¯·æ±‚å¤„ç†çº¿ç¨‹æ± (RequestHandlerPool)ä½œä¸ºå®ˆæŠ¤çº¿ç¨‹è½®è®­RequestChannelçš„è¯·æ±‚å¤„ç†ä¿¡æ¯ï¼Œå¹¶å°†å…¶è½¬å‘ç»™APIå±‚å¯¹åº”çš„å¤„ç†å™¨å¤„ç†APIå±‚å¤„ç†å™¨å°†è¯·æ±‚å¤„ç†å®Œæˆä¹‹åæ”¾å…¥åˆ°Response Queueä¸­ï¼Œå¹¶ç”±Processorä»ResponseQueueå–å‡ºå‘é€åˆ°å¯¹åº”çš„Clientç«¯.\n 1 ä¸ª Acceptor çº¿ç¨‹ï¼Œè´Ÿè´£ç›‘å¬ Socket æ–°çš„è¿æ¥è¯·æ±‚ï¼Œæ³¨å†Œäº† OP_ACCEPT äº‹ä»¶ï¼Œå°†æ–°çš„è¿æ¥æŒ‰ç…§ round robin æ–¹å¼äº¤ç»™å¯¹åº”çš„ Processor çº¿ç¨‹å¤„ç†ï¼›æ³¨æ„ kafka ä¸€èˆ¬æƒ…å†µä¸‹çš„ reactor æ¨¡å‹è¿˜æ˜¯å•çº¿ç¨‹Acceptorå¤šçº¿ç¨‹handler, æ¯ä¸ª EndPoint (ç½‘å¡) åªèƒ½æ„é€ ä¸€ä¸ª Acceptor. N ä¸ª Processor çº¿ç¨‹ï¼Œå…¶ä¸­æ¯ä¸ª Processor éƒ½æœ‰è‡ªå·±çš„ selectorï¼Œå®ƒä¼šå‘ Acceptor åˆ†é…çš„ SocketChannel æ³¨å†Œç›¸åº”çš„ OP_READ äº‹ä»¶ï¼ŒN çš„å¤§å°ç”± num.networker.threads (3) å†³å®šï¼› M ä¸ª KafkaRequestHandler çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œå¹¶å°†å¤„ç†çš„ç»“æœè¿”å›ç»™ Processor çº¿ç¨‹å¯¹åº”çš„ response queue ä¸­ï¼Œç”± Processor å°†å¤„ç†çš„ç»“æœè¿”å›ç»™ç›¸åº”çš„è¯·æ±‚å‘é€è€…ï¼ŒM çš„å¤§å°ç”± num.io.threads (8) æ¥å†³å®šã€‚  æ•´ä½“è¯·æ±‚æµç¨‹å¦‚ä¸‹:\n Acceptor ç›‘å¬åˆ°æ¥è‡ªè¯·æ±‚è€…ï¼ˆè¯·æ±‚è€…å¯ä»¥æ˜¯æ¥è‡ª clientï¼Œä¹Ÿå¯ä»¥æ¥è‡ª serverï¼‰çš„æ–°çš„è¿æ¥ï¼ŒAcceptor å°†è¿™ä¸ªè¯·æ±‚è€…æŒ‰ç…§ round robin çš„æ–¹å¼äº¤ç»™å¯¹å¯¹åº”çš„ Processor è¿›è¡Œå¤„ç†ï¼› Processor æ³¨å†Œè¿™ä¸ª SocketChannel çš„ OP_READ çš„äº‹ä»¶ï¼Œå¦‚æœæœ‰è¯·æ±‚å‘é€è¿‡æ¥å°±å¯ä»¥è¢« Processor çš„ Selector é€‰ä¸­ï¼› Processor å°†è¯·æ±‚è€…å‘é€çš„è¯·æ±‚æ”¾å…¥åˆ°ä¸€ä¸ª Request Queue ä¸­ï¼Œè¿™æ˜¯æ‰€æœ‰ Processor å…±æœ‰çš„ä¸€ä¸ªé˜Ÿåˆ—ï¼›queued.max.requests requestChannel çš„å¤§å°, é»˜è®¤500 KafkaRequestHandler ä» Request Queue ä¸­å–å‡ºè¯·æ±‚ï¼› è°ƒç”¨ KafkaApis è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼› å¤„ç†çš„ç»“æœæ”¾å…¥åˆ°è¯¥ Processor å¯¹åº”çš„ Response Queue ä¸­ï¼ˆæ¯ä¸ª request éƒ½æ ‡è¯†å®ƒä»¬æ¥è‡ªå“ªä¸ª Processorï¼‰ï¼ŒRequest Queue çš„æ•°é‡ä¸ Processor çš„æ•°é‡ä¿æŒä¸€è‡´ï¼› Processor ä»å¯¹åº”çš„ Response Queue ä¸­å–å‡º responseï¼› Processor å°†å¤„ç†çš„ç»“æœè¿”å›ç»™å¯¹åº”çš„è¯·æ±‚è€…  æºç è¯¦è§£ https://www.geek-share.com/detail/2789927213.html https://www.jianshu.com/p/ff1432f5a14b\nAcceptor Acceptoræ˜¯NIOé‡Œé¢çš„ä¸€ä¸ªè½»é‡çº§æ¥å…¥æœåŠ¡ï¼Œå®ƒä¸»è¦åŒ…å«å¦‚ä¸‹å˜é‡ï¼š\nnioSelectorï¼šJavaçš„NIOç½‘ç»œé€‰æ‹©å™¨ serverChannelï¼šipå’Œç«¯å£ç»‘å®šåˆ°socket Processors:processorçš„å®¹å™¨ï¼Œå­˜æ”¾çš„æ˜¯processorå¯¹è±¡\nå®ƒçš„ä¸»è¦å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š\n å°†nioSelectoræ³¨å†Œä¸ºOP_ACCEPT\n è½®è®­ä»nioSelectorè¯»å–äº‹ä»¶\n é€šè¿‡RRçš„æ¨¡å¼é€‰æ‹©processor (Round-Robin)\n æ¥æ”¶ä¸€ä¸ªæ–°çš„é“¾æ¥è®¾ç½®(ä»serverSocketChannelè·å–socketChannelï¼Œå¹¶å¯¹å®ƒçš„å±æ€§è¿›è¡Œè®¾ç½®)\n ç§»äº¤processorçš„acceptå¤„ç†\n  Processor Processorçš„ä¸»è¦èŒè´£æ˜¯å°†æ¥è‡ªå®¢æˆ·ç«¯çš„ç½‘ç»œé“¾æ¥è¯·æ±‚å°è£…æˆRequestContextå¹¶å‘é€ç»™RequestChannelï¼ŒåŒæ—¶éœ€è¦å¯¹handlerå¤„ç†å®Œçš„å“åº”å›æ‰§å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®ƒä¸»è¦åŒ…æ‹¬ï¼š\nnewConnectionsï¼šæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œå­˜æ”¾ä»acceptoræ¥æ”¶åˆ°çš„ç½‘ç»œæ–°é“¾æ¥ inflightResponsesï¼šå·²å‘é€å®¢æˆ·ç«¯çš„å“åº”ï¼Œå­˜æ”¾äº†å’Œå®¢æˆ·ç«¯çš„é“¾æ¥id(ç”±æœ¬åœ°ipã€portä»¥åŠè¿œç«¯ipã€portè¿˜æœ‰é¢å¤–ä¸€ä¸ªåºåˆ—å€¼ç»„æˆ)å’Œå“åº”å¯¹è±¡çš„æ˜ å°„ responseQueueï¼šæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå­˜æ”¾handlerçš„å“åº”è¯·æ±‚\nå®ƒçš„ä¸»è¦å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š\n proccessorçº¿ç¨‹ä»newConnectionsä¸­è½®è¯¢è·å–socketChannelï¼Œå¹¶å°†selectorç›‘å¬äº‹ä»¶ä¿®æ”¹ä¸ºOP_READï¼›\n processNewResponseså¤„ç†æ–°çš„å“åº”éœ€æ±‚ï¼Œå…¶ä¸­ç±»å‹ä¸ºSendActionçš„å°±æ˜¯å‘å®¢æˆ·ç«¯å‘é€å“åº”ï¼Œå¹¶å°†å‘é€çš„å“åº”è®°å½•åœ¨inflightResponses ,å®ƒçš„æ ¸å¿ƒé€»è¾‘æ˜¯sendResponseå¦‚ä¸‹ï¼š\n Selectorè°ƒç”¨pollä»å®¢æˆ·ç«¯è·å–åˆ°çš„è¯·æ±‚ä¿¡æ¯ï¼Œå¹¶å°†è·å–åˆ°çš„NetworkReceiveæ·»åŠ åˆ°completedReceivesç¼“å­˜ä¸­ã€‚\n è€ŒprocessCompletedReceivesè´Ÿè´£å¤„ç†completedReceivesä¸­çš„æ¥æ”¶ä¿¡æ¯ï¼Œæœ€åå°è£…ä¸ºRequestChannel.Requestï¼Œå†è°ƒç”¨requestChannelå°†è¯·æ±‚æ·»åŠ åˆ°å‘é€é˜Ÿåˆ—ï¼ˆå³requestQueueï¼‰å½“ä¸­ï¼Œæºç é€»è¾‘å¦‚ä¸‹æ‰€ç¤ºï¼š\n  RequestChannel requestChannelæ‰¿è½½äº†kafkaè¯·æ±‚å’Œå“åº”çš„æ‰€æœ‰è½¬å‘ï¼Œå®ƒåŒ…å«æœ‰å¦‚ä¸‹ä¸¤ä¸ªå˜é‡ï¼š\nrequestQueueï¼šæ˜¯ä¸€ä¸ªåŠ é”é˜»å¡é˜Ÿåˆ—ï¼ŒRequestChannelä¼ è¾“è¯·æ±‚å’Œå“åº”ä¿¡æ¯çš„é‡è¦ç»„ä»¶ï¼Œä¸Šé¢è®²åˆ°çš„RequestChannel.Requestå°±æ˜¯è¢«æ”¾å…¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­\nProcessorsï¼šå­˜å‚¨äº†processoridå’Œprocessorçš„æ˜ å°„å…³ç³»ï¼Œä¸»è¦æ˜¯åœ¨responseå‘é€çš„æ—¶å€™ä»ä¸­é€‰æ‹©å¯¹åº”çš„processor å®ƒçš„ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½æ˜¯æ·»åŠ è¯·æ±‚å’Œå‘é€å“åº”å›æ‰§ï¼Œæºç é€»è¾‘åˆ†åˆ«å¦‚ä¸‹ï¼š\nSelector çš„å°è£… (TODO) https://blog.csdn.net/zhanyuanlin/article/details/76906583 https://blog.csdn.net/zhanyuanlin/article/details/76556578 https://matt33.com/2018/06/27/kafka-server-process-model/ https://www.zhenchao.org/2019/06/21/kafka/kafka-reactor/\nRef https://www.geek-share.com/detail/2789927213.html\nReactor https://juejin.im/post/5b4570cce51d451984695a9b\n","href":"/kafka/kafka%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B9%8Bsocketserver%E5%8E%9F%E7%90%86%E7%AF%87/","title":"Kafkaæºç é˜…è¯»ä¹‹socketServeråŸç†ç¯‡"},{"content":" Kafka æºç è§£æä¹‹ brokerå¯åŠ¨  åŸºäº kafka 2.3.0 C:/kafka created on 0327 modified on 0410 å­¦ä¹ äº† scala ä¹‹åæˆ‘åˆæ¥äº†\n  Kafka å¯åŠ¨è„šæœ¬åˆ†æ Kafka æ ¸å¿ƒä¸»ç±» kafka.Kafka ç”±äºä½œè€…çš„ java çŸ¥è¯†ç›¸å¯¹è–„å¼±ï¼Œæºç æ³¨è§£å¯èƒ½åšçš„æ¯”è¾ƒç»†\nobject Kafka extends Logging { // è¯»å–é…ç½®æ–‡ä»¶æ–¹æ³•  def getPropsFromArgs(args: Array[String]): Properties = { // å¤„ç†å‘½ä»¤è¡Œå‚æ•°çš„è§£æå·¥å…· OptionParser  val optionParser = new OptionParser(false) // å…è®¸è¦†ç›–å†…å®¹  val overrideOpt = optionParser.accepts(\u0026#34;override\u0026#34;, \u0026#34;Optional property that should override values set in server.properties file\u0026#34;) .withRequiredArg() .ofType(classOf[String]) // This is just to make the parameter show up in the help output, we are not actually using this due the  // fact that this class ignores the first parameter which is interpreted as positional and mandatory  // but would not be mandatory if --version is specified  // This is a bit of an ugly crutch till we get a chance to rework the entire command line parsing  val versionOpt = optionParser.accepts(\u0026#34;version\u0026#34;, \u0026#34;Print version information and exit.\u0026#34;) // å¦‚æœ å‘½ä»¤è¡Œå‚æ•° ä¸º 0  if (args.length == 0 || args.contains(\u0026#34;--help\u0026#34;)) { CommandLineUtils.printUsageAndDie(optionParser, \u0026#34;USAGE: java [options] %s server.properties [--override property=value]*\u0026#34;.format(classOf[KafkaServer].getSimpleName())) } if (args.contains(\u0026#34;--version\u0026#34;)) { CommandLineUtils.printVersionAndDie() } val props = Utils.loadProps(args(0)) if (args.length \u0026gt; 1) { val options = optionParser.parse(args.slice(1, args.length): _*) if (options.nonOptionArguments().size() \u0026gt; 0) { CommandLineUtils.printUsageAndDie(optionParser, \u0026#34;Found non argument parameters: \u0026#34; + options.nonOptionArguments().toArray.mkString(\u0026#34;,\u0026#34;)) } props ++= CommandLineUtils.parseKeyValueArgs(options.valuesOf(overrideOpt).asScala) } props } // Kafka å®é™…çš„æ‰§è¡Œç±»  def main(args: Array[String]): Unit = { try { //ä¸Šè¿°çš„ getPropsFromArgs è·å–é…ç½®æ–‡ä»¶ä¿¡æ¯  val serverProps = getPropsFromArgs(args) // è°ƒç”¨äº†KafkaServerStartable å¯¹è±¡ è¯»å– props æ–‡ä»¶ï¼Œé‡Œé¢å®é™…ä¸Šæ˜¯è°ƒç”¨äº† KafkaServer.startup()  val kafkaServerStartable = KafkaServerStartable.fromProps(serverProps) // æ“ä½œç³»ç»Ÿåˆ¤æ–­  try { if (!OperatingSystem.IS_WINDOWS \u0026amp;\u0026amp; !Java.isIbmJdk) new LoggingSignalHandler().register() } catch { case e: ReflectiveOperationException =\u0026gt; warn(\u0026#34;Failed to register optional signal handler that logs a message when the process is terminated \u0026#34; + s\u0026#34;by a signal. Reason for registration failure is: $e\u0026#34;, e) } // attach shutdown handler to catch terminating signals as well as normal termination  // Runtime ç”¨äº†å•å®ä¾‹çš„è®¾è®¡æ¨¡å¼ï¼Œæ‰€ä»¥åœ¨javaç¨‹åºä¸­ä¸åŒçº¿ç¨‹é€šè¿‡è°ƒç”¨Runtime.getRuntime()è·å¾—çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œ  // ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªjavaè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªRuntimeå®ä¾‹  //è¯¥å‡½æ•°çš„ä½œç”¨å°±æ˜¯åœ¨ä½ çš„ç¨‹åºç»“æŸå‰,æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œ,å°¤å…¶æ˜¯æ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„ç¨‹åº.å¾ˆæ˜æ˜¾,è¿™äº›å…³é—­é’©å­éƒ½æ˜¯çº¿ç¨‹å¯¹è±¡,  // å› æ­¤,æ¸…ç†å·¥ä½œè¦å†™åœ¨run()é‡Œ.æ ¹æ®JDKå¸®åŠ©æ–‡æ¡£,æ¸…ç†å·¥ä½œä¸èƒ½å¤ªè€—æ—¶,è¦å°½å¿«ç»“æŸ,ä½†ä»ç„¶å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ.  //æ„æ€å°±æ˜¯åœ¨jvmä¸­å¢åŠ ä¸€ä¸ªå…³é—­çš„é’©å­ï¼Œå½“jvmå…³é—­çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œç³»ç»Ÿä¸­å·²ç»è®¾ç½®çš„æ‰€æœ‰é€šè¿‡æ–¹æ³•addShutdownHookæ·»åŠ çš„é’©å­ï¼Œ  // å½“ç³»ç»Ÿæ‰§è¡Œå®Œè¿™äº›é’©å­åï¼Œjvmæ‰ä¼šå…³é—­ã€‚æ‰€ä»¥è¿™äº›é’©å­å¯ä»¥åœ¨jvmå…³é—­çš„æ—¶å€™è¿›è¡Œå†…å­˜æ¸…ç†ã€å¯¹è±¡é”€æ¯ç­‰æ“ä½œã€‚  Runtime.getRuntime().addShutdownHook(new Thread(\u0026#34;kafka-shutdown-hook\u0026#34;) { override def run(): Unit = kafkaServerStartable.shutdown() }) // è¿™é‡Œç»ˆäºåˆ°äº† kafka å¯åŠ¨äº†ï¼Œ æœ¬è´¨ä¸Šå°±æ˜¯ KafkaServer.startup()  kafkaServerStartable.startup() // shutdown ä¹‹åéœ€è¦åšçš„ä¸€äº›äº‹  kafkaServerStartable.awaitShutdown() } catch { case e: Throwable =\u0026gt; fatal(\u0026#34;Exiting Kafka due to fatal exception\u0026#34;, e) Exit.exit(1) } Exit.exit(0) } } ç„¶ååˆ°äº† kafka.server.KafkaServerStartable å’Œ kafka.server.KafkaServer KafkaServerStartable åŒ…è£…äº†ä¸€å±‚KafkaServerã€‚æœ¬è´¨ä¸Š KafkaServerStartable å®šä¹‰äº† KafkaServer çš„ å‡ ç§çŠ¶æ€ï¼Œå°†å±äºè¿™å‡ ç§çŠ¶æ€çš„ error æŠ½è±¡äº†å‡ºæ¥ã€‚\nç°åœ¨æ¥çœ‹çœ‹ KafkaServer çš„ startup() å¯åŠ¨ç±»\nclass KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNamePrefix: Option[String] = None, kafkaMetricsReporters: Seq[KafkaMetricsReporter] = List()) extends Logging with KafkaMetricsGroup { // å¯åŠ¨ã€æ˜¯å¦å…³é—­ã€æ˜¯å¦å¯åŠ¨æ ‡è¯†  // åŸå­æ–¹å¼è¿›è¡Œè¯»å’Œå†™çš„å¸ƒå°”å€¼  //AtomicBooleanæ˜¯Java.util.concurrent.atomicåŒ…ä¸‹çš„åŸå­å˜é‡ï¼Œè¿™ä¸ªåŒ…é‡Œé¢æä¾›äº†ä¸€ç»„åŸå­ç±»ã€‚  // å…¶åŸºæœ¬çš„ç‰¹æ€§å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™äº›ç±»çš„å®ä¾‹åŒ…å«çš„æ–¹æ³•æ—¶ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œ  // å³å½“æŸä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤æ—¶ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œè€Œåˆ«çš„çº¿ç¨‹å°±åƒè‡ªæ—‹é”ä¸€æ ·ï¼Œ  // ä¸€ç›´ç­‰åˆ°è¯¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰ç”±JVMä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè¿™åªæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„ç†è§£ã€‚  // å®é™…ä¸Šæ˜¯å€ŸåŠ©ç¡¬ä»¶çš„ç›¸å…³æŒ‡ä»¤æ¥å®ç°çš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹(æˆ–è€…è¯´åªæ˜¯åœ¨ç¡¬ä»¶çº§åˆ«ä¸Šé˜»å¡äº†)ã€‚  private val startupComplete = new AtomicBoolean(false) private val isShuttingDown = new AtomicBoolean(false) private val isStartingUp = new AtomicBoolean(false) // CountDownLatchæ˜¯åŒæ­¥å·¥å…·ç±»ä¹‹ä¸€ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªè®¡æ•°å€¼ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ç”±çº¿ç¨‹è¿›è¡Œå‡1æ“ä½œï¼Œ  // å½“è®¡æ•°å€¼å˜ä¸º0ä¹‹åï¼Œè¢«awaitæ–¹æ³•é˜»å¡çš„çº¿ç¨‹å°†ä¼šå”¤é†’ï¼Œå®ç°çº¿ç¨‹é—´çš„åŒæ­¥ã€‚  private var shutdownLatch = new CountDownLatch(1) private val jmxPrefix: String = \u0026#34;kafka.server\u0026#34; private var logContext: LogContext = null var metrics: Metrics = null val brokerState: BrokerState = new BrokerState var dataPlaneRequestProcessor: KafkaApis = null var controlPlaneRequestProcessor: KafkaApis = null var authorizer: Option[Authorizer] = None // ç›‘å¬ socket è¯·æ±‚  var socketServer: SocketServer = null // è¯·æ±‚èµ„æºæ±   var dataPlaneRequestHandlerPool: KafkaRequestHandlerPool = null var controlPlaneRequestHandlerPool: KafkaRequestHandlerPool = null // æ—¥å¿—ç®¡ç†  var logDirFailureChannel: LogDirFailureChannel = null var logManager: LogManager = null // åˆ†åŒºå‰¯æœ¬ç®¡ç†  var replicaManager: ReplicaManager = null var adminManager: AdminManager = null var tokenManager: DelegationTokenManager = null // åŠ¨æ€ config å¤„ç†  var dynamicConfigHandlers: Map[String, ConfigHandler] = null var dynamicConfigManager: DynamicConfigManager = null var credentialProvider: CredentialProvider = null var tokenCache: DelegationTokenCache = null var groupCoordinator: GroupCoordinator = null var transactionCoordinator: TransactionCoordinator = null var kafkaController: KafkaController = null var kafkaScheduler: KafkaScheduler = null var metadataCache: MetadataCache = null var quotaManagers: QuotaFactory.QuotaManagers = null private var _zkClient: KafkaZkClient = null val correlationId: AtomicInteger = new AtomicInteger(0) val brokerMetaPropsFile = \u0026#34;meta.properties\u0026#34; val brokerMetadataCheckpoints = config.logDirs.map(logDir =\u0026gt; (logDir, new BrokerMetadataCheckpoint(new File(logDir + File.separator + brokerMetaPropsFile)))).toMap private var _clusterId: String = null private var _brokerTopicStats: BrokerTopicStats = null def clusterId: String = _clusterId // Visible for testing  private[kafka] def zkClient = _zkClient private[kafka] def brokerTopicStats = _brokerTopicStats newGauge( \u0026#34;BrokerState\u0026#34;, new Gauge[Int] { def value = brokerState.currentState } ) newGauge( \u0026#34;ClusterId\u0026#34;, new Gauge[String] { def value = clusterId } ) newGauge( \u0026#34;yammer-metrics-count\u0026#34;, new Gauge[Int] { def value = { com.yammer.metrics.Metrics.defaultRegistry.allMetrics.size } } ) /** * Start up API for bringing up a single instance of the Kafka server. * Instantiates the LogManager, the SocketServer and the request handlers - KafkaRequestHandlers */ // Kafka çœŸæ­£ broker çš„å¯åŠ¨ç±»  def startup() { try { info(\u0026#34;starting\u0026#34;) // å¦‚æœè„šæœ¬å†æ¬¡åœ¨æœ¬æœºå¯åŠ¨è¿™ä¸ªç±»ï¼Œ  if (isShuttingDown.get) throw new IllegalStateException(\u0026#34;Kafka server is still shutting down, cannot re-start!\u0026#34;) if (startupComplete.get) return val canStartup = isStartingUp.compareAndSet(false, true) if (canStartup) { brokerState.newState(Starting) /* setup zookeeper */ // å¯åŠ¨ broker ç¬¬ä¸€æ­¥å°±æ˜¯ åˆå§‹åŒ– zk client  initZkClient(time) /* Get or create cluster_id */ // ç¡®å®š cluser idï¼Œ åŒ…è£… n å±‚ ç›´åˆ°é…ç½®æ–‡ä»¶ /cluster/id  _clusterId = getOrGenerateClusterId(zkClient) info(s\u0026#34;Cluster ID = $clusterId\u0026#34;) /* generate brokerId */ // è·å– broker id  val (brokerId, initialOfflineDirs) = getBrokerIdAndOfflineDirs config.brokerId = brokerId logContext = new LogContext(s\u0026#34;[KafkaServer id=${config.brokerId}] \u0026#34;) this.logIdent = logContext.logPrefix // initialize dynamic broker configs from ZooKeeper. Any updates made after this will be  // applied after DynamicConfigManager starts.  // Kafka æ”¯æŒåŠ¨æ€ä¿®æ”¹ config ï¼ˆéƒ½å­˜ zk ä¸Šï¼‰  config.dynamicConfig.initialize(zkClient) /* start scheduler */ // å¯åŠ¨è°ƒåº¦å™¨ A scheduler based on java.util.concurrent.ScheduledThreadPoolExecutor  // It has a pool of kafka-scheduler- threads that do the actual work.  kafkaScheduler = new KafkaScheduler(config.backgroundThreads) kafkaScheduler.startup() /* create and configure metrics */ val reporters = new util.ArrayList[MetricsReporter] reporters.add(new JmxReporter(jmxPrefix)) val metricConfig = KafkaServer.metricConfig(config) metrics = new Metrics(metricConfig, reporters, time, true) /* register broker metrics */ _brokerTopicStats = new BrokerTopicStats quotaManagers = QuotaFactory.instantiate(config, metrics, time, threadNamePrefix.getOrElse(\u0026#34;\u0026#34;)) notifyClusterListeners(kafkaMetricsReporters ++ metrics.reporters.asScala) logDirFailureChannel = new LogDirFailureChannel(config.logDirs.size) /* start log manager */ // å¯åŠ¨ Log Manager  logManager = LogManager(config, initialOfflineDirs, zkClient, brokerState, kafkaScheduler, time, brokerTopicStats, logDirFailureChannel) logManager.startup() metadataCache = new MetadataCache(config.brokerId) // Enable delegation token cache for all SCRAM mechanisms to simplify dynamic update.  // This keeps the cache up-to-date if new SCRAM mechanisms are enabled dynamically.  tokenCache = new DelegationTokenCache(ScramMechanism.mechanismNames) credentialProvider = new CredentialProvider(ScramMechanism.mechanismNames, tokenCache) // Create and start the socket server acceptor threads so that the bound port is known.  // Delay starting processors until the end of the initialization sequence to ensure  // that credentials have been loaded before processing authentications.  // å¯åŠ¨socket serverï¼Œå‡†å¤‡å¯¹å¤–æœåŠ¡äº†! 9092 åœ¨å¯åŠ¨å‰é¢çš„å†…éƒ¨ç±»å å¯¹å¤– æœåŠ¡  socketServer = new SocketServer(config, metrics, time, credentialProvider) socketServer.startup(startupProcessors = false) /* start replica manager */ // å¤åˆ¶ç®¡ç†  replicaManager = createReplicaManager(isShuttingDown) replicaManager.startup() // broker ç›¸å…³ä¿¡æ¯æ³¨å†Œåˆ° zk ä¸Šï¼Œhost:port å’Œé˜²æ­¢ controller è„‘è£‚çš„ epoch  // ç›´åˆ°è¿™æ­¥ çœŸæ­£æ³¨å†Œ åˆ° /broker/ids ç®—æ˜¯åŠ å…¥åˆ°é›†ç¾¤ä¸­äº†  val brokerInfo = createBrokerInfo val brokerEpoch = zkClient.registerBroker(brokerInfo) // Now that the broker id is successfully registered, checkpoint it  checkpointBrokerId(config.brokerId) /* start token manager */ tokenManager = new DelegationTokenManager(config, tokenCache, time , zkClient) tokenManager.startup() /* start kafka controller */ // å¯åŠ¨kafka controller  kafkaController = new KafkaController(config, zkClient, time, metrics, brokerInfo, brokerEpoch, tokenManager, threadNamePrefix) kafkaController.startup() adminManager = new AdminManager(config, metrics, metadataCache, zkClient) /* start group coordinator */ // Hardcode Time.SYSTEM for now as some Streams tests fail otherwise, it would be good to fix the underlying issue  groupCoordinator = GroupCoordinator(config, zkClient, replicaManager, Time.SYSTEM) groupCoordinator.startup() /* start transaction coordinator, with a separate background thread scheduler for transaction expiration and log loading */ // Hardcode Time.SYSTEM for now as some Streams tests fail otherwise, it would be good to fix the underlying issue  transactionCoordinator = TransactionCoordinator(config, replicaManager, new KafkaScheduler(threads = 1, threadNamePrefix = \u0026#34;transaction-log-manager-\u0026#34;), zkClient, metrics, metadataCache, Time.SYSTEM) transactionCoordinator.startup() /* Get the authorizer and initialize it if one is specified.*/ authorizer = Option(config.authorizerClassName).filter(_.nonEmpty).map { authorizerClassName =\u0026gt; val authZ = CoreUtils.createObject[Authorizer](authorizerClassName) authZ.configure(config.originals()) authZ } val fetchManager = new FetchManager(Time.SYSTEM, new FetchSessionCache(config.maxIncrementalFetchSessionCacheSlots, KafkaServer.MIN_INCREMENTAL_FETCH_SESSION_EVICTION_MS)) /* start processing requests */ // ä»è¿™é‡Œå¼€å§‹ï¼Œ å‡†å¤‡ å®Œæˆï¼Œ å¼€å§‹å¤„ç†å¤–ç•Œæ¶ˆæ¯ã€‚  dataPlaneRequestProcessor = new KafkaApis(socketServer.dataPlaneRequestChannel, replicaManager, adminManager, groupCoordinator, transactionCoordinator, kafkaController, zkClient, config.brokerId, config, metadataCache, metrics, authorizer, quotaManagers, fetchManager, brokerTopicStats, clusterId, time, tokenManager) // èµ·çº¿ç¨‹æ± ï¼Œä¼ å…¥ socket server å¯¹è±¡  dataPlaneRequestHandlerPool = new KafkaRequestHandlerPool(config.brokerId, socketServer.dataPlaneRequestChannel, dataPlaneRequestProcessor, time, config.numIoThreads, s\u0026#34;${SocketServer.DataPlaneMetricPrefix}RequestHandlerAvgIdlePercent\u0026#34;, SocketServer.DataPlaneThreadPrefix) socketServer.controlPlaneRequestChannelOpt.foreach { controlPlaneRequestChannel =\u0026gt; controlPlaneRequestProcessor = new KafkaApis(controlPlaneRequestChannel, replicaManager, adminManager, groupCoordinator, transactionCoordinator, kafkaController, zkClient, config.brokerId, config, metadataCache, metrics, authorizer, quotaManagers, fetchManager, brokerTopicStats, clusterId, time, tokenManager) controlPlaneRequestHandlerPool = new KafkaRequestHandlerPool(config.brokerId, socketServer.controlPlaneRequestChannelOpt.get, controlPlaneRequestProcessor, time, 1, s\u0026#34;${SocketServer.ControlPlaneMetricPrefix}RequestHandlerAvgIdlePercent\u0026#34;, SocketServer.ControlPlaneThreadPrefix) } // ç›‘æ§ç›¸å…³  Mx4jLoader.maybeLoad() /* Add all reconfigurables for config change notification before starting config handlers */ config.dynamicConfig.addReconfigurables(this) /* start dynamic config manager */ dynamicConfigHandlers = Map[String, ConfigHandler](ConfigType.Topic -\u0026gt; new TopicConfigHandler(logManager, config, quotaManagers, kafkaController), ConfigType.Client -\u0026gt; new ClientIdConfigHandler(quotaManagers), ConfigType.User -\u0026gt; new UserConfigHandler(quotaManagers, credentialProvider), ConfigType.Broker -\u0026gt; new BrokerConfigHandler(config, quotaManagers)) // Create the config manager. start listening to notifications  dynamicConfigManager = new DynamicConfigManager(zkClient, dynamicConfigHandlers) dynamicConfigManager.startup() // socket server å¼€å§‹å¯¹å¤–æœåŠ¡  socketServer.startDataPlaneProcessors() socketServer.startControlPlaneProcessor() brokerState.newState(RunningAsBroker) // ä¿®æ”¹åˆå§‹ new KafkaServer ç±»çš„çŠ¶æ€ï¼Œå¯åŠ¨å®Œæˆ  shutdownLatch = new CountDownLatch(1) startupComplete.set(true) isStartingUp.set(false) AppInfoParser.registerAppInfo(jmxPrefix, config.brokerId.toString, metrics, time.milliseconds()) info(\u0026#34;started\u0026#34;) } } catch { case e: Throwable =\u0026gt; fatal(\u0026#34;Fatal error during KafkaServer startup. Prepare to shutdown\u0026#34;, e) isStartingUp.set(false) shutdown() throw e } } æ ¸å¿ƒ ç»è¿‡ä»¥ä¸Šåˆ†æï¼Œkafka å¤§è‡´çš„å¯åŠ¨æµç¨‹æˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œæ¥ä¸‹æ¥æ˜¯çœ‹ kafka å†…éƒ¨ å„ä¸ª startup å‡ºæ¥çš„æ¨¡å—ï¼Œåˆ°åº•æ¯ä¸ªæ˜¯è´Ÿè´£ä»€ä¹ˆçš„ã€‚\næ¯”æ–¹è¯´: KafkaScheduleræ˜¯ä¸€ä¸ªåŸºäºjava.util.concurrent.ScheduledThreadPoolExecutorçš„è°ƒåº¦å™¨ï¼Œå®ƒå†…éƒ¨æ˜¯ä»¥å‰ç¼€kafka-scheduler-xxï¼ˆxxæ˜¯çº¿ç¨‹åºåˆ—å·ï¼‰çš„çº¿ç¨‹æ± å¤„ç†çœŸæ­£çš„å·¥ä½œã€‚\n","href":"/kafka/kafka%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B9%8Bbroker%E5%90%AF%E5%8A%A8/","title":"Kafkaæºç é˜…è¯»ä¹‹brokerå¯åŠ¨"},{"content":" Kafka æºç é˜…è¯» è¿™é‡Œæ˜¯ä¸€äº›kafkaæºç é˜…è¯»ç¬”è®°\n","href":"/kafka/intro/","title":"Intro"},{"content":"","href":"/authors/","title":"Authors"},{"content":"","href":"/categories/","title":"Categories"},{"content":" How to hugo æ—¥å¸¸ä½¿ç”¨ç¯‡  æœ¬ç¯‡ä»‹ç»å¦‚ä½•å‘å¸ƒä¸€ç¯‡æ–‡ç« å¹¶ç¼–å†™shellè„šæœ¬å¿«æ·å‘å¸ƒ/\n  How to hugo æ—¥å¸¸ä½¿ç”¨ç¯‡  æœ¬åœ°æ’°å†™åšæ–‡ å‘å¸ƒ shell è„šæœ¬è‡ªåŠ¨å‘å¸ƒ TODO Ref    æœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•å‘å¸ƒä¸€ç¯‡æ–‡ç« å¹¶ä¸Šä¼ åˆ°ç½‘é¡µç«¯. ä¸€å…±åªæœ‰ä¸¤ä¸ªæ­¥éª¤\n æœ¬åœ°æ’°å†™åšæ–‡ cd ./mytopia hugo server -D // æ­¤æ—¶å¼€å¯çš„æ˜¯fast render æ¨¡å¼, ä¼šçƒ­æ›´æ–°ä½ çš„åšæ–‡ç¼–è¾‘. hugo new /posts/new_intro.md // åˆ›å»ºä¸€ç¯‡æ–°çš„åšæ–‡ å‘å¸ƒ cd ./mytopia hugo -D // é»˜è®¤hugo newå‡ºæ¥çš„æ–‡ç« éƒ½æœ‰ä¸ªæ ‡ç­¾æ˜¯è‰ç¨¿, -D æŒ‡çš„æ˜¯build æ‰€æœ‰è‰ç¨¿ cd build git add . git commit -m \u0026#34;xxx\u0026#34; git push original master æ³¨æ„, ä»¥ä¸Šè¿™éƒ¨åˆ†æ¨é€ä¹‹å, é¡µé¢å°±æ›´æ–°äº†, ä½†æ˜¯å…¶å®æœ¬ä½“æ–‡ä»¶å¹¶æ²¡æœ‰ä¸Šä¼ åˆ°githubä¿å­˜, å»ºè®®å…ˆå¦‚ä¸‹æ“ä½œ:\ncd ./mytopia hugo -D git add . git commit -m \u0026#34;xxx\u0026#34; git push original master ç”±äºæ¯æ¬¡æƒ³å†™æ–‡ç« éƒ½è¦æ•²ä»¥ä¸Šé‚£ä¹ˆå¤šæ¡å‘½ä»¤, å½“ç„¶æˆ‘ä»¬è¿˜æ˜¯å†™ä¸€ä¸ªshellè„šæœ¬æ›´åŠ æ–¹ä¾¿.\nshell è„šæœ¬è‡ªåŠ¨å‘å¸ƒ deploy.sh ä½¿ç”¨æ–¹æ³•:\n å¤åˆ¶å¦‚ä¸‹è„šæœ¬å¹¶chomd + x deploy.sh è‡ªåŠ¨commit ./deploy.sh è‡ªåŠ¨push åˆ°githubå¹¶æ›´æ–°page, æˆ–è€…./deploy.sh + xxx  #!/bin/sh  # If a command fails then the deploy stops set -e printf \u0026#34;\\033[0;32mDeploying updates to tangzhongham...\\033[0m\\n\u0026#34; # Build the project. hugo -D # if using a theme, replace with `hugo -t \u0026lt;YOURTHEME\u0026gt;` # push your files to github msg=\u0026#34;saving file and rebuilding site $(date)\u0026#34; if [ -n \u0026#34;$*\u0026#34; ]; then msg=\u0026#34;$*\u0026#34; fi git add . git commit -m \u0026#34;$msg\u0026#34; # Push source and build repos. git push origin master # Go To Public folder cd public # Add changes to git. git add . # Commit changes. git commit -m \u0026#34;$msg\u0026#34; # Push source and build repos. git push origin master printf \u0026#34;upload success, enjoy your journey! \u0026#34; TODO deployment æ–‡ä»¶æ’°å†™  åˆ›å»ºäº†ä¸€ä¸ªæ”¹ç‰ˆçš„shæ–‡ä»¶,ä¸çŸ¥é“å’‹æ ·,è¯•è¯•.\nsearch åŠŸèƒ½æš‚æ—¶å»æ‰  ä¸€ä¸ªå¾ˆå‘çš„äº‹æƒ…, æŒ‰ç…§æ–‡æ¡£æ·»åŠ  search åˆ™ä¼šæŠŠhomepageçš„ä»‹ç»æŒ¤æ‰. æ”¾åˆ°sidebar åˆ™æ— æ³•ä½¿ç”¨\u0026hellip; æš‚æ—¶å»æ‰æœç´¢å§.\nRef minimoæ¨¡ç‰ˆ\nhugoå®˜æ–¹éƒ¨ç½²æ–‡æ¡£\n","href":"/intro/how_to_hugo%E6%97%A5%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%AF%87/","title":"How_to_hugoæ—¥å¸¸ä½¿ç”¨ç¯‡"},{"content":"","href":"/tags/","title":"Tags"},{"content":"","href":"/tags/github/","title":"github"},{"content":"","href":"/tags/hugo/","title":"hugo"},{"content":"","href":"/tags/markdown/","title":"markdown"},{"content":"","href":"/categories/tutorial/","title":"tutorial"},{"content":"","href":"/authors/tzh/","title":"tzh"},{"content":" How to hugo å®‰è£…ç¯‡  æœ¬ç¯‡ä»‹ç»å¦‚ä½•å®‰è£… hugo å¹¶å°† blog éƒ¨ç½²åˆ° github pages.\n ","href":"/intro/how_to_hugo%E5%AE%89%E8%A3%85%E7%AF%87/","title":"How_to_hugoå®‰è£…ç¯‡"},{"content":" hugo æ—¥å¿—æ“ä½œæµç¨‹ [toc]\n æœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•å‘å¸ƒä¸€ç¯‡æ–‡ç« å¹¶ä¸Šä¼ åˆ°ç½‘é¡µç«¯. ä¸€å…±åªæœ‰ä¸¤ä¸ªæ­¥éª¤\n æœ¬åœ°æ’°å†™åšæ–‡ cd ./mytopia hugo server -D // æ­¤æ—¶å¼€å¯çš„æ˜¯fast render æ¨¡å¼, ä¼šçƒ­æ›´æ–°ä½ çš„åšæ–‡ç¼–è¾‘. hugo new /posts/new_intro.md // åˆ›å»ºä¸€ç¯‡æ–°çš„åšæ–‡ å‘å¸ƒ cd ./mytopia hugo -D cd build git add . git commit -m \u0026#34;xxx\u0026#34; git push original master æ³¨æ„, ä»¥ä¸Šè¿™éƒ¨åˆ†æ¨é€ä¹‹å, é¡µé¢å°±æ›´æ–°äº†, ä½†æ˜¯å…¶å®æœ¬ä½“æ–‡ä»¶å¹¶æ²¡æœ‰ä¸Šä¼ åˆ°githubä¿å­˜, å»ºè®®å…ˆå¦‚ä¸‹æ“ä½œ:\ncd ./mytopia hugo -D git add . git commit -m \u0026#34;xxx\u0026#34; git push original master äºŒè¿›åˆ¶å›¾ç‰‡æ€ä¹ˆåŠ: TODO deployment æ–‡ä»¶æ’°å†™  åˆ›å»ºäº†ä¸€ä¸ªæ”¹ç‰ˆçš„shæ–‡ä»¶,ä¸çŸ¥é“å’‹æ ·,è¯•è¯•.\nä¸€ä¸ªå¾ˆå‘çš„äº‹æƒ…, æŒ‰ç…§æ–‡æ¡£æ·»åŠ  search åˆ™ä¼šæŠŠhomepageçš„ä»‹ç»æŒ¤æ‰. æ”¾åˆ°sidebar åˆ™æ— æ³•ä½¿ç”¨\u0026hellip; æš‚æ—¶å»æ‰æœç´¢å§.\næ–‡æœ¬ #!/bin/sh  # If a command fails then the deploy stops set -e printf \u0026#34;\\033[0;32mDeploying updates to tangzhongham...\\033[0m\\n\u0026#34; # Build the project. hugo -D # if using a theme, replace with `hugo -t \u0026lt;YOURTHEME\u0026gt;` # push your files to github msg=\u0026#34;saving file and rebuilding site $(date)\u0026#34; if [ -n \u0026#34;$*\u0026#34; ]; then msg=\u0026#34;$*\u0026#34; fi git add . git commit -m \u0026#34;$msg\u0026#34; # Push source and build repos. git push origin master # Go To Public folder cd public # Add changes to git. git add . # Commit changes. git commit -m \u0026#34;$msg\u0026#34; # Push source and build repos. git push origin master printf \u0026#34;upload success, enjoy your journey! \u0026#34; ps: å‘ç°è¯¥shellè„šæœ¬è‡ªå¸¦ä¼ å‚åŠŸèƒ½äº†...","href":"/posts/new_intro/","title":"New_intro"},{"content":" Hello! æœ‰é—®é¢˜æ¬¢è¿äº¤æµ!\nå¾®ä¿¡: tzh-1166\né‚®ç®±: 13122260573@163.com\n","href":"/about/","title":""},{"content":"","href":"/intro/how_to_hugo/","title":"How_to_hugo"},{"content":" 2019 å¹´ 11 æœˆ  2019 å¹´ 11 æœˆ  1119 - 1126 11 19 å‘¨äºŒ  Thoughts TODO LIST     This is for PRIVATE ONLY !!!\n 1119 - 1126 11 19 å‘¨äºŒ Thoughts ä»Šå¤©ç»ˆäºæŠŠé¡µé¢éƒ¨ç½²å¥½äº†~ ç„¶åå¯ä»¥èˆ’èˆ’æœæœçš„å‘å¸ƒ,ç„¶ååœ¨å“ªé‡Œéƒ½èƒ½çœ‹å•¦.\nTODO LIST deploy è„šæœ¬ç ”ç©¶ git submodule æ˜¯ä»€ä¹ˆæ„æ€ æ–‡ç« æ¶¦è‰²~ æ˜å¤©è¦å¼€å§‹è¾“å‡º kafka çš„ä¸œè¥¿å•¦~ ç„¶å Spark æºç ä¹Ÿè¦çœ‹èµ·æ¥äº†!!!  ","href":"/diary/201911/","title":"201911"},{"content":"","href":"/tags/orz.../","title":"ORZ..."},{"content":"","href":"/tags/create/","title":"create"},{"content":"","href":"/categories/diary/","title":"diary"},{"content":"","href":"/tags/diary/","title":"diary"},{"content":" How to deploy your hugo sites to Github Pages  How to deploy your hugo sites to Github Pages  éƒ¨ç½²åˆ° Github ä¸ªäººé¡µé¢ å¸¸è§é”™è¯¯ TODO LIST   éƒ¨ç½²åˆ° Github ä¸ªäººé¡µé¢  åœ¨github åˆ†åˆ«å»ºç«‹ mytopia å’Œ \u0026lt;username\u0026gt;.github.io çš„ä»“åº“ï¼Œå‰è€…ç”¨æ¥å­˜æ”¾ç½‘é¡µçš„æºæ–‡ä»¶ï¼Œåè€…ç”¨æ¥å­˜æ”¾æœ€ç»ˆå±•ç¤ºçš„ç½‘ç«™å†…å®¹\n è¿›å…¥ä¹‹å‰æ•™ç¨‹ä¸­çš„æœ¬åœ°ç›®å½•\n  cd /mytopia  å°† mytopia é¡¹ç›®å…³è”åˆ°è¿œç¨‹çš„ mytopia ä»“åº“  git remote add origin git@github.com/TangZhongham/mytopia.git  å°†æœ¬åœ°ç½‘ç«™å…¨éƒ¨æ¨é€åˆ°è¿œç¨‹çš„ mytopia ä»“åº“  git push -u origin master å¯èƒ½ä¼šå‡ºç°push ä¸äº†çš„åŸå› ã€‚å¯èƒ½éœ€è¦ä½  git add .ç„¶ågit commit -m \u0026quot;first commit\u0026quot;\nå‰æ–‡è¦æ³¨æ„git submodule å’Œ git initï¼Œæ‰€ä»¥è¿™è¾¹æ‰ä¸ç”¨git initäº†ã€‚src refspec master does not match é”™è¯¯æ˜¯ç”±äºæ²¡æœ‰ add ä¸œè¥¿å°± push äº†ã€‚\n æ­¤æ—¶æ‰€æœ‰ä»£ç å·²ç»è¢«æ¨é€åˆ° github ä¸Šäº†ã€‚\n ç¡®ä¿æœåŠ¡æ­£å¸¸ï¼Œå¹¶ç¡®ä¿æ ¹ç›®å½•ä¸‹æ²¡æœ‰ /publicæ–‡ä»¶å¤¹ã€‚\n  rm -r /public  å…³é—­hugoæœåŠ¡å™¨ctrl+Cï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º public å­æ¨¡å—ï¼Œå°†ç”¨äºgithub page å±•ç¤ºã€‚  git submodule add -b master https://github.com/TangZhongham/tangzhongham.github.io.git public  æ‰§è¡Œhugoå‘½ä»¤ï¼Œè‡ªåŠ¨åˆ›å»º public æ–‡ä»¶å¤¹ã€‚ç„¶åå°†ä»£ç æäº¤åˆ°è¿œç¨‹ mytopia ä»“åº“  hugo cd public git status git add . git commit -m \u0026#34;first commit\u0026#34; git push -u origin master ä¸è¡Œï¼Œé‡æ–°rm -r public è¯•è¯•ã€‚tangzhongham.github.io å»ºç‚¹ä¸œè¥¿ï¼Œå¥½åƒå¬è¯´ä¸èƒ½å®Œå…¨ä¸ºç©ºã€‚\nåˆ å®Œåˆ git add git commit/ git push -u origin master äº†ä¸€æ³¢ã€‚\né‡å¤ç¬¬7æ­¥\ncd ./public git pull --allow-unrelated-histories git push è§£å†³ä¸¤è¾¹ä¸ä¸€æ ·çš„é—®é¢˜ï¼ˆhttpé‚£è¾¹åˆ›å»ºäº†ä¸ªREADMEï¼‰  ç°åœ¨çš„æ“ä½œæµç¨‹å°±æ˜¯è¯´ï¼Œå…ˆæ”¹æ–‡ç« ã€‚ç„¶å /mytopia ä¸‹é¢ hugo -buildDrafts ç„¶å git add/commit/push ä¸‰è¿ï¼Œä¹‹å å» /build é‡Œé¢ ä¸‰è¿ï¼Œé¡µé¢æ‰èƒ½æ›´æ–°ã€‚ (å‘ç°ä¸æˆåŠŸçš„åŸå› æ˜¯ -buildDrafts å°‘äº†ä¸€ä¸ª - ç¬¦å·, è¦ä¹ˆæ˜¯-D è¦ä¹ˆæ˜¯ \u0026ndash;buildDrafts)\nç°åœ¨ä»–å¦ˆjs åˆ404 äº†ï¼Œææ¯›çº¿ æ–°é—®é¢˜å¥½åƒæ˜¯åœ¨å¤–é¢ git push ä¹‹åï¼Œé‡Œé¢å† git status å°± æ£€æµ‹ä¸åˆ°äº†ï¼Œç„¶åé¡µé¢ä¸Š mytopia çš„ public è¢« push äº†ï¼Œä½†æ˜¯ io çš„æ²¡æœ‰ã€‚ ä¸çŸ¥é“404 æ˜¯ä¸æ˜¯ç”±äºè¿™ä¸ªåŸå› ã€‚å°è¯• hugo -buildDrafts ä¹‹åå…ˆæäº¤é‡Œé¢çš„è¯•è¯•ã€‚\nå¸¸è§é”™è¯¯ TODO LIST é¢„å¤‡æµç¨‹ï¼šgo/git/hugo åˆ†ä¸¤ç¯‡ï¼Œæ€æ ·æœ¬åœ°å¯åŠ¨ï¼Œæ€æ ·éƒ¨ç½²ã€‚æ³¨æ„äº‹é¡¹ï¼ˆhttp ç©ºæ–‡ä»¶é—®é¢˜ï¼‰ å¯ä»¥é‡æ–°éƒ¨ç½²ä¸€æ¬¡ç©ï¼ˆå¥½ç´¯ï¼Œå¾€åç¨ç¨å§) Git submodule çš„ä½¿ç”¨ï¼Œä¸ºå•¥ä¸¤è¾¹è¦æ›´æ–°ä¸¤æ¬¡ deploy è„šæœ¬çš„ç¼–å†™ Enjoyï¼  ","href":"/intro/how_to_github_pages/","title":"How_to_github_pages"},{"content":" How to Hugo [toc]\nå®‰è£…ç¯‡ Git å®‰è£… ç•¥\nHugo å®‰è£… Windows ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶: Windows å®‰è£…å…¶å®è¦æ¯” Mac èˆ’æœä¸€äº›.æ‰¾åˆ° binary äºŒè¿›åˆ¶æ–‡ä»¶ çš„Releases, ä¸‹è½½ä¸‹æ¥å®‰è£…å°±è¡Œ. ä¸‹è½½é“¾æ¥\næ·»åŠ åˆ°Path: ä¸ä¼šçš„å¯ä»¥è°·æ­Œ.\nMac è¯šç„¶, æˆ‘ä¸€å¼€å§‹å½“ç„¶æ˜¯æ„‰å¿«çš„ä½¿ç”¨ brew install hugo çš„æ–¹å¼. é—®é¢˜æ¥äº†\u0026hellip;ç”±äºæ–¹æ–¹é¢çš„åŸå› ,è¿™æ ·ä¸‹è½½çš„ hugo ç‰ˆæœ¬å¤ªä½äº†,å’Œæˆ‘å–œæ¬¢çš„ä¸»é¢˜æœ‰å†²çª, æ‰€ä»¥ mac ä¹Ÿè€è€å®å®å’Œ win ä¸€æ ·æ‰¾äºŒè¿›åˆ¶å®‰è£…ç„¶åé…ç½®path å§~\n ps: Mac è½¯é“¾æ¥æœ‰ç‚¹å°å‘, æ²¡æå®šçš„è°·æ­Œå¯ä»¥è§£å†³.\n å¯åŠ¨ç¯‡  Hugo æ˜¯ç›®å‰æœ€èˆ’æœçš„markdown é™æ€ç½‘ç«™æ–¹æ¡ˆäº†. ç®€å•äº”æ­¥å¼€å§‹æ­å»ºåšå®¢å§.\n ç¬¬ä¸€æ­¥: ç½‘ç«™ ç”±äºé™æ€ç½‘ç«™çš„ä¾¿æ·æ€§, hugo å»ºç«‹ä¸€ä¸ªç½‘ç«™åªéœ€è¦ä¸€æ¡å‘½ä»¤.\nhugo new site mytopiia æ­¤æ—¶ hugo ç”Ÿæˆçš„ç›®å½•ç»“æ„å¦‚ä¸‹: mytopiia â”œâ”€â”€ archetypes # å­˜æ”¾ç”Ÿæˆåšå®¢çš„æ¨¡ç‰ˆ â”‚Â â””â”€â”€ default.md â”œâ”€â”€ config.toml # tommy çš„æ”¹è‰¯ç‰ˆ yaml â”œâ”€â”€ content # ä½ å†™markdown çš„åœ°æ–¹ â”œâ”€â”€ data # Hugo å¤„ç†çš„æ•°æ® â”œâ”€â”€ layouts # å¸ƒå±€æ–‡ä»¶ â”œâ”€â”€ static # é™æ€æ–‡ä»¶ â””â”€â”€ themes # ä¸»é¢˜ ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´, è¿™ä¸€æ­¥å·²ç»å¯ä»¥éƒ¨ç½²ä½ çš„â€œç½‘ç«™â€äº†. å…ˆæŒ‘ä¸€ä¸ªä¸»é¢˜å§.\nç¬¬äºŒæ­¥: ä¸»é¢˜ é€‰å¥½ä¸»é¢˜å, è¿™é‡Œæ¶‰åŠåˆ°ä¸€äº› git çš„çŸ¥è¯†, å…ˆç…§ç€æ•²å°±å¯¹äº†.\ncd mytopiia # ä¸‹è½½ä½ å–œæ¬¢çš„ theme, ä¸‹é¢æ˜¯æˆ‘å–œæ¬¢çš„. git init git submodule add https://github.com/panr/hugo-theme-terminal.git themes/terminal # æŠŠä¸»é¢˜åç§°æ·»åŠ åˆ° config é‡Œç”Ÿæ•ˆ. echo \u0026#39;theme = \u0026#34;terminal\u0026#34;\u0026#39; \u0026gt;\u0026gt; config.toml ç¬¬ä¸‰æ­¥: Config ç¬¬å››æ­¥: Markdown m\nç¬¬äº”æ­¥: Server æ¶¦è‰²ç¯‡ ","href":"/intro/how_to_hugo_1/","title":"How_to_hugo_1"},{"content":" All cowardice comes from not loving or not loving well, which is the same thing.\n ","href":"/","title":""},{"content":" 1. Markdown 5åˆ†é’Ÿä½¿ç”¨æŒ‡å—  æ³¨æ„: è¯¥ä¸»é¢˜çš„tocæ¸²æŸ“æœ‰ç‚¹é—®é¢˜,ä¸æ”¯æŒ1.1.1 è¿™ç§è¡¨è¾¾(å’Œ visual studio code é‡Œé¢å†²çª)   1. Markdown 5åˆ†é’Ÿä½¿ç”¨æŒ‡å—  1.1. Why Markdown How to Markdown 1.2.1. ç»“æ„ 1.2.2. æ®µè½  1.2.2.1. åˆ†éš”ç¬¦ 1.2.2.2. å¼•ç”¨ 1.2.2.3. ä»£ç å— 1.2.2.3.1. å•è¡Œä»£ç  1.2.2.3.2. å¤šè¡Œä»£ç   1.2.3. å¥å­  1.2.3.1. æ¢è¡Œ 1.2.3.2. Bullet Dot  1.2.4. æ–‡æœ¬  1.2.4.1. é“¾æ¥  1.3. Others 1.3.1. æ‚   1.1. Why Markdown  Markdown is a lightweight markup language that you can use to add formatting elements to plaintext text documents.\n Markdown æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œè®©ä½ åœ¨ä¸éœ€è¦è¿‡åº¦å…³æ³¨æ–‡ç« ç»“æ„çš„åŒæ—¶ï¼Œæä¾›äº†ç¬¦åˆé€»è¾‘çš„æ–‡ç« ç»“æ„ã€‚\nHow to Markdown æ­£å¦‚ä»¥ä¸Šæ‰€è¯´ï¼ŒMarkdown åªæ˜¯ä¸ºäº†è®©ä½ æ›´èˆ’æœçš„ç»„ç»‡å¥½æ–‡ç« æ¶æ„ï¼Œé‚£ä¹ˆä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä½¿ç”¨åˆ™å¾ˆç¬¦åˆé€»è¾‘ã€‚\n1.2.1. ç»“æ„ Markdown æŠŠä¸€ç¯‡æ–‡ç« åˆ†ä¸ºå¦‚ä¸‹ç»“æ„:\nä¸€çº§æ ‡é¢˜åªèƒ½æœ‰ä¸€ä¸ªï¼Œç­‰ä»·äºæ–‡ç« çš„æ ‡é¢˜ï¼Œæ‰€æœ‰å…¶ä»–ç­‰çº§æ ‡é¢˜éƒ½åœ¨ä¸€çº§æ ‡é¢˜ä¸‹é¢ã€‚\n1.2.2. æ®µè½ æ­£æ–‡ç›´æ¥æ‰‹å†™å°±è¡Œã€‚\n1.2.2.1. åˆ†éš”ç¬¦ å¦‚ä¸‹ï¼š\n1.2.2.2. å¼•ç”¨  è¿™æ ·å°±å¯ä»¥å¼•ç”¨åˆ«äººçš„è¯ã€‚\n å¼•ç”¨åŠŸèƒ½å¯ä»¥åµŒå¥—ã€‚\n å“ˆå“ˆ\n   1.2.2.3. ä»£ç å— 1.2.2.3.1. å•è¡Œä»£ç  å•è¡Œä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼šdef\n1.2.2.3.2. å¤šè¡Œä»£ç  å¤šè¡Œä»£ç ä¸€æ ·çš„ï¼ŒåŒæ—¶åœ¨åæ¥ python ç­‰å¯ä»¥æ”¯æŒä¸åŒè¯­æ³•çš„ä»£ç é«˜äº®ã€‚\ndef hello_world(): \u0026#34;\u0026#34;\u0026#34; ä»£ç é‡Œé¢å°±ä¸€æ ·çš„ \u0026#34;\u0026#34;\u0026#34; pass 1.2.3. å¥å­ 1.2.3.1. æ¢è¡Œ Markdown çš„æ¢è¡Œæœ‰ç‚¹å‚»é€¼ã€‚ å¯ä»¥è¿™ä¹ˆæ¢(è²Œä¼¼æ²¡æœ‰æ›´å¥½çš„è§£å†³åŠæ³•)\n1.2.3.2. Bullet Dot è¿™æ ·å°±è¡Œ ä¼šè‡ªåŠ¨å¾€åæ·»åŠ ï¼Œä¸ç”¨æ¯ä¸ªéƒ½æ‰‹æ‰“ï¼Œæ”¾å¿ƒã€‚  1.2.4. æ–‡æœ¬ æ–‡æœ¬çš„å†…å®¹å°±æ¯”è¾ƒæœ‰è¶£äº†ã€‚ æ¯”æ–¹è¯´å¯ä»¥åŠ ç²—ï¼Œå¯ä»¥åˆ’å»å†…å®¹ï¼Œå¯ä»¥ æ–œä½“å­— ï¼Œä¹Ÿå¯ä»¥ä¸‹åˆ’çº¿ã€‚\n1.2.4.1. é“¾æ¥ å¯ä»¥ç›´æ¥è¿™æ ·\nå›¾ç‰‡çš„è¯ï¼š 1.3. Others 1.3.1. æ‚ ","href":"/posts/how_to_hugo/","title":"How_to_hugo"},{"content":" Markdown 5åˆ†é’Ÿä½¿ç”¨æŒ‡å—  Markdown 5åˆ†é’Ÿä½¿ç”¨æŒ‡å—  Why Markdown How to Markdown ç»“æ„ æ®µè½  åˆ†éš”ç¬¦ å¼•ç”¨ ä»£ç å— å•è¡Œä»£ç  å¤šè¡Œä»£ç   å¥å­  æ¢è¡Œ Bullet Dot  æ–‡æœ¬  é“¾æ¥  Others æ‚   Why Markdown  Markdown is a lightweight markup language that you can use to add formatting elements to plaintext text documents.\n Markdown æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œè®©ä½ åœ¨ä¸éœ€è¦è¿‡åº¦å…³æ³¨æ–‡ç« ç»“æ„çš„åŒæ—¶ï¼Œæä¾›äº†ç¬¦åˆé€»è¾‘çš„æ–‡ç« ç»“æ„ã€‚\nHow to Markdown æ­£å¦‚ä»¥ä¸Šæ‰€è¯´ï¼ŒMarkdown åªæ˜¯ä¸ºäº†è®©ä½ æ›´èˆ’æœçš„ç»„ç»‡å¥½æ–‡ç« æ¶æ„ï¼Œé‚£ä¹ˆä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä½¿ç”¨åˆ™å¾ˆç¬¦åˆé€»è¾‘ã€‚\nç»“æ„ Markdown æŠŠä¸€ç¯‡æ–‡ç« åˆ†ä¸ºå¦‚ä¸‹ç»“æ„:\n è¿™æ˜¯ä¸€çº§æ ‡é¢˜ è¿™æ˜¯äºŒçº§æ ‡é¢˜ è¿™æ˜¯ä¸‰çº§æ ‡é¢˜ è¿™æ˜¯å››çº§æ ‡é¢˜ è¿™æ˜¯äº”çº§æ ‡é¢˜  ä¸€çº§æ ‡é¢˜åªèƒ½æœ‰ä¸€ä¸ªï¼Œç­‰ä»·äºæ–‡ç« çš„æ ‡é¢˜ï¼Œæ‰€æœ‰å…¶ä»–ç­‰çº§æ ‡é¢˜éƒ½åœ¨ä¸€çº§æ ‡é¢˜ä¸‹é¢ã€‚\næ®µè½ æ­£æ–‡ç›´æ¥æ‰‹å†™å°±è¡Œã€‚\nåˆ†éš”ç¬¦ å¦‚ä¸‹ï¼š\nå¼•ç”¨  è¿™æ ·å°±å¯ä»¥å¼•ç”¨åˆ«äººçš„è¯ã€‚\n å¼•ç”¨åŠŸèƒ½å¯ä»¥åµŒå¥—ã€‚\n å“ˆå“ˆ\n   ä»£ç å— å•è¡Œä»£ç  å•è¡Œä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼šdef\nå¤šè¡Œä»£ç  å¤šè¡Œä»£ç ä¸€æ ·çš„ï¼ŒåŒæ—¶åœ¨åæ¥ python ç­‰å¯ä»¥æ”¯æŒä¸åŒè¯­æ³•çš„ä»£ç é«˜äº®ã€‚\ndef hello_world(): \u0026#34;\u0026#34;\u0026#34; ä»£ç é‡Œé¢å°±ä¸€æ ·çš„ \u0026#34;\u0026#34;\u0026#34; pass å¥å­ æ¢è¡Œ Markdown çš„æ¢è¡Œæœ‰ç‚¹å‚»é€¼ã€‚ å¯ä»¥è¿™ä¹ˆæ¢(è²Œä¼¼æ²¡æœ‰æ›´å¥½çš„è§£å†³åŠæ³•)\nBullet Dot è¿™æ ·å°±è¡Œ ä¼šè‡ªåŠ¨å¾€åæ·»åŠ ï¼Œä¸ç”¨æ¯ä¸ªéƒ½æ‰‹æ‰“ï¼Œæ”¾å¿ƒã€‚  æ–‡æœ¬ æ–‡æœ¬çš„å†…å®¹å°±æ¯”è¾ƒæœ‰è¶£äº†ã€‚ æ¯”æ–¹è¯´å¯ä»¥åŠ ç²—ï¼Œå¯ä»¥åˆ’å»å†…å®¹ï¼Œå¯ä»¥ æ–œä½“å­— ï¼Œä¹Ÿå¯ä»¥ä¸‹åˆ’çº¿ã€‚\né“¾æ¥ å¯ä»¥ç›´æ¥è¿™æ ·\nhttp://www.hao123.com\nå›¾ç‰‡çš„è¯ï¼š Others æ‚ ","href":"/posts/how_to_markdown/","title":"How_to_markdown"},{"content":"","href":"/categories/posts/","title":"posts"},{"content":"","href":"/contentt/page/search/","title":""},{"content":"","href":"/pagge/search/","title":""},{"content":"","href":"/pagge/search/","title":""},{"content":"","href":"/search/","title":""},{"content":"","href":"/contentt/","title":"Contentts"},{"content":"","href":"/pagge/","title":"Pagges"},{"content":"","href":"/series/","title":"Series"}]
